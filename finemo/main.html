<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>finemo.main API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../finemo.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;finemo</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#extract_regions_bw">extract_regions_bw</a>
            </li>
            <li>
                    <a class="function" href="#extract_regions_chrombpnet_h5">extract_regions_chrombpnet_h5</a>
            </li>
            <li>
                    <a class="function" href="#extract_regions_bpnet_h5">extract_regions_bpnet_h5</a>
            </li>
            <li>
                    <a class="function" href="#extract_regions_modisco_fmt">extract_regions_modisco_fmt</a>
            </li>
            <li>
                    <a class="function" href="#call_hits">call_hits</a>
            </li>
            <li>
                    <a class="function" href="#report">report</a>
            </li>
            <li>
                    <a class="function" href="#collapse_hits">collapse_hits</a>
            </li>
            <li>
                    <a class="function" href="#intersect_hits">intersect_hits</a>
            </li>
            <li>
                    <a class="function" href="#cli">cli</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../finemo.html">finemo</a><wbr>.main    </h1>

                        <div class="docstring"><p>Main CLI module for the Fi-NeMo motif instance calling pipeline.</p>

<p>This module provides the command-line interface for all Fi-NeMo operations:</p>

<ul>
<li>Data preprocessing from various genomic formats</li>
<li>Motif hit calling using the Fi-NeMo algorithm</li>
<li>Report generation and result visualization</li>
<li>Post-processing operations (hit collapsing, intersection)</li>
</ul>

<p>The CLI supports multiple input formats including bigWig, HDF5 (ChromBPNet/BPNet),
and TF-MoDISco format.</p>
</div>

                        <input id="mod-main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-main-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;Main CLI module for the Fi-NeMo motif instance calling pipeline.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">This module provides the command-line interface for all Fi-NeMo operations:</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">- Data preprocessing from various genomic formats</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">- Motif hit calling using the Fi-NeMo algorithm</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">- Report generation and result visualization</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="sd">- Post-processing operations (hit collapsing, intersection)</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="sd">The CLI supports multiple input formats including bigWig, HDF5 (ChromBPNet/BPNet),</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="sd">and TF-MoDISco format.</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">data_io</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_regions_bw</span><span class="p">(</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>    <span class="n">peaks_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>    <span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>    <span class="n">fa_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>    <span class="n">bw_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>    <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>    <span class="n">region_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract genomic regions and contribution scores from bigWig and FASTA files.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">    Parameters</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">    ----------</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">    peaks_path : str</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">        Path to ENCODE NarrowPeak format file.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">    chrom_order_path : str, optional</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">        Path to chromosome ordering file.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">    fa_path : str</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">        Path to genome FASTA file.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">    bw_paths : List[str]</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">        List of bigWig file paths containing contribution scores.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">    out_path : str</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">        Output path for NPZ file.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">    region_width : int</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">        Width of regions to extract around peak summits.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">    Notes</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">    -----</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">    BigWig files only provide projected contribution scores.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>    <span class="n">half_width</span> <span class="o">=</span> <span class="n">region_width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>    <span class="c1"># Load peak regions and extract sequences/contributions</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_peaks</span><span class="p">(</span><span class="n">peaks_path</span><span class="p">,</span> <span class="n">chrom_order_path</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>    <span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_regions_from_bw</span><span class="p">(</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>        <span class="n">peaks_df</span><span class="p">,</span> <span class="n">fa_path</span><span class="p">,</span> <span class="n">bw_paths</span><span class="p">,</span> <span class="n">half_width</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>    <span class="p">)</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>    <span class="c1"># Save processed data to NPZ format</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_regions_npz</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">peaks_df</span><span class="o">=</span><span class="n">peaks_df</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_regions_chrombpnet_h5</span><span class="p">(</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>    <span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>    <span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>    <span class="n">h5_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>    <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>    <span class="n">region_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract genomic regions and contribution scores from ChromBPNet HDF5 files.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">    Parameters</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">    ----------</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">    peaks_path : str, optional</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">        Path to ENCODE NarrowPeak format file. If None, lacks absolute coordinates.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">    chrom_order_path : str, optional</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">        Path to chromosome ordering file.</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">    h5_paths : List[str]</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">        List of ChromBPNet HDF5 file paths.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">    out_path : str</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">        Output path for NPZ file.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a><span class="sd">    region_width : int</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">        Width of regions to extract around peak summits.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>    <span class="n">half_width</span> <span class="o">=</span> <span class="n">region_width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>    <span class="k">if</span> <span class="n">peaks_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_peaks</span><span class="p">(</span><span class="n">peaks_path</span><span class="p">,</span> <span class="n">chrom_order_path</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>    <span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_regions_from_chrombpnet_h5</span><span class="p">(</span><span class="n">h5_paths</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_regions_npz</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">peaks_df</span><span class="o">=</span><span class="n">peaks_df</span><span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_regions_bpnet_h5</span><span class="p">(</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>    <span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>    <span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>    <span class="n">h5_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>    <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>    <span class="n">region_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract genomic regions and contribution scores from BPNet HDF5 files.</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">    Parameters</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="sd">    ----------</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a><span class="sd">    peaks_path : str, optional</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">        Path to ENCODE NarrowPeak format file. If None, output lacks absolute coordinates.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a><span class="sd">    chrom_order_path : str, optional</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">        Path to chromosome ordering file.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">    h5_paths : List[str]</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="sd">        List of BPNet HDF5 file paths.</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">    out_path : str</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">        Output path for NPZ file.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">    region_width : int</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">        Width of regions to extract around peak summits.</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>    <span class="n">half_width</span> <span class="o">=</span> <span class="n">region_width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>    <span class="k">if</span> <span class="n">peaks_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_peaks</span><span class="p">(</span><span class="n">peaks_path</span><span class="p">,</span> <span class="n">chrom_order_path</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>    <span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_regions_from_bpnet_h5</span><span class="p">(</span><span class="n">h5_paths</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_regions_npz</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">peaks_df</span><span class="o">=</span><span class="n">peaks_df</span><span class="p">)</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_regions_modisco_fmt</span><span class="p">(</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>    <span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>    <span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>    <span class="n">shaps_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>    <span class="n">ohe_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>    <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>    <span class="n">region_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract genomic regions and contribution scores from TF-MoDISco format files.</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">    Parameters</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">    ----------</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">    peaks_path : str, optional</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">        Path to ENCODE NarrowPeak format file. If None, output lacks absolute coordinates.</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">    chrom_order_path : str, optional</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">        Path to chromosome ordering file.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">    shaps_paths : List[str]</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">        List of paths to .npy/.npz files containing SHAP/attribution scores.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">    ohe_path : str</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">        Path to .npy/.npz file containing one-hot encoded sequences.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">    out_path : str</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">        Output path for NPZ file.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">    region_width : int</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">        Width of regions to extract around peak summits.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>    <span class="n">half_width</span> <span class="o">=</span> <span class="n">region_width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>    <span class="k">if</span> <span class="n">peaks_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_peaks</span><span class="p">(</span><span class="n">peaks_path</span><span class="p">,</span> <span class="n">chrom_order_path</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>    <span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_regions_from_modisco_fmt</span><span class="p">(</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>        <span class="n">shaps_paths</span><span class="p">,</span> <span class="n">ohe_path</span><span class="p">,</span> <span class="n">half_width</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>    <span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_regions_npz</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">peaks_df</span><span class="o">=</span><span class="n">peaks_df</span><span class="p">)</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="k">def</span><span class="w"> </span><span class="nf">call_hits</span><span class="p">(</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>    <span class="n">regions_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>    <span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>    <span class="n">modisco_h5_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>    <span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>    <span class="n">motifs_include_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>    <span class="n">motif_names_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>    <span class="n">motif_lambdas_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>    <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>    <span class="n">cwm_trim_coords_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>    <span class="n">cwm_trim_thresholds_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>    <span class="n">cwm_trim_threshold_default</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>    <span class="n">lambda_default</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>    <span class="n">step_size_max</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>    <span class="n">step_size_min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>    <span class="n">sqrt_transform</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>    <span class="n">convergence_tol</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>    <span class="n">max_steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>    <span class="n">step_adjust</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>    <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>    <span class="n">no_post_filter</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>    <span class="n">compile_optimizer</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Call motif hits using the Fi-NeMo algorithm on preprocessed genomic regions.</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">    This function implements the core Fi-NeMo hit calling pipeline, which identifies</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="sd">    motif instances by solving a sparse reconstruction problem using proximal gradient</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">    descent. The algorithm represents contribution scores as weighted combinations of</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">    motif CWMs at specific positions.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">    Parameters</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">    ----------</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">    regions_path : str</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">        Path to NPZ file containing preprocessed regions (sequences, contributions,</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">        and optional peak coordinates).</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">    peaks_path : str, optional</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">        DEPRECATED. Path to ENCODE NarrowPeak format file. Peak data should be</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">        included during preprocessing instead.</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="sd">    modisco_h5_path : str</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">        Path to TF-MoDISco H5 file containing motif CWMs.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">    chrom_order_path : str, optional</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">        DEPRECATED. Path to chromosome ordering file.</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">    motifs_include_path : str, optional</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">        Path to file listing motif names to include in analysis.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">    motif_names_path : str, optional</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        Path to file mapping motif IDs to custom names.</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">    motif_lambdas_path : str, optional</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">        Path to file specifying per-motif lambda values.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">    out_dir : str</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">        Output directory for results.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">    cwm_trim_coords_path : str, optional</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">        Path to file specifying custom motif trimming coordinates.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">    cwm_trim_thresholds_path : str, optional</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">        Path to file specifying custom motif trimming thresholds.</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">    cwm_trim_threshold_default : float</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">        Default threshold for motif trimming (typically 0.3).</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">    lambda_default : float</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">        Default L1 regularization weight (typically 0.7).</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">    step_size_max : float</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">        Maximum optimization step size.</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">    step_size_min : float</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">        Minimum optimization step size.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="sd">    sqrt_transform : bool</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">        Whether to apply signed square root transform to contributions.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">    convergence_tol : float</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">        Convergence tolerance for duality gap.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">    max_steps : int</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">        Maximum number of optimization steps.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">    batch_size : int</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">        Batch size for GPU processing.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">    step_adjust : float</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        Step size adjustment factor on divergence.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">    device : str, optional</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">        DEPRECATED. Use CUDA_VISIBLE_DEVICES environment variable instead.</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">    mode : str</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        Contribution type mode (&#39;pp&#39;, &#39;ph&#39;, &#39;hp&#39;, &#39;hh&#39;) where &#39;p&#39;=projected, &#39;h&#39;=hypothetical.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">    no_post_filter : bool</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">        If True, skip post-hit-calling similarity filtering.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">    compile_optimizer : bool</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">        Whether to JIT-compile the optimizer for speed.</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">    Notes</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="sd">    -----</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">    The Fi-NeMo algorithm solves the optimization problem:</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">    minimize_c: ||contribs - reconstruction(c)||²₂ + λ||c||₁</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">    subject to: c ≥ 0</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">    where c represents motif hit coefficients and reconstruction uses convolution</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">    with motif CWMs.</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>    <span class="n">params</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">hitcaller</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>    <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>            <span class="s2">&quot;The `--device` flag is deprecated and will be removed in a future version. Please use the `CUDA_VISIBLE_DEVICES` environment variable to specify the GPU device.&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>        <span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>    <span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">peaks_df</span><span class="p">,</span> <span class="n">has_peaks</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_regions_npz</span><span class="p">(</span><span class="n">regions_path</span><span class="p">)</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>    <span class="n">region_width</span> <span class="o">=</span> <span class="n">sequences</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>    <span class="k">if</span> <span class="n">region_width</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Region width of </span><span class="si">{</span><span class="n">region_width</span><span class="si">}</span><span class="s2"> is not divisible by 2.&quot;</span><span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>    <span class="n">half_width</span> <span class="o">=</span> <span class="n">region_width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>    <span class="n">num_regions</span> <span class="o">=</span> <span class="n">contribs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>    <span class="k">if</span> <span class="n">peaks_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>            <span class="s2">&quot;Providing a peaks file to `call-hits` is deprecated, and this option will be removed in a future version. Peaks should instead be provided in the preprocessing step to be included in `regions.npz`.&quot;</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>        <span class="p">)</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_peaks</span><span class="p">(</span><span class="n">peaks_path</span><span class="p">,</span> <span class="n">chrom_order_path</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>        <span class="n">has_peaks</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_peaks</span><span class="p">:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>            <span class="s2">&quot;No peak region data provided. Output hits will lack absolute genomic coordinates.&quot;</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>        <span class="p">)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;pp&quot;</span><span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>        <span class="n">motif_type</span> <span class="o">=</span> <span class="s2">&quot;cwm&quot;</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>        <span class="n">use_hypothetical_contribs</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;ph&quot;</span><span class="p">:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>        <span class="n">motif_type</span> <span class="o">=</span> <span class="s2">&quot;cwm&quot;</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>        <span class="n">use_hypothetical_contribs</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;hp&quot;</span><span class="p">:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>        <span class="n">motif_type</span> <span class="o">=</span> <span class="s2">&quot;hcwm&quot;</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>        <span class="n">use_hypothetical_contribs</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;hh&quot;</span><span class="p">:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="n">motif_type</span> <span class="o">=</span> <span class="s2">&quot;hcwm&quot;</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>        <span class="n">use_hypothetical_contribs</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">. Must be one of &#39;pp&#39;, &#39;ph&#39;, &#39;hp&#39;, &#39;hh&#39;.&quot;</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>        <span class="p">)</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>    <span class="k">if</span> <span class="n">motifs_include_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>        <span class="n">motifs_include</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_txt</span><span class="p">(</span><span class="n">motifs_include_path</span><span class="p">)</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>        <span class="n">motifs_include</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>    <span class="k">if</span> <span class="n">motif_names_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>        <span class="n">motif_name_map</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_mapping</span><span class="p">(</span><span class="n">motif_names_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>        <span class="n">motif_name_map</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>    <span class="k">if</span> <span class="n">motif_lambdas_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="n">motif_lambdas</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_mapping</span><span class="p">(</span><span class="n">motif_lambdas_path</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>        <span class="n">motif_lambdas</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>    <span class="k">if</span> <span class="n">cwm_trim_coords_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>        <span class="n">trim_coords</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_mapping_tuple</span><span class="p">(</span><span class="n">cwm_trim_coords_path</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>        <span class="n">trim_coords</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>    <span class="k">if</span> <span class="n">cwm_trim_thresholds_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>        <span class="n">trim_thresholds</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_mapping</span><span class="p">(</span><span class="n">cwm_trim_thresholds_path</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>        <span class="n">trim_thresholds</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>    <span class="n">motifs_df</span><span class="p">,</span> <span class="n">cwms</span><span class="p">,</span> <span class="n">trim_masks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_modisco_motifs</span><span class="p">(</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>        <span class="n">modisco_h5_path</span><span class="p">,</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>        <span class="n">trim_coords</span><span class="p">,</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="n">trim_thresholds</span><span class="p">,</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>        <span class="n">cwm_trim_threshold_default</span><span class="p">,</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>        <span class="n">motif_type</span><span class="p">,</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>        <span class="n">motifs_include</span><span class="p">,</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>        <span class="n">motif_name_map</span><span class="p">,</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>        <span class="n">motif_lambdas</span><span class="p">,</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>        <span class="n">lambda_default</span><span class="p">,</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>        <span class="kc">True</span><span class="p">,</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>    <span class="p">)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>    <span class="n">num_motifs</span> <span class="o">=</span> <span class="n">cwms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>    <span class="n">motif_width</span> <span class="o">=</span> <span class="n">cwms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>    <span class="n">lambdas</span> <span class="o">=</span> <span class="n">motifs_df</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;lambda&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">writable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>    <span class="n">device_obj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>    <span class="n">hits_df</span><span class="p">,</span> <span class="n">qc_df</span> <span class="o">=</span> <span class="n">hitcaller</span><span class="o">.</span><span class="n">fit_contribs</span><span class="p">(</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>        <span class="n">cwms</span><span class="p">,</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>        <span class="n">contribs</span><span class="p">,</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>        <span class="n">sequences</span><span class="p">,</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>        <span class="n">trim_masks</span><span class="p">,</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>        <span class="n">use_hypothetical_contribs</span><span class="p">,</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>        <span class="n">lambdas</span><span class="p">,</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>        <span class="n">step_size_max</span><span class="p">,</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>        <span class="n">step_size_min</span><span class="p">,</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>        <span class="n">sqrt_transform</span><span class="p">,</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>        <span class="n">convergence_tol</span><span class="p">,</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>        <span class="n">max_steps</span><span class="p">,</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        <span class="n">batch_size</span><span class="p">,</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="n">step_adjust</span><span class="p">,</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>        <span class="ow">not</span> <span class="n">no_post_filter</span><span class="p">,</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>        <span class="n">device_obj</span><span class="p">,</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>        <span class="n">compile_optimizer</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>    <span class="p">)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>    <span class="n">out_path_qc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;peaks_qc.tsv&quot;</span><span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_hits</span><span class="p">(</span><span class="n">hits_df</span><span class="p">,</span> <span class="n">peaks_df</span><span class="p">,</span> <span class="n">motifs_df</span><span class="p">,</span> <span class="n">qc_df</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">,</span> <span class="n">motif_width</span><span class="p">)</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_qc</span><span class="p">(</span><span class="n">qc_df</span><span class="p">,</span> <span class="n">peaks_df</span><span class="p">,</span> <span class="n">out_path_qc</span><span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>    <span class="n">out_path_motif_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;motif_data.tsv&quot;</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_motifs_df</span><span class="p">(</span><span class="n">motifs_df</span><span class="p">,</span> <span class="n">out_path_motif_df</span><span class="p">)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>    <span class="n">out_path_motif_cwms</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;motif_cwms.npy&quot;</span><span class="p">)</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_motif_cwms</span><span class="p">(</span><span class="n">cwms</span><span class="p">,</span> <span class="n">out_path_motif_cwms</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>    <span class="n">params</span> <span class="o">|=</span> <span class="p">{</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>        <span class="s2">&quot;region_width&quot;</span><span class="p">:</span> <span class="n">region_width</span><span class="p">,</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="s2">&quot;num_regions&quot;</span><span class="p">:</span> <span class="n">num_regions</span><span class="p">,</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="s2">&quot;untrimmed_motif_width&quot;</span><span class="p">:</span> <span class="n">motif_width</span><span class="p">,</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="s2">&quot;num_motifs&quot;</span><span class="p">:</span> <span class="n">num_motifs</span><span class="p">,</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>    <span class="p">}</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>    <span class="n">out_path_params</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;parameters.json&quot;</span><span class="p">)</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">out_path_params</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="k">def</span><span class="w"> </span><span class="nf">report</span><span class="p">(</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>    <span class="n">regions_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>    <span class="n">hits_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>    <span class="n">modisco_h5_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>    <span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>    <span class="n">motifs_include_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>    <span class="n">motif_names_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>    <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="n">modisco_region_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    <span class="n">cwm_trim_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>    <span class="n">compute_recall</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>    <span class="n">use_seqlets</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate comprehensive HTML report with statistics and visualizations.</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">    This function creates detailed analysis reports comparing Fi-NeMo hit calling</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">    results with TF-MoDISco seqlets, including performance metrics, distribution</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">    plots, and motif visualization. The report provides insights into hit calling</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">    quality and motif discovery accuracy.</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">    Parameters</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">    ----------</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">    regions_path : str</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">        Path to NPZ file containing the same regions used for hit calling.</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a><span class="sd">    hits_dir : str</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">        Path to directory containing Fi-NeMo hit calling outputs.</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">    modisco_h5_path : str, optional</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">        Path to TF-MoDISco H5 file. If None, seqlet comparisons are skipped.</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">    peaks_path : str, optional</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">        DEPRECATED. Peak coordinates should be included in regions file.</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">    motifs_include_path : str, optional</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">        DEPRECATED. This information is inferred from hit calling outputs.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">    motif_names_path : str, optional</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">        DEPRECATED. This information is inferred from hit calling outputs.</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">    out_dir : str</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">        Output directory for report files.</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="sd">    modisco_region_width : int</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="sd">        Width of regions used by TF-MoDISco (needed for coordinate conversion).</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">    cwm_trim_threshold : float</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="sd">        DEPRECATED. This information is inferred from hit calling outputs.</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">    compute_recall : bool</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">        Whether to compute recall metrics against TF-MoDISco seqlets.</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="sd">    use_seqlets : bool</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">        Whether to include seqlet-based comparisons in the report.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">    Notes</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="sd">    -----</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">    The generated report includes:</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">    - Hit vs seqlet count comparisons</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">    - Motif CWM visualizations</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="sd">    - Hit statistic distributions</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="sd">    - Co-occurrence heatmaps</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="sd">    - Confusion matrices for overlapping motifs</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">evaluation</span><span class="p">,</span> <span class="n">visualization</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>    <span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">peaks_df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_regions_npz</span><span class="p">(</span><span class="n">regions_path</span><span class="p">)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contribs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>        <span class="n">regions</span> <span class="o">=</span> <span class="n">contribs</span> <span class="o">*</span> <span class="n">sequences</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">contribs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        <span class="n">regions</span> <span class="o">=</span> <span class="n">contribs</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">sequences</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected contribs shape: </span><span class="si">{</span><span class="n">contribs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>    <span class="n">half_width</span> <span class="o">=</span> <span class="n">regions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>    <span class="n">modisco_half_width</span> <span class="o">=</span> <span class="n">modisco_region_width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>    <span class="k">if</span> <span class="n">peaks_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>            <span class="s2">&quot;Providing a peaks file to `report` is deprecated, and this option will be removed in a future version. Peaks should instead be provided in the preprocessing step to be included in `regions.npz`.&quot;</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_peaks</span><span class="p">(</span><span class="n">peaks_path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>    <span class="k">if</span> <span class="n">hits_dir</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.tsv&quot;</span><span class="p">):</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>            <span class="s2">&quot;Passing a hits.tsv file to `finemo report` is deprecated. Please provide the directory containing the hits.tsv file instead.&quot;</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>        <span class="p">)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>        <span class="n">hits_path</span> <span class="o">=</span> <span class="n">hits_dir</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>        <span class="n">hits_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_hits</span><span class="p">(</span><span class="n">hits_path</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>        <span class="k">if</span> <span class="n">motifs_include_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>            <span class="n">motifs_include</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_txt</span><span class="p">(</span><span class="n">motifs_include_path</span><span class="p">)</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>            <span class="n">motifs_include</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        <span class="k">if</span> <span class="n">motif_names_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>            <span class="n">motif_name_map</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_mapping</span><span class="p">(</span><span class="n">motif_names_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>            <span class="n">motif_name_map</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>        <span class="k">if</span> <span class="n">modisco_h5_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>            <span class="n">motifs_df</span><span class="p">,</span> <span class="n">cwms_modisco</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">motif_names</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_modisco_motifs</span><span class="p">(</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>                <span class="n">modisco_h5_path</span><span class="p">,</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>                <span class="kc">None</span><span class="p">,</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>                <span class="kc">None</span><span class="p">,</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>                <span class="n">cwm_trim_threshold</span><span class="p">,</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>                <span class="s2">&quot;cwm&quot;</span><span class="p">,</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>                <span class="n">motifs_include</span><span class="p">,</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>                <span class="n">motif_name_map</span><span class="p">,</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>                <span class="kc">None</span><span class="p">,</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>                <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>                <span class="kc">True</span><span class="p">,</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>            <span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>            <span class="c1"># When no modisco_h5_path is provided in legacy TSV mode, we can&#39;t compute motifs</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>            <span class="c1"># This will cause an error later, but that&#39;s expected behavior</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>                <span class="s2">&quot;modisco_h5_path is required when providing a hits.tsv file directly&quot;</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>            <span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>        <span class="n">hits_df_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hits_dir</span><span class="p">,</span> <span class="s2">&quot;hits.tsv&quot;</span><span class="p">)</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>        <span class="n">hits_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_hits</span><span class="p">(</span><span class="n">hits_df_path</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="n">motifs_df_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hits_dir</span><span class="p">,</span> <span class="s2">&quot;motif_data.tsv&quot;</span><span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>        <span class="n">motifs_df</span><span class="p">,</span> <span class="n">motif_names</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_motifs_df</span><span class="p">(</span><span class="n">motifs_df_path</span><span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="n">cwms_modisco_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hits_dir</span><span class="p">,</span> <span class="s2">&quot;motif_cwms.npy&quot;</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="n">cwms_modisco</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_motif_cwms</span><span class="p">(</span><span class="n">cwms_modisco_path</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>        <span class="n">params_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hits_dir</span><span class="p">,</span> <span class="s2">&quot;parameters.json&quot;</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_params</span><span class="p">(</span><span class="n">params_path</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>        <span class="n">cwm_trim_threshold</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;cwm_trim_threshold_default&quot;</span><span class="p">]</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_seqlets</span><span class="p">:</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>            <span class="s2">&quot;Usage of the `--no-seqlets` flag is deprecated and will be removed in a future version. Please omit the `--modisco-h5` argument instead.&quot;</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>        <span class="n">seqlets_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>    <span class="k">elif</span> <span class="n">modisco_h5_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="n">compute_recall</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="n">seqlets_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="n">seqlets_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_modisco_seqlets</span><span class="p">(</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>            <span class="n">modisco_h5_path</span><span class="p">,</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>            <span class="n">peaks_df</span><span class="p">,</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>            <span class="n">motifs_df</span><span class="p">,</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>            <span class="n">half_width</span><span class="p">,</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>            <span class="n">modisco_half_width</span><span class="p">,</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>            <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>        <span class="p">)</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>    <span class="n">motif_width</span> <span class="o">=</span> <span class="n">cwms_modisco</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>    <span class="c1"># Convert to LazyFrame if needed and ensure motif_names is a list</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hits_df</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">):</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>        <span class="n">hits_df_lazy</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span> <span class="o">=</span> <span class="n">hits_df</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>        <span class="n">hits_df_lazy</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span> <span class="o">=</span> <span class="n">hits_df</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>    <span class="n">motif_names_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">motif_names</span><span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>    <span class="n">occ_df</span><span class="p">,</span> <span class="n">coooc</span> <span class="o">=</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">get_motif_occurences</span><span class="p">(</span><span class="n">hits_df_lazy</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>    <span class="n">report_data</span><span class="p">,</span> <span class="n">report_df</span><span class="p">,</span> <span class="n">cwms</span><span class="p">,</span> <span class="n">trim_bounds</span> <span class="o">=</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">tfmodisco_comparison</span><span class="p">(</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>        <span class="n">regions</span><span class="p">,</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="n">hits_df</span><span class="p">,</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="n">peaks_df</span><span class="p">,</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="n">seqlets_df</span><span class="p">,</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>        <span class="n">motifs_df</span><span class="p">,</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>        <span class="n">cwms_modisco</span><span class="p">,</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>        <span class="n">motif_names_list</span><span class="p">,</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>        <span class="n">modisco_half_width</span><span class="p">,</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="n">motif_width</span><span class="p">,</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="n">compute_recall</span><span class="p">,</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>    <span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>    <span class="k">if</span> <span class="n">seqlets_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>        <span class="n">confusion_df</span><span class="p">,</span> <span class="n">confusion_mat</span> <span class="o">=</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">seqlet_confusion</span><span class="p">(</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>            <span class="n">hits_df</span><span class="p">,</span> <span class="n">seqlets_df</span><span class="p">,</span> <span class="n">peaks_df</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">,</span> <span class="n">motif_width</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>        <span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>        <span class="n">confusion_df</span><span class="p">,</span> <span class="n">confusion_mat</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>    <span class="n">occ_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;motif_occurrences.tsv&quot;</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_occ_df</span><span class="p">(</span><span class="n">occ_df</span><span class="p">,</span> <span class="n">occ_path</span><span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_report_data</span><span class="p">(</span><span class="n">report_df</span><span class="p">,</span> <span class="n">cwms</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>    <span class="n">visualization</span><span class="o">.</span><span class="n">plot_hit_stat_distributions</span><span class="p">(</span><span class="n">hits_df_lazy</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>    <span class="n">visualization</span><span class="o">.</span><span class="n">plot_hit_peak_distributions</span><span class="p">(</span><span class="n">occ_df</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>    <span class="n">visualization</span><span class="o">.</span><span class="n">plot_peak_motif_indicator_heatmap</span><span class="p">(</span><span class="n">coooc</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>    <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;CWMs&quot;</span><span class="p">)</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>    <span class="n">visualization</span><span class="o">.</span><span class="n">plot_cwms</span><span class="p">(</span><span class="n">cwms</span><span class="p">,</span> <span class="n">trim_bounds</span><span class="p">,</span> <span class="n">plot_dir</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>    <span class="k">if</span> <span class="n">seqlets_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="n">seqlets_collected</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>            <span class="n">seqlets_df</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seqlets_df</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">seqlets_df</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>        <span class="p">)</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>        <span class="n">seqlets_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;seqlets.tsv&quot;</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>        <span class="n">data_io</span><span class="o">.</span><span class="n">write_modisco_seqlets</span><span class="p">(</span><span class="n">seqlets_collected</span><span class="p">,</span> <span class="n">seqlets_path</span><span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>        <span class="k">if</span> <span class="n">confusion_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">confusion_mat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>            <span class="n">seqlet_confusion_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;seqlet_confusion.tsv&quot;</span><span class="p">)</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>            <span class="n">data_io</span><span class="o">.</span><span class="n">write_seqlet_confusion_df</span><span class="p">(</span><span class="n">confusion_df</span><span class="p">,</span> <span class="n">seqlet_confusion_path</span><span class="p">)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>            <span class="n">visualization</span><span class="o">.</span><span class="n">plot_hit_vs_seqlet_counts</span><span class="p">(</span><span class="n">report_data</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>            <span class="n">visualization</span><span class="o">.</span><span class="n">plot_seqlet_confusion_heatmap</span><span class="p">(</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>                <span class="n">confusion_mat</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">,</span> <span class="n">out_dir</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>            <span class="p">)</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>    <span class="n">report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;report.html&quot;</span><span class="p">)</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>    <span class="n">visualization</span><span class="o">.</span><span class="n">write_report</span><span class="p">(</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>        <span class="n">report_df</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">,</span> <span class="n">report_path</span><span class="p">,</span> <span class="n">compute_recall</span><span class="p">,</span> <span class="n">seqlets_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>    <span class="p">)</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="k">def</span><span class="w"> </span><span class="nf">collapse_hits</span><span class="p">(</span><span class="n">hits_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">overlap_frac</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Collapse overlapping hits by selecting the best hit per overlapping group.</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a><span class="sd">    This function processes a set of motif hits and identifies overlapping hits,</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a><span class="sd">    keeping only the hit with the highest similarity score within each overlapping</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a><span class="sd">    group. This reduces redundancy in hit calls while preserving the most confident</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a><span class="sd">    predictions.</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">    Parameters</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a><span class="sd">    ----------</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="sd">    hits_path : str</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">        Path to input TSV file containing hit data (hits.tsv or hits_unique.tsv).</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a><span class="sd">    out_path : str</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">        Path to output TSV file with additional &#39;is_primary&#39; column.</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="sd">    overlap_frac : float</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">        Minimum fractional overlap for considering hits as overlapping.</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a><span class="sd">        For hits of lengths x and y, minimum overlap = overlap_frac * (x + y) / 2.</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="sd">    Notes</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">    -----</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">    The algorithm uses a sweep line approach with a heap data structure to</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a><span class="sd">    efficiently identify overlapping intervals and select the best hit based</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">    on similarity scores.</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">postprocessing</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>    <span class="n">hits_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_hits</span><span class="p">(</span><span class="n">hits_path</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>    <span class="n">hits_collapsed_df</span> <span class="o">=</span> <span class="n">postprocessing</span><span class="o">.</span><span class="n">collapse_hits</span><span class="p">(</span><span class="n">hits_df</span><span class="p">,</span> <span class="n">overlap_frac</span><span class="p">)</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_hits_processed</span><span class="p">(</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="n">hits_collapsed_df</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">data_io</span><span class="o">.</span><span class="n">HITS_COLLAPSED_DTYPES</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>    <span class="p">)</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="k">def</span><span class="w"> </span><span class="nf">intersect_hits</span><span class="p">(</span><span class="n">hits_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">relaxed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find intersection of hits across multiple Fi-NeMo runs.</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">    This function identifies motif hits that are consistently called across</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">    multiple independent runs, providing a way to assess reproducibility and</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">    identify high-confidence hits.</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">    Parameters</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">    ----------</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">    hits_paths : List[str]</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">        List of paths to input TSV files from different runs.</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">    out_path : str</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">        Path to output TSV file containing intersection results.</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a><span class="sd">        Duplicate columns are suffixed with run index.</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a><span class="sd">    relaxed : bool</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="sd">        If True, uses relaxed intersection criteria based only on motif names</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a><span class="sd">        and untrimmed coordinates. If False, assumes consistent region definitions</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a><span class="sd">        and motif trimming across runs.</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a><span class="sd">    Notes</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a><span class="sd">    -----</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="sd">    The strict intersection mode requires consistent input regions and motif</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">    processing parameters across all runs. The relaxed mode is more permissive</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">    but may not be suitable when genomic coordinates are unavailable.</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">postprocessing</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>    <span class="n">hits_dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_hits</span><span class="p">(</span><span class="n">hits_path</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">hits_path</span> <span class="ow">in</span> <span class="n">hits_paths</span><span class="p">]</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>    <span class="n">hits_df</span> <span class="o">=</span> <span class="n">postprocessing</span><span class="o">.</span><span class="n">intersect_hits</span><span class="p">(</span><span class="n">hits_dfs</span><span class="p">,</span> <span class="n">relaxed</span><span class="p">)</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_hits_processed</span><span class="p">(</span><span class="n">hits_df</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="k">def</span><span class="w"> </span><span class="nf">cli</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Command-line interface for the Fi-NeMo motif instance calling pipeline.</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">    This function provides the main entry point for all Fi-NeMo operations including:</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a><span class="sd">    - Data preprocessing from various formats (bigWig, HDF5, TF-MoDISco)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">    - Motif hit calling using the Fi-NeMo algorithm</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">    - Report generation and visualization</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">    - Post-processing operations (hit collapsing, intersection)</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">    The CLI supports comprehensive workflows for transcription factor motif</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="sd">    analysis from raw genomic data to publication-ready visualizations.</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>    <span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;cmd&quot;</span><span class="p">)</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>    <span class="n">extract_regions_bw_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        <span class="s2">&quot;extract-regions-bw&quot;</span><span class="p">,</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Extract sequences and contributions from FASTA and bigwig files.&quot;</span><span class="p">,</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>    <span class="p">)</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>    <span class="n">extract_regions_bw_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A peak regions file in ENCODE NarrowPeak format.&quot;</span><span class="p">,</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>    <span class="p">)</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>    <span class="n">extract_regions_bw_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>        <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>        <span class="s2">&quot;--chrom-order&quot;</span><span class="p">,</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with chromosome names in the first column to define sort order of chromosomes. Missing chromosomes are ordered as they appear in -p/--peaks.&quot;</span><span class="p">,</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>    <span class="p">)</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>    <span class="n">extract_regions_bw_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>        <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="s2">&quot;--fasta&quot;</span><span class="p">,</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A genome FASTA file. If an .fai index file doesn&#39;t exist in the same directory, it will be created.&quot;</span><span class="p">,</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>    <span class="p">)</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>    <span class="n">extract_regions_bw_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>        <span class="s2">&quot;-b&quot;</span><span class="p">,</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>        <span class="s2">&quot;--bigwigs&quot;</span><span class="p">,</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;One or more bigwig files of contribution scores, with paths delimited by whitespace. Scores are averaged across files.&quot;</span><span class="p">,</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>    <span class="p">)</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>    <span class="n">extract_regions_bw_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output .npz file.&quot;</span><span class="p">,</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>    <span class="p">)</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>    <span class="n">extract_regions_bw_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>        <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>        <span class="s2">&quot;--region-width&quot;</span><span class="p">,</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The width of the input region centered around each peak summit.&quot;</span><span class="p">,</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>    <span class="p">)</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>    <span class="n">extract_chrombpnet_regions_h5_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="s2">&quot;extract-regions-chrombpnet-h5&quot;</span><span class="p">,</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Extract sequences and contributions from ChromBPNet contributions H5 files.&quot;</span><span class="p">,</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>    <span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>    <span class="n">extract_chrombpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A peak regions file in ENCODE NarrowPeak format. If omitted, downstream outputs will lack absolute genomic coordinates.&quot;</span><span class="p">,</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>    <span class="p">)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>    <span class="n">extract_chrombpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>        <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>        <span class="s2">&quot;--chrom-order&quot;</span><span class="p">,</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with chromosome names in the first column to define sort order of chromosomes. Missing chromosomes are ordered as they appear in -p/--peaks.&quot;</span><span class="p">,</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>    <span class="p">)</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>    <span class="n">extract_chrombpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>        <span class="s2">&quot;--h5s&quot;</span><span class="p">,</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;One or more H5 files of contribution scores, with paths delimited by whitespace. Scores are averaged across files.&quot;</span><span class="p">,</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>    <span class="p">)</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>    <span class="n">extract_chrombpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output .npz file.&quot;</span><span class="p">,</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>    <span class="p">)</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>    <span class="n">extract_chrombpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>        <span class="s2">&quot;--region-width&quot;</span><span class="p">,</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The width of the input region centered around each peak summit.&quot;</span><span class="p">,</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>    <span class="p">)</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>    <span class="n">extract_regions_h5_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>        <span class="s2">&quot;extract-regions-h5&quot;</span><span class="p">,</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Extract sequences and contributions from ChromBPNet contributions H5 files. DEPRECATED: Use `extract-regions-chrombpnet-h5` instead.&quot;</span><span class="p">,</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>    <span class="p">)</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>    <span class="n">extract_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A peak regions file in ENCODE NarrowPeak format. If omitted, downstream outputs will lack absolute genomic coordinates.&quot;</span><span class="p">,</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>    <span class="p">)</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>    <span class="n">extract_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>        <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>        <span class="s2">&quot;--chrom-order&quot;</span><span class="p">,</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with chromosome names in the first column to define sort order of chromosomes. Missing chromosomes are ordered as they appear in -p/--peaks.&quot;</span><span class="p">,</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>    <span class="p">)</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>    <span class="n">extract_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>        <span class="s2">&quot;--h5s&quot;</span><span class="p">,</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;One or more H5 files of contribution scores, with paths delimited by whitespace. Scores are averaged across files.&quot;</span><span class="p">,</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>    <span class="p">)</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>    <span class="n">extract_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output .npz file.&quot;</span><span class="p">,</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>    <span class="p">)</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>    <span class="n">extract_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>        <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>        <span class="s2">&quot;--region-width&quot;</span><span class="p">,</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The width of the input region centered around each peak summit.&quot;</span><span class="p">,</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>    <span class="p">)</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>    <span class="n">extract_bpnet_regions_h5_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>        <span class="s2">&quot;extract-regions-bpnet-h5&quot;</span><span class="p">,</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Extract sequences and contributions from BPNet contributions H5 files.&quot;</span><span class="p">,</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>    <span class="p">)</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>    <span class="n">extract_bpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A peak regions file in ENCODE NarrowPeak format. If omitted, downstream outputs will lack absolute genomic coordinates.&quot;</span><span class="p">,</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>    <span class="p">)</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>    <span class="n">extract_bpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>        <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>        <span class="s2">&quot;--chrom-order&quot;</span><span class="p">,</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with chromosome names in the first column to define sort order of chromosomes. Missing chromosomes are ordered as they appear in -p/--peaks.&quot;</span><span class="p">,</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>    <span class="p">)</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>    <span class="n">extract_bpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>        <span class="s2">&quot;--h5s&quot;</span><span class="p">,</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;One or more H5 files of contribution scores, with paths delimited by whitespace. Scores are averaged across files.&quot;</span><span class="p">,</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>    <span class="p">)</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>    <span class="n">extract_bpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output .npz file.&quot;</span><span class="p">,</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>    <span class="p">)</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>    <span class="n">extract_bpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>        <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>        <span class="s2">&quot;--region-width&quot;</span><span class="p">,</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The width of the input region centered around each peak summit.&quot;</span><span class="p">,</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>    <span class="p">)</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>        <span class="s2">&quot;extract-regions-modisco-fmt&quot;</span><span class="p">,</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Extract sequences and contributions from tfmodisco-lite input files.&quot;</span><span class="p">,</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>    <span class="p">)</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A peak regions file in ENCODE NarrowPeak format. If omitted, downstream outputs will lack absolute genomic coordinates.&quot;</span><span class="p">,</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>    <span class="p">)</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>        <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>        <span class="s2">&quot;--chrom-order&quot;</span><span class="p">,</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with chromosome names in the first column to define sort order of chromosomes. Missing chromosomes are ordered as they appear in -p/--peaks.&quot;</span><span class="p">,</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>    <span class="p">)</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>        <span class="s2">&quot;--sequences&quot;</span><span class="p">,</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A .npy or .npz file containing one-hot encoded sequences.&quot;</span><span class="p">,</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>    <span class="p">)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>        <span class="s2">&quot;-a&quot;</span><span class="p">,</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>        <span class="s2">&quot;--attributions&quot;</span><span class="p">,</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;One or more .npy or .npz files of hypothetical contribution scores, with paths delimited by whitespace. Scores are averaged across files.&quot;</span><span class="p">,</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>    <span class="p">)</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output .npz file.&quot;</span><span class="p">,</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>    <span class="p">)</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>        <span class="s2">&quot;--region-width&quot;</span><span class="p">,</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The width of the input region centered around each peak summit.&quot;</span><span class="p">,</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>    <span class="p">)</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>    <span class="n">call_hits_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        <span class="s2">&quot;call-hits&quot;</span><span class="p">,</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Call hits on provided sequences, contributions, and motif CWM&#39;s.&quot;</span><span class="p">,</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>    <span class="p">)</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>        <span class="s2">&quot;-M&quot;</span><span class="p">,</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="s2">&quot;--mode&quot;</span><span class="p">,</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;pp&quot;</span><span class="p">,</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>        <span class="n">choices</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pp&quot;</span><span class="p">,</span> <span class="s2">&quot;ph&quot;</span><span class="p">,</span> <span class="s2">&quot;hp&quot;</span><span class="p">,</span> <span class="s2">&quot;hh&quot;</span><span class="p">},</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The type of attributions to use for CWM&#39;s and input contribution scores, respectively. &#39;h&#39; for hypothetical and &#39;p&#39; for projected.&quot;</span><span class="p">,</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>    <span class="p">)</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="s2">&quot;--regions&quot;</span><span class="p">,</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A .npz file of input sequences, contributions, and coordinates. Can be generated using `finemo extract-regions-*` subcommands.&quot;</span><span class="p">,</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>    <span class="p">)</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>        <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>        <span class="s2">&quot;--modisco-h5&quot;</span><span class="p">,</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tfmodisco-lite output H5 file of motif patterns.&quot;</span><span class="p">,</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>    <span class="p">)</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please provide this file to a preprocessing `finemo extract-regions-*` subcommand instead.&quot;</span><span class="p">,</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>    <span class="p">)</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>        <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>        <span class="s2">&quot;--chrom-order&quot;</span><span class="p">,</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please provide this file to a preprocessing `finemo extract-regions-*` subcommand instead.&quot;</span><span class="p">,</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>    <span class="p">)</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>        <span class="s2">&quot;-I&quot;</span><span class="p">,</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>        <span class="s2">&quot;--motifs-include&quot;</span><span class="p">,</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with tfmodisco motif names (e.g pos_patterns.pattern_0) in the first column to include in hit calling. If omitted, all motifs in the modisco H5 file are used.&quot;</span><span class="p">,</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>    <span class="p">)</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="s2">&quot;-N&quot;</span><span class="p">,</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="s2">&quot;--motif-names&quot;</span><span class="p">,</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with tfmodisco motif names (e.g pos_patterns.pattern_0) in the first column and custom names in the second column. Omitted motifs default to tfmodisco names.&quot;</span><span class="p">,</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>    <span class="p">)</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>        <span class="s2">&quot;--out-dir&quot;</span><span class="p">,</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output directory.&quot;</span><span class="p">,</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>    <span class="p">)</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>        <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>        <span class="s2">&quot;--cwm-trim-threshold&quot;</span><span class="p">,</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The default threshold to determine motif start and end positions within the full CWMs.&quot;</span><span class="p">,</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>    <span class="p">)</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="s2">&quot;-T&quot;</span><span class="p">,</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>        <span class="s2">&quot;--cwm-trim-thresholds&quot;</span><span class="p">,</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with tfmodisco motif names (e.g pos_patterns.pattern_0) in the first column and custom trim thresholds in the second column. Omitted motifs default to the `--cwm-trim-threshold` value.&quot;</span><span class="p">,</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>    <span class="p">)</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>        <span class="s2">&quot;-R&quot;</span><span class="p">,</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="s2">&quot;--cwm-trim-coords&quot;</span><span class="p">,</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with tfmodisco motif names (e.g pos_patterns.pattern_0) in the first column and custom trim start and end coordinates in the second and third columns, respectively. Omitted motifs default to `--cwm-trim-thresholds` values.&quot;</span><span class="p">,</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>    <span class="p">)</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="s2">&quot;-l&quot;</span><span class="p">,</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>        <span class="s2">&quot;--global-lambda&quot;</span><span class="p">,</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The default L1 regularization weight determining the sparsity of hits.&quot;</span><span class="p">,</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>    <span class="p">)</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>        <span class="s2">&quot;-L&quot;</span><span class="p">,</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>        <span class="s2">&quot;--motif-lambdas&quot;</span><span class="p">,</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with tfmodisco motif names (e.g pos_patterns.pattern_0) in the first column and motif-specific lambdas in the second column. Omitted motifs default to the `--global-lambda` value.&quot;</span><span class="p">,</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>    <span class="p">)</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>        <span class="s2">&quot;-a&quot;</span><span class="p">,</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>        <span class="s2">&quot;--alpha&quot;</span><span class="p">,</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please use the `--lambda` argument instead.&quot;</span><span class="p">,</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>    <span class="p">)</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="s2">&quot;-A&quot;</span><span class="p">,</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>        <span class="s2">&quot;--motif-alphas&quot;</span><span class="p">,</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please use the `--motif-lambdas` argument instead.&quot;</span><span class="p">,</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>    <span class="p">)</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>        <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>        <span class="s2">&quot;--no-post-filter&quot;</span><span class="p">,</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not perform post-hit-calling filtering. By default, hits are filtered based on a minimum cosine similarity of `lambda` with the input contributions.&quot;</span><span class="p">,</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>    <span class="p">)</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>        <span class="s2">&quot;-q&quot;</span><span class="p">,</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>        <span class="s2">&quot;--sqrt-transform&quot;</span><span class="p">,</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Apply a signed square root transform to the input contributions and CWMs before hit calling.&quot;</span><span class="p">,</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>    <span class="p">)</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>        <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>        <span class="s2">&quot;--step-size-max&quot;</span><span class="p">,</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The maximum optimizer step size.&quot;</span><span class="p">,</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>    <span class="p">)</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>        <span class="s2">&quot;--step-size-min&quot;</span><span class="p">,</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The minimum optimizer step size.&quot;</span><span class="p">,</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>    <span class="p">)</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>        <span class="s2">&quot;-j&quot;</span><span class="p">,</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>        <span class="s2">&quot;--step-adjust&quot;</span><span class="p">,</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The optimizer step size adjustment factor. If the optimizer diverges, the step size is multiplicatively adjusted by this factor&quot;</span><span class="p">,</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>    <span class="p">)</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="s2">&quot;--convergence-tol&quot;</span><span class="p">,</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The tolerance for determining convergence. The optimizer exits when the duality gap is less than the tolerance.&quot;</span><span class="p">,</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>    <span class="p">)</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>        <span class="s2">&quot;-S&quot;</span><span class="p">,</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>        <span class="s2">&quot;--max-steps&quot;</span><span class="p">,</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The maximum number of optimization steps.&quot;</span><span class="p">,</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>    <span class="p">)</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>        <span class="s2">&quot;-b&quot;</span><span class="p">,</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>        <span class="s2">&quot;--batch-size&quot;</span><span class="p">,</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The batch size used for optimization.&quot;</span><span class="p">,</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>    <span class="p">)</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>        <span class="s2">&quot;-d&quot;</span><span class="p">,</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>        <span class="s2">&quot;--device&quot;</span><span class="p">,</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please use the `CUDA_VISIBLE_DEVICES` environment variable to specify the GPU device.&quot;</span><span class="p">,</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>    <span class="p">)</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>        <span class="s2">&quot;-J&quot;</span><span class="p">,</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>        <span class="s2">&quot;--compile&quot;</span><span class="p">,</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;JIT-compile the optimizer for faster performance. This may not be supported on older GPUs.&quot;</span><span class="p">,</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>    <span class="p">)</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>    <span class="n">report_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>        <span class="s2">&quot;report&quot;</span><span class="p">,</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generate statistics and visualizations from hits and tfmodisco-lite motif data.&quot;</span><span class="p">,</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>    <span class="p">)</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>        <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>        <span class="s2">&quot;--regions&quot;</span><span class="p">,</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A .npz file containing input sequences, contributions, and coordinates. Must be the same as that used for `finemo call-hits`.&quot;</span><span class="p">,</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>    <span class="p">)</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>        <span class="s2">&quot;-H&quot;</span><span class="p">,</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>        <span class="s2">&quot;--hits&quot;</span><span class="p">,</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The output directory generated by the `finemo call-hits` command on the regions specified in `--regions`.&quot;</span><span class="p">,</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>    <span class="p">)</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please provide this file to a preprocessing `finemo extract-regions-*` subcommand instead.&quot;</span><span class="p">,</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>    <span class="p">)</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>        <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>        <span class="s2">&quot;--modisco-h5&quot;</span><span class="p">,</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The tfmodisco-lite output H5 file of motif patterns. Must be the same as that used for hit calling unless `--no-recall` is set. If omitted, seqlet-derived metrics will not be computed.&quot;</span><span class="p">,</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>    <span class="p">)</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>        <span class="s2">&quot;-I&quot;</span><span class="p">,</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>        <span class="s2">&quot;--motifs-include&quot;</span><span class="p">,</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: This information is now inferred from the outputs of `finemo call-hits`.&quot;</span><span class="p">,</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>    <span class="p">)</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>        <span class="s2">&quot;-N&quot;</span><span class="p">,</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>        <span class="s2">&quot;--motif-names&quot;</span><span class="p">,</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: This information is now inferred from the outputs of `finemo call-hits`.&quot;</span><span class="p">,</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>    <span class="p">)</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>        <span class="s2">&quot;--out-dir&quot;</span><span class="p">,</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the report output directory.&quot;</span><span class="p">,</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>    <span class="p">)</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>        <span class="s2">&quot;-W&quot;</span><span class="p">,</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>        <span class="s2">&quot;--modisco-region-width&quot;</span><span class="p">,</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The width of the region around each peak summit used by tfmodisco-lite.&quot;</span><span class="p">,</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>    <span class="p">)</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>        <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>        <span class="s2">&quot;--cwm-trim-threshold&quot;</span><span class="p">,</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: This information is now inferred from the outputs of `finemo call-hits`.&quot;</span><span class="p">,</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>    <span class="p">)</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>        <span class="s2">&quot;-n&quot;</span><span class="p">,</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="s2">&quot;--no-recall&quot;</span><span class="p">,</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not compute motif recall metrics.&quot;</span><span class="p">,</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>    <span class="p">)</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>        <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>        <span class="s2">&quot;--no-seqlets&quot;</span><span class="p">,</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please omit the `--modisco-h5` argument instead.&quot;</span><span class="p">,</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>    <span class="p">)</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>    <span class="n">collapse_hits_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>        <span class="s2">&quot;collapse-hits&quot;</span><span class="p">,</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Identify best hit by motif similarity among sets of overlapping hits.&quot;</span><span class="p">,</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>    <span class="p">)</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>    <span class="n">collapse_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>        <span class="s2">&quot;--hits&quot;</span><span class="p">,</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The `hits.tsv` or `hits_unique.tsv` file from `call-hits`.&quot;</span><span class="p">,</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>    <span class="p">)</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>    <span class="n">collapse_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The path to the output .tsv file with an additional &quot;is_primary&quot; column.&#39;</span><span class="p">,</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>    <span class="p">)</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>    <span class="n">collapse_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>        <span class="s2">&quot;-O&quot;</span><span class="p">,</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>        <span class="s2">&quot;--overlap-frac&quot;</span><span class="p">,</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The threshold for determining overlapping hits. For two hits with lengths x and y, the minimum overlap is defined as `overlap_frac * (x + y) / 2`. The default value of 0.2 means that two hits must overlap by at least 20</span><span class="si">% o</span><span class="s2">f their average lengths to be considered overlapping.&quot;</span><span class="p">,</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>    <span class="p">)</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>    <span class="n">intersect_hits_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>        <span class="s2">&quot;intersect-hits&quot;</span><span class="p">,</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Intersect hits across multiple runs.&quot;</span><span class="p">,</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>    <span class="p">)</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>    <span class="n">intersect_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>        <span class="s2">&quot;--hits&quot;</span><span class="p">,</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;One or more hits.tsv or hits_unique.tsv files, with paths delimited by whitespace.&quot;</span><span class="p">,</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>    <span class="p">)</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>    <span class="n">intersect_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output .tsv file. Duplicate columns are suffixed with the positional index of the input file.&quot;</span><span class="p">,</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>    <span class="p">)</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>    <span class="n">intersect_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>        <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>        <span class="s2">&quot;--relaxed&quot;</span><span class="p">,</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use relaxed intersection criteria, using only motif names and untrimmed coordinates. By default, the intersection assumes consistent region definitions and motif trimming. This option is not recommended if genomic coordinates are unavailable.&quot;</span><span class="p">,</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>    <span class="p">)</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;extract-regions-bw&quot;</span><span class="p">:</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>        <span class="n">extract_regions_bw</span><span class="p">(</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">chrom_order</span><span class="p">,</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">fasta</span><span class="p">,</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">bigwigs</span><span class="p">,</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">region_width</span><span class="p">,</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>        <span class="p">)</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;extract-regions-chrombpnet-h5&quot;</span><span class="p">:</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>        <span class="n">extract_regions_chrombpnet_h5</span><span class="p">(</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">chrom_order</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">h5s</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">region_width</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>        <span class="p">)</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;extract-regions-h5&quot;</span><span class="p">:</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>            <span class="s2">&quot;WARNING: The `extract-regions-h5` command is deprecated. Use `extract-regions-chrombpnet-h5` instead.&quot;</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>        <span class="p">)</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>        <span class="n">extract_regions_chrombpnet_h5</span><span class="p">(</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">chrom_order</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">h5s</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">region_width</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>        <span class="p">)</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;extract-regions-bpnet-h5&quot;</span><span class="p">:</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>        <span class="n">extract_regions_bpnet_h5</span><span class="p">(</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">chrom_order</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">h5s</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">region_width</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>        <span class="p">)</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;extract-regions-modisco-fmt&quot;</span><span class="p">:</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="n">extract_regions_modisco_fmt</span><span class="p">(</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">chrom_order</span><span class="p">,</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">attributions</span><span class="p">,</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">region_width</span><span class="p">,</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>        <span class="p">)</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;call-hits&quot;</span><span class="p">:</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>                <span class="s2">&quot;The `--alpha` flag is deprecated and will be removed in a future version. Please use the `--global-lambda` flag instead.&quot;</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>            <span class="p">)</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">global_lambda</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">alpha</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">motif_alphas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>                <span class="s2">&quot;The `--motif-alphas` flag is deprecated and will be removed in a future version. Please use the `--motif-lambdas` flag instead.&quot;</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>            <span class="p">)</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">motif_lambdas</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">motif_alphas</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>        <span class="n">call_hits</span><span class="p">(</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">regions</span><span class="p">,</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">modisco_h5</span><span class="p">,</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">chrom_order</span><span class="p">,</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">motifs_include</span><span class="p">,</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">motif_names</span><span class="p">,</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">motif_lambdas</span><span class="p">,</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">cwm_trim_coords</span><span class="p">,</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">cwm_trim_thresholds</span><span class="p">,</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">cwm_trim_threshold</span><span class="p">,</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">global_lambda</span><span class="p">,</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">step_size_max</span><span class="p">,</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">step_size_min</span><span class="p">,</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">sqrt_transform</span><span class="p">,</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">convergence_tol</span><span class="p">,</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">max_steps</span><span class="p">,</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">step_adjust</span><span class="p">,</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">no_post_filter</span><span class="p">,</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">compile</span><span class="p">,</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>        <span class="p">)</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;report&quot;</span><span class="p">:</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">no_recall</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">no_seqlets</span><span class="p">:</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>                <span class="s2">&quot;The `--no-seqlets` flag must be set in conjunction with `--no-recall`.&quot;</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>            <span class="p">)</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>        <span class="n">report</span><span class="p">(</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">regions</span><span class="p">,</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">hits</span><span class="p">,</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">modisco_h5</span><span class="p">,</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">motifs_include</span><span class="p">,</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">motif_names</span><span class="p">,</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">modisco_region_width</span><span class="p">,</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">cwm_trim_threshold</span><span class="p">,</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>            <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">no_recall</span><span class="p">,</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>            <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">no_seqlets</span><span class="p">,</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>        <span class="p">)</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;collapse-hits&quot;</span><span class="p">:</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>        <span class="n">collapse_hits</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">hits</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">overlap_frac</span><span class="p">)</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;intersect-hits&quot;</span><span class="p">:</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>        <span class="n">intersect_hits</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">hits</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">relaxed</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="extract_regions_bw">
                            <input id="extract_regions_bw-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_regions_bw</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">peaks_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">fa_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">bw_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">region_width</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="extract_regions_bw-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#extract_regions_bw"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="extract_regions_bw-24"><a href="#extract_regions_bw-24"><span class="linenos">24</span></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_regions_bw</span><span class="p">(</span>
</span><span id="extract_regions_bw-25"><a href="#extract_regions_bw-25"><span class="linenos">25</span></a>    <span class="n">peaks_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="extract_regions_bw-26"><a href="#extract_regions_bw-26"><span class="linenos">26</span></a>    <span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="extract_regions_bw-27"><a href="#extract_regions_bw-27"><span class="linenos">27</span></a>    <span class="n">fa_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="extract_regions_bw-28"><a href="#extract_regions_bw-28"><span class="linenos">28</span></a>    <span class="n">bw_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="extract_regions_bw-29"><a href="#extract_regions_bw-29"><span class="linenos">29</span></a>    <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="extract_regions_bw-30"><a href="#extract_regions_bw-30"><span class="linenos">30</span></a>    <span class="n">region_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="extract_regions_bw-31"><a href="#extract_regions_bw-31"><span class="linenos">31</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="extract_regions_bw-32"><a href="#extract_regions_bw-32"><span class="linenos">32</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract genomic regions and contribution scores from bigWig and FASTA files.</span>
</span><span id="extract_regions_bw-33"><a href="#extract_regions_bw-33"><span class="linenos">33</span></a>
</span><span id="extract_regions_bw-34"><a href="#extract_regions_bw-34"><span class="linenos">34</span></a><span class="sd">    Parameters</span>
</span><span id="extract_regions_bw-35"><a href="#extract_regions_bw-35"><span class="linenos">35</span></a><span class="sd">    ----------</span>
</span><span id="extract_regions_bw-36"><a href="#extract_regions_bw-36"><span class="linenos">36</span></a><span class="sd">    peaks_path : str</span>
</span><span id="extract_regions_bw-37"><a href="#extract_regions_bw-37"><span class="linenos">37</span></a><span class="sd">        Path to ENCODE NarrowPeak format file.</span>
</span><span id="extract_regions_bw-38"><a href="#extract_regions_bw-38"><span class="linenos">38</span></a><span class="sd">    chrom_order_path : str, optional</span>
</span><span id="extract_regions_bw-39"><a href="#extract_regions_bw-39"><span class="linenos">39</span></a><span class="sd">        Path to chromosome ordering file.</span>
</span><span id="extract_regions_bw-40"><a href="#extract_regions_bw-40"><span class="linenos">40</span></a><span class="sd">    fa_path : str</span>
</span><span id="extract_regions_bw-41"><a href="#extract_regions_bw-41"><span class="linenos">41</span></a><span class="sd">        Path to genome FASTA file.</span>
</span><span id="extract_regions_bw-42"><a href="#extract_regions_bw-42"><span class="linenos">42</span></a><span class="sd">    bw_paths : List[str]</span>
</span><span id="extract_regions_bw-43"><a href="#extract_regions_bw-43"><span class="linenos">43</span></a><span class="sd">        List of bigWig file paths containing contribution scores.</span>
</span><span id="extract_regions_bw-44"><a href="#extract_regions_bw-44"><span class="linenos">44</span></a><span class="sd">    out_path : str</span>
</span><span id="extract_regions_bw-45"><a href="#extract_regions_bw-45"><span class="linenos">45</span></a><span class="sd">        Output path for NPZ file.</span>
</span><span id="extract_regions_bw-46"><a href="#extract_regions_bw-46"><span class="linenos">46</span></a><span class="sd">    region_width : int</span>
</span><span id="extract_regions_bw-47"><a href="#extract_regions_bw-47"><span class="linenos">47</span></a><span class="sd">        Width of regions to extract around peak summits.</span>
</span><span id="extract_regions_bw-48"><a href="#extract_regions_bw-48"><span class="linenos">48</span></a>
</span><span id="extract_regions_bw-49"><a href="#extract_regions_bw-49"><span class="linenos">49</span></a><span class="sd">    Notes</span>
</span><span id="extract_regions_bw-50"><a href="#extract_regions_bw-50"><span class="linenos">50</span></a><span class="sd">    -----</span>
</span><span id="extract_regions_bw-51"><a href="#extract_regions_bw-51"><span class="linenos">51</span></a><span class="sd">    BigWig files only provide projected contribution scores.</span>
</span><span id="extract_regions_bw-52"><a href="#extract_regions_bw-52"><span class="linenos">52</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="extract_regions_bw-53"><a href="#extract_regions_bw-53"><span class="linenos">53</span></a>    <span class="n">half_width</span> <span class="o">=</span> <span class="n">region_width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="extract_regions_bw-54"><a href="#extract_regions_bw-54"><span class="linenos">54</span></a>
</span><span id="extract_regions_bw-55"><a href="#extract_regions_bw-55"><span class="linenos">55</span></a>    <span class="c1"># Load peak regions and extract sequences/contributions</span>
</span><span id="extract_regions_bw-56"><a href="#extract_regions_bw-56"><span class="linenos">56</span></a>    <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_peaks</span><span class="p">(</span><span class="n">peaks_path</span><span class="p">,</span> <span class="n">chrom_order_path</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="extract_regions_bw-57"><a href="#extract_regions_bw-57"><span class="linenos">57</span></a>    <span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_regions_from_bw</span><span class="p">(</span>
</span><span id="extract_regions_bw-58"><a href="#extract_regions_bw-58"><span class="linenos">58</span></a>        <span class="n">peaks_df</span><span class="p">,</span> <span class="n">fa_path</span><span class="p">,</span> <span class="n">bw_paths</span><span class="p">,</span> <span class="n">half_width</span>
</span><span id="extract_regions_bw-59"><a href="#extract_regions_bw-59"><span class="linenos">59</span></a>    <span class="p">)</span>
</span><span id="extract_regions_bw-60"><a href="#extract_regions_bw-60"><span class="linenos">60</span></a>
</span><span id="extract_regions_bw-61"><a href="#extract_regions_bw-61"><span class="linenos">61</span></a>    <span class="c1"># Save processed data to NPZ format</span>
</span><span id="extract_regions_bw-62"><a href="#extract_regions_bw-62"><span class="linenos">62</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_regions_npz</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">peaks_df</span><span class="o">=</span><span class="n">peaks_df</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extract genomic regions and contribution scores from bigWig and FASTA files.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>peaks_path</strong> (str):
Path to ENCODE NarrowPeak format file.</li>
<li><strong>chrom_order_path</strong> (str, optional):
Path to chromosome ordering file.</li>
<li><strong>fa_path</strong> (str):
Path to genome FASTA file.</li>
<li><strong>bw_paths</strong> (List[str]):
List of bigWig file paths containing contribution scores.</li>
<li><strong>out_path</strong> (str):
Output path for NPZ file.</li>
<li><strong>region_width</strong> (int):
Width of regions to extract around peak summits.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>BigWig files only provide projected contribution scores.</p>
</div>


                </section>
                <section id="extract_regions_chrombpnet_h5">
                            <input id="extract_regions_chrombpnet_h5-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_regions_chrombpnet_h5</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">h5_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">region_width</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="extract_regions_chrombpnet_h5-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#extract_regions_chrombpnet_h5"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="extract_regions_chrombpnet_h5-65"><a href="#extract_regions_chrombpnet_h5-65"><span class="linenos">65</span></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_regions_chrombpnet_h5</span><span class="p">(</span>
</span><span id="extract_regions_chrombpnet_h5-66"><a href="#extract_regions_chrombpnet_h5-66"><span class="linenos">66</span></a>    <span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="extract_regions_chrombpnet_h5-67"><a href="#extract_regions_chrombpnet_h5-67"><span class="linenos">67</span></a>    <span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="extract_regions_chrombpnet_h5-68"><a href="#extract_regions_chrombpnet_h5-68"><span class="linenos">68</span></a>    <span class="n">h5_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="extract_regions_chrombpnet_h5-69"><a href="#extract_regions_chrombpnet_h5-69"><span class="linenos">69</span></a>    <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="extract_regions_chrombpnet_h5-70"><a href="#extract_regions_chrombpnet_h5-70"><span class="linenos">70</span></a>    <span class="n">region_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="extract_regions_chrombpnet_h5-71"><a href="#extract_regions_chrombpnet_h5-71"><span class="linenos">71</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="extract_regions_chrombpnet_h5-72"><a href="#extract_regions_chrombpnet_h5-72"><span class="linenos">72</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract genomic regions and contribution scores from ChromBPNet HDF5 files.</span>
</span><span id="extract_regions_chrombpnet_h5-73"><a href="#extract_regions_chrombpnet_h5-73"><span class="linenos">73</span></a>
</span><span id="extract_regions_chrombpnet_h5-74"><a href="#extract_regions_chrombpnet_h5-74"><span class="linenos">74</span></a><span class="sd">    Parameters</span>
</span><span id="extract_regions_chrombpnet_h5-75"><a href="#extract_regions_chrombpnet_h5-75"><span class="linenos">75</span></a><span class="sd">    ----------</span>
</span><span id="extract_regions_chrombpnet_h5-76"><a href="#extract_regions_chrombpnet_h5-76"><span class="linenos">76</span></a><span class="sd">    peaks_path : str, optional</span>
</span><span id="extract_regions_chrombpnet_h5-77"><a href="#extract_regions_chrombpnet_h5-77"><span class="linenos">77</span></a><span class="sd">        Path to ENCODE NarrowPeak format file. If None, lacks absolute coordinates.</span>
</span><span id="extract_regions_chrombpnet_h5-78"><a href="#extract_regions_chrombpnet_h5-78"><span class="linenos">78</span></a><span class="sd">    chrom_order_path : str, optional</span>
</span><span id="extract_regions_chrombpnet_h5-79"><a href="#extract_regions_chrombpnet_h5-79"><span class="linenos">79</span></a><span class="sd">        Path to chromosome ordering file.</span>
</span><span id="extract_regions_chrombpnet_h5-80"><a href="#extract_regions_chrombpnet_h5-80"><span class="linenos">80</span></a><span class="sd">    h5_paths : List[str]</span>
</span><span id="extract_regions_chrombpnet_h5-81"><a href="#extract_regions_chrombpnet_h5-81"><span class="linenos">81</span></a><span class="sd">        List of ChromBPNet HDF5 file paths.</span>
</span><span id="extract_regions_chrombpnet_h5-82"><a href="#extract_regions_chrombpnet_h5-82"><span class="linenos">82</span></a><span class="sd">    out_path : str</span>
</span><span id="extract_regions_chrombpnet_h5-83"><a href="#extract_regions_chrombpnet_h5-83"><span class="linenos">83</span></a><span class="sd">        Output path for NPZ file.</span>
</span><span id="extract_regions_chrombpnet_h5-84"><a href="#extract_regions_chrombpnet_h5-84"><span class="linenos">84</span></a><span class="sd">    region_width : int</span>
</span><span id="extract_regions_chrombpnet_h5-85"><a href="#extract_regions_chrombpnet_h5-85"><span class="linenos">85</span></a><span class="sd">        Width of regions to extract around peak summits.</span>
</span><span id="extract_regions_chrombpnet_h5-86"><a href="#extract_regions_chrombpnet_h5-86"><span class="linenos">86</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="extract_regions_chrombpnet_h5-87"><a href="#extract_regions_chrombpnet_h5-87"><span class="linenos">87</span></a>    <span class="n">half_width</span> <span class="o">=</span> <span class="n">region_width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="extract_regions_chrombpnet_h5-88"><a href="#extract_regions_chrombpnet_h5-88"><span class="linenos">88</span></a>
</span><span id="extract_regions_chrombpnet_h5-89"><a href="#extract_regions_chrombpnet_h5-89"><span class="linenos">89</span></a>    <span class="k">if</span> <span class="n">peaks_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="extract_regions_chrombpnet_h5-90"><a href="#extract_regions_chrombpnet_h5-90"><span class="linenos">90</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_peaks</span><span class="p">(</span><span class="n">peaks_path</span><span class="p">,</span> <span class="n">chrom_order_path</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="extract_regions_chrombpnet_h5-91"><a href="#extract_regions_chrombpnet_h5-91"><span class="linenos">91</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="extract_regions_chrombpnet_h5-92"><a href="#extract_regions_chrombpnet_h5-92"><span class="linenos">92</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="extract_regions_chrombpnet_h5-93"><a href="#extract_regions_chrombpnet_h5-93"><span class="linenos">93</span></a>
</span><span id="extract_regions_chrombpnet_h5-94"><a href="#extract_regions_chrombpnet_h5-94"><span class="linenos">94</span></a>    <span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_regions_from_chrombpnet_h5</span><span class="p">(</span><span class="n">h5_paths</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="extract_regions_chrombpnet_h5-95"><a href="#extract_regions_chrombpnet_h5-95"><span class="linenos">95</span></a>
</span><span id="extract_regions_chrombpnet_h5-96"><a href="#extract_regions_chrombpnet_h5-96"><span class="linenos">96</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_regions_npz</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">peaks_df</span><span class="o">=</span><span class="n">peaks_df</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extract genomic regions and contribution scores from ChromBPNet HDF5 files.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>peaks_path</strong> (str, optional):
Path to ENCODE NarrowPeak format file. If None, lacks absolute coordinates.</li>
<li><strong>chrom_order_path</strong> (str, optional):
Path to chromosome ordering file.</li>
<li><strong>h5_paths</strong> (List[str]):
List of ChromBPNet HDF5 file paths.</li>
<li><strong>out_path</strong> (str):
Output path for NPZ file.</li>
<li><strong>region_width</strong> (int):
Width of regions to extract around peak summits.</li>
</ul>
</div>


                </section>
                <section id="extract_regions_bpnet_h5">
                            <input id="extract_regions_bpnet_h5-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_regions_bpnet_h5</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">h5_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">region_width</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="extract_regions_bpnet_h5-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#extract_regions_bpnet_h5"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="extract_regions_bpnet_h5-99"><a href="#extract_regions_bpnet_h5-99"><span class="linenos"> 99</span></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_regions_bpnet_h5</span><span class="p">(</span>
</span><span id="extract_regions_bpnet_h5-100"><a href="#extract_regions_bpnet_h5-100"><span class="linenos">100</span></a>    <span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="extract_regions_bpnet_h5-101"><a href="#extract_regions_bpnet_h5-101"><span class="linenos">101</span></a>    <span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="extract_regions_bpnet_h5-102"><a href="#extract_regions_bpnet_h5-102"><span class="linenos">102</span></a>    <span class="n">h5_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="extract_regions_bpnet_h5-103"><a href="#extract_regions_bpnet_h5-103"><span class="linenos">103</span></a>    <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="extract_regions_bpnet_h5-104"><a href="#extract_regions_bpnet_h5-104"><span class="linenos">104</span></a>    <span class="n">region_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="extract_regions_bpnet_h5-105"><a href="#extract_regions_bpnet_h5-105"><span class="linenos">105</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="extract_regions_bpnet_h5-106"><a href="#extract_regions_bpnet_h5-106"><span class="linenos">106</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract genomic regions and contribution scores from BPNet HDF5 files.</span>
</span><span id="extract_regions_bpnet_h5-107"><a href="#extract_regions_bpnet_h5-107"><span class="linenos">107</span></a>
</span><span id="extract_regions_bpnet_h5-108"><a href="#extract_regions_bpnet_h5-108"><span class="linenos">108</span></a><span class="sd">    Parameters</span>
</span><span id="extract_regions_bpnet_h5-109"><a href="#extract_regions_bpnet_h5-109"><span class="linenos">109</span></a><span class="sd">    ----------</span>
</span><span id="extract_regions_bpnet_h5-110"><a href="#extract_regions_bpnet_h5-110"><span class="linenos">110</span></a><span class="sd">    peaks_path : str, optional</span>
</span><span id="extract_regions_bpnet_h5-111"><a href="#extract_regions_bpnet_h5-111"><span class="linenos">111</span></a><span class="sd">        Path to ENCODE NarrowPeak format file. If None, output lacks absolute coordinates.</span>
</span><span id="extract_regions_bpnet_h5-112"><a href="#extract_regions_bpnet_h5-112"><span class="linenos">112</span></a><span class="sd">    chrom_order_path : str, optional</span>
</span><span id="extract_regions_bpnet_h5-113"><a href="#extract_regions_bpnet_h5-113"><span class="linenos">113</span></a><span class="sd">        Path to chromosome ordering file.</span>
</span><span id="extract_regions_bpnet_h5-114"><a href="#extract_regions_bpnet_h5-114"><span class="linenos">114</span></a><span class="sd">    h5_paths : List[str]</span>
</span><span id="extract_regions_bpnet_h5-115"><a href="#extract_regions_bpnet_h5-115"><span class="linenos">115</span></a><span class="sd">        List of BPNet HDF5 file paths.</span>
</span><span id="extract_regions_bpnet_h5-116"><a href="#extract_regions_bpnet_h5-116"><span class="linenos">116</span></a><span class="sd">    out_path : str</span>
</span><span id="extract_regions_bpnet_h5-117"><a href="#extract_regions_bpnet_h5-117"><span class="linenos">117</span></a><span class="sd">        Output path for NPZ file.</span>
</span><span id="extract_regions_bpnet_h5-118"><a href="#extract_regions_bpnet_h5-118"><span class="linenos">118</span></a><span class="sd">    region_width : int</span>
</span><span id="extract_regions_bpnet_h5-119"><a href="#extract_regions_bpnet_h5-119"><span class="linenos">119</span></a><span class="sd">        Width of regions to extract around peak summits.</span>
</span><span id="extract_regions_bpnet_h5-120"><a href="#extract_regions_bpnet_h5-120"><span class="linenos">120</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="extract_regions_bpnet_h5-121"><a href="#extract_regions_bpnet_h5-121"><span class="linenos">121</span></a>    <span class="n">half_width</span> <span class="o">=</span> <span class="n">region_width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="extract_regions_bpnet_h5-122"><a href="#extract_regions_bpnet_h5-122"><span class="linenos">122</span></a>
</span><span id="extract_regions_bpnet_h5-123"><a href="#extract_regions_bpnet_h5-123"><span class="linenos">123</span></a>    <span class="k">if</span> <span class="n">peaks_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="extract_regions_bpnet_h5-124"><a href="#extract_regions_bpnet_h5-124"><span class="linenos">124</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_peaks</span><span class="p">(</span><span class="n">peaks_path</span><span class="p">,</span> <span class="n">chrom_order_path</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="extract_regions_bpnet_h5-125"><a href="#extract_regions_bpnet_h5-125"><span class="linenos">125</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="extract_regions_bpnet_h5-126"><a href="#extract_regions_bpnet_h5-126"><span class="linenos">126</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="extract_regions_bpnet_h5-127"><a href="#extract_regions_bpnet_h5-127"><span class="linenos">127</span></a>
</span><span id="extract_regions_bpnet_h5-128"><a href="#extract_regions_bpnet_h5-128"><span class="linenos">128</span></a>    <span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_regions_from_bpnet_h5</span><span class="p">(</span><span class="n">h5_paths</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="extract_regions_bpnet_h5-129"><a href="#extract_regions_bpnet_h5-129"><span class="linenos">129</span></a>
</span><span id="extract_regions_bpnet_h5-130"><a href="#extract_regions_bpnet_h5-130"><span class="linenos">130</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_regions_npz</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">peaks_df</span><span class="o">=</span><span class="n">peaks_df</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extract genomic regions and contribution scores from BPNet HDF5 files.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>peaks_path</strong> (str, optional):
Path to ENCODE NarrowPeak format file. If None, output lacks absolute coordinates.</li>
<li><strong>chrom_order_path</strong> (str, optional):
Path to chromosome ordering file.</li>
<li><strong>h5_paths</strong> (List[str]):
List of BPNet HDF5 file paths.</li>
<li><strong>out_path</strong> (str):
Output path for NPZ file.</li>
<li><strong>region_width</strong> (int):
Width of regions to extract around peak summits.</li>
</ul>
</div>


                </section>
                <section id="extract_regions_modisco_fmt">
                            <input id="extract_regions_modisco_fmt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_regions_modisco_fmt</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">shaps_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">ohe_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">region_width</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="extract_regions_modisco_fmt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#extract_regions_modisco_fmt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="extract_regions_modisco_fmt-133"><a href="#extract_regions_modisco_fmt-133"><span class="linenos">133</span></a><span class="k">def</span><span class="w"> </span><span class="nf">extract_regions_modisco_fmt</span><span class="p">(</span>
</span><span id="extract_regions_modisco_fmt-134"><a href="#extract_regions_modisco_fmt-134"><span class="linenos">134</span></a>    <span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="extract_regions_modisco_fmt-135"><a href="#extract_regions_modisco_fmt-135"><span class="linenos">135</span></a>    <span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="extract_regions_modisco_fmt-136"><a href="#extract_regions_modisco_fmt-136"><span class="linenos">136</span></a>    <span class="n">shaps_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="extract_regions_modisco_fmt-137"><a href="#extract_regions_modisco_fmt-137"><span class="linenos">137</span></a>    <span class="n">ohe_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="extract_regions_modisco_fmt-138"><a href="#extract_regions_modisco_fmt-138"><span class="linenos">138</span></a>    <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="extract_regions_modisco_fmt-139"><a href="#extract_regions_modisco_fmt-139"><span class="linenos">139</span></a>    <span class="n">region_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="extract_regions_modisco_fmt-140"><a href="#extract_regions_modisco_fmt-140"><span class="linenos">140</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="extract_regions_modisco_fmt-141"><a href="#extract_regions_modisco_fmt-141"><span class="linenos">141</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract genomic regions and contribution scores from TF-MoDISco format files.</span>
</span><span id="extract_regions_modisco_fmt-142"><a href="#extract_regions_modisco_fmt-142"><span class="linenos">142</span></a>
</span><span id="extract_regions_modisco_fmt-143"><a href="#extract_regions_modisco_fmt-143"><span class="linenos">143</span></a><span class="sd">    Parameters</span>
</span><span id="extract_regions_modisco_fmt-144"><a href="#extract_regions_modisco_fmt-144"><span class="linenos">144</span></a><span class="sd">    ----------</span>
</span><span id="extract_regions_modisco_fmt-145"><a href="#extract_regions_modisco_fmt-145"><span class="linenos">145</span></a><span class="sd">    peaks_path : str, optional</span>
</span><span id="extract_regions_modisco_fmt-146"><a href="#extract_regions_modisco_fmt-146"><span class="linenos">146</span></a><span class="sd">        Path to ENCODE NarrowPeak format file. If None, output lacks absolute coordinates.</span>
</span><span id="extract_regions_modisco_fmt-147"><a href="#extract_regions_modisco_fmt-147"><span class="linenos">147</span></a><span class="sd">    chrom_order_path : str, optional</span>
</span><span id="extract_regions_modisco_fmt-148"><a href="#extract_regions_modisco_fmt-148"><span class="linenos">148</span></a><span class="sd">        Path to chromosome ordering file.</span>
</span><span id="extract_regions_modisco_fmt-149"><a href="#extract_regions_modisco_fmt-149"><span class="linenos">149</span></a><span class="sd">    shaps_paths : List[str]</span>
</span><span id="extract_regions_modisco_fmt-150"><a href="#extract_regions_modisco_fmt-150"><span class="linenos">150</span></a><span class="sd">        List of paths to .npy/.npz files containing SHAP/attribution scores.</span>
</span><span id="extract_regions_modisco_fmt-151"><a href="#extract_regions_modisco_fmt-151"><span class="linenos">151</span></a><span class="sd">    ohe_path : str</span>
</span><span id="extract_regions_modisco_fmt-152"><a href="#extract_regions_modisco_fmt-152"><span class="linenos">152</span></a><span class="sd">        Path to .npy/.npz file containing one-hot encoded sequences.</span>
</span><span id="extract_regions_modisco_fmt-153"><a href="#extract_regions_modisco_fmt-153"><span class="linenos">153</span></a><span class="sd">    out_path : str</span>
</span><span id="extract_regions_modisco_fmt-154"><a href="#extract_regions_modisco_fmt-154"><span class="linenos">154</span></a><span class="sd">        Output path for NPZ file.</span>
</span><span id="extract_regions_modisco_fmt-155"><a href="#extract_regions_modisco_fmt-155"><span class="linenos">155</span></a><span class="sd">    region_width : int</span>
</span><span id="extract_regions_modisco_fmt-156"><a href="#extract_regions_modisco_fmt-156"><span class="linenos">156</span></a><span class="sd">        Width of regions to extract around peak summits.</span>
</span><span id="extract_regions_modisco_fmt-157"><a href="#extract_regions_modisco_fmt-157"><span class="linenos">157</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="extract_regions_modisco_fmt-158"><a href="#extract_regions_modisco_fmt-158"><span class="linenos">158</span></a>    <span class="n">half_width</span> <span class="o">=</span> <span class="n">region_width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="extract_regions_modisco_fmt-159"><a href="#extract_regions_modisco_fmt-159"><span class="linenos">159</span></a>
</span><span id="extract_regions_modisco_fmt-160"><a href="#extract_regions_modisco_fmt-160"><span class="linenos">160</span></a>    <span class="k">if</span> <span class="n">peaks_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="extract_regions_modisco_fmt-161"><a href="#extract_regions_modisco_fmt-161"><span class="linenos">161</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_peaks</span><span class="p">(</span><span class="n">peaks_path</span><span class="p">,</span> <span class="n">chrom_order_path</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="extract_regions_modisco_fmt-162"><a href="#extract_regions_modisco_fmt-162"><span class="linenos">162</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="extract_regions_modisco_fmt-163"><a href="#extract_regions_modisco_fmt-163"><span class="linenos">163</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="extract_regions_modisco_fmt-164"><a href="#extract_regions_modisco_fmt-164"><span class="linenos">164</span></a>
</span><span id="extract_regions_modisco_fmt-165"><a href="#extract_regions_modisco_fmt-165"><span class="linenos">165</span></a>    <span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_regions_from_modisco_fmt</span><span class="p">(</span>
</span><span id="extract_regions_modisco_fmt-166"><a href="#extract_regions_modisco_fmt-166"><span class="linenos">166</span></a>        <span class="n">shaps_paths</span><span class="p">,</span> <span class="n">ohe_path</span><span class="p">,</span> <span class="n">half_width</span>
</span><span id="extract_regions_modisco_fmt-167"><a href="#extract_regions_modisco_fmt-167"><span class="linenos">167</span></a>    <span class="p">)</span>
</span><span id="extract_regions_modisco_fmt-168"><a href="#extract_regions_modisco_fmt-168"><span class="linenos">168</span></a>
</span><span id="extract_regions_modisco_fmt-169"><a href="#extract_regions_modisco_fmt-169"><span class="linenos">169</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_regions_npz</span><span class="p">(</span><span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">peaks_df</span><span class="o">=</span><span class="n">peaks_df</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extract genomic regions and contribution scores from TF-MoDISco format files.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>peaks_path</strong> (str, optional):
Path to ENCODE NarrowPeak format file. If None, output lacks absolute coordinates.</li>
<li><strong>chrom_order_path</strong> (str, optional):
Path to chromosome ordering file.</li>
<li><strong>shaps_paths</strong> (List[str]):
List of paths to .npy/.npz files containing SHAP/attribution scores.</li>
<li><strong>ohe_path</strong> (str):
Path to .npy/.npz file containing one-hot encoded sequences.</li>
<li><strong>out_path</strong> (str):
Output path for NPZ file.</li>
<li><strong>region_width</strong> (int):
Width of regions to extract around peak summits.</li>
</ul>
</div>


                </section>
                <section id="call_hits">
                            <input id="call_hits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">call_hits</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">regions_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">modisco_h5_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">motifs_include_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">motif_names_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">motif_lambdas_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">cwm_trim_coords_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">cwm_trim_thresholds_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">cwm_trim_threshold_default</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">lambda_default</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">step_size_max</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">step_size_min</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">sqrt_transform</span><span class="p">:</span> <span class="nb">bool</span>,</span><span class="param">	<span class="n">convergence_tol</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">max_steps</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">step_adjust</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">no_post_filter</span><span class="p">:</span> <span class="nb">bool</span>,</span><span class="param">	<span class="n">compile_optimizer</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="call_hits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#call_hits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="call_hits-172"><a href="#call_hits-172"><span class="linenos">172</span></a><span class="k">def</span><span class="w"> </span><span class="nf">call_hits</span><span class="p">(</span>
</span><span id="call_hits-173"><a href="#call_hits-173"><span class="linenos">173</span></a>    <span class="n">regions_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="call_hits-174"><a href="#call_hits-174"><span class="linenos">174</span></a>    <span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="call_hits-175"><a href="#call_hits-175"><span class="linenos">175</span></a>    <span class="n">modisco_h5_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="call_hits-176"><a href="#call_hits-176"><span class="linenos">176</span></a>    <span class="n">chrom_order_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="call_hits-177"><a href="#call_hits-177"><span class="linenos">177</span></a>    <span class="n">motifs_include_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="call_hits-178"><a href="#call_hits-178"><span class="linenos">178</span></a>    <span class="n">motif_names_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="call_hits-179"><a href="#call_hits-179"><span class="linenos">179</span></a>    <span class="n">motif_lambdas_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="call_hits-180"><a href="#call_hits-180"><span class="linenos">180</span></a>    <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="call_hits-181"><a href="#call_hits-181"><span class="linenos">181</span></a>    <span class="n">cwm_trim_coords_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="call_hits-182"><a href="#call_hits-182"><span class="linenos">182</span></a>    <span class="n">cwm_trim_thresholds_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="call_hits-183"><a href="#call_hits-183"><span class="linenos">183</span></a>    <span class="n">cwm_trim_threshold_default</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="call_hits-184"><a href="#call_hits-184"><span class="linenos">184</span></a>    <span class="n">lambda_default</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="call_hits-185"><a href="#call_hits-185"><span class="linenos">185</span></a>    <span class="n">step_size_max</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="call_hits-186"><a href="#call_hits-186"><span class="linenos">186</span></a>    <span class="n">step_size_min</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="call_hits-187"><a href="#call_hits-187"><span class="linenos">187</span></a>    <span class="n">sqrt_transform</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="call_hits-188"><a href="#call_hits-188"><span class="linenos">188</span></a>    <span class="n">convergence_tol</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="call_hits-189"><a href="#call_hits-189"><span class="linenos">189</span></a>    <span class="n">max_steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="call_hits-190"><a href="#call_hits-190"><span class="linenos">190</span></a>    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="call_hits-191"><a href="#call_hits-191"><span class="linenos">191</span></a>    <span class="n">step_adjust</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="call_hits-192"><a href="#call_hits-192"><span class="linenos">192</span></a>    <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="call_hits-193"><a href="#call_hits-193"><span class="linenos">193</span></a>    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="call_hits-194"><a href="#call_hits-194"><span class="linenos">194</span></a>    <span class="n">no_post_filter</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="call_hits-195"><a href="#call_hits-195"><span class="linenos">195</span></a>    <span class="n">compile_optimizer</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="call_hits-196"><a href="#call_hits-196"><span class="linenos">196</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="call_hits-197"><a href="#call_hits-197"><span class="linenos">197</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Call motif hits using the Fi-NeMo algorithm on preprocessed genomic regions.</span>
</span><span id="call_hits-198"><a href="#call_hits-198"><span class="linenos">198</span></a>
</span><span id="call_hits-199"><a href="#call_hits-199"><span class="linenos">199</span></a><span class="sd">    This function implements the core Fi-NeMo hit calling pipeline, which identifies</span>
</span><span id="call_hits-200"><a href="#call_hits-200"><span class="linenos">200</span></a><span class="sd">    motif instances by solving a sparse reconstruction problem using proximal gradient</span>
</span><span id="call_hits-201"><a href="#call_hits-201"><span class="linenos">201</span></a><span class="sd">    descent. The algorithm represents contribution scores as weighted combinations of</span>
</span><span id="call_hits-202"><a href="#call_hits-202"><span class="linenos">202</span></a><span class="sd">    motif CWMs at specific positions.</span>
</span><span id="call_hits-203"><a href="#call_hits-203"><span class="linenos">203</span></a>
</span><span id="call_hits-204"><a href="#call_hits-204"><span class="linenos">204</span></a><span class="sd">    Parameters</span>
</span><span id="call_hits-205"><a href="#call_hits-205"><span class="linenos">205</span></a><span class="sd">    ----------</span>
</span><span id="call_hits-206"><a href="#call_hits-206"><span class="linenos">206</span></a><span class="sd">    regions_path : str</span>
</span><span id="call_hits-207"><a href="#call_hits-207"><span class="linenos">207</span></a><span class="sd">        Path to NPZ file containing preprocessed regions (sequences, contributions,</span>
</span><span id="call_hits-208"><a href="#call_hits-208"><span class="linenos">208</span></a><span class="sd">        and optional peak coordinates).</span>
</span><span id="call_hits-209"><a href="#call_hits-209"><span class="linenos">209</span></a><span class="sd">    peaks_path : str, optional</span>
</span><span id="call_hits-210"><a href="#call_hits-210"><span class="linenos">210</span></a><span class="sd">        DEPRECATED. Path to ENCODE NarrowPeak format file. Peak data should be</span>
</span><span id="call_hits-211"><a href="#call_hits-211"><span class="linenos">211</span></a><span class="sd">        included during preprocessing instead.</span>
</span><span id="call_hits-212"><a href="#call_hits-212"><span class="linenos">212</span></a><span class="sd">    modisco_h5_path : str</span>
</span><span id="call_hits-213"><a href="#call_hits-213"><span class="linenos">213</span></a><span class="sd">        Path to TF-MoDISco H5 file containing motif CWMs.</span>
</span><span id="call_hits-214"><a href="#call_hits-214"><span class="linenos">214</span></a><span class="sd">    chrom_order_path : str, optional</span>
</span><span id="call_hits-215"><a href="#call_hits-215"><span class="linenos">215</span></a><span class="sd">        DEPRECATED. Path to chromosome ordering file.</span>
</span><span id="call_hits-216"><a href="#call_hits-216"><span class="linenos">216</span></a><span class="sd">    motifs_include_path : str, optional</span>
</span><span id="call_hits-217"><a href="#call_hits-217"><span class="linenos">217</span></a><span class="sd">        Path to file listing motif names to include in analysis.</span>
</span><span id="call_hits-218"><a href="#call_hits-218"><span class="linenos">218</span></a><span class="sd">    motif_names_path : str, optional</span>
</span><span id="call_hits-219"><a href="#call_hits-219"><span class="linenos">219</span></a><span class="sd">        Path to file mapping motif IDs to custom names.</span>
</span><span id="call_hits-220"><a href="#call_hits-220"><span class="linenos">220</span></a><span class="sd">    motif_lambdas_path : str, optional</span>
</span><span id="call_hits-221"><a href="#call_hits-221"><span class="linenos">221</span></a><span class="sd">        Path to file specifying per-motif lambda values.</span>
</span><span id="call_hits-222"><a href="#call_hits-222"><span class="linenos">222</span></a><span class="sd">    out_dir : str</span>
</span><span id="call_hits-223"><a href="#call_hits-223"><span class="linenos">223</span></a><span class="sd">        Output directory for results.</span>
</span><span id="call_hits-224"><a href="#call_hits-224"><span class="linenos">224</span></a><span class="sd">    cwm_trim_coords_path : str, optional</span>
</span><span id="call_hits-225"><a href="#call_hits-225"><span class="linenos">225</span></a><span class="sd">        Path to file specifying custom motif trimming coordinates.</span>
</span><span id="call_hits-226"><a href="#call_hits-226"><span class="linenos">226</span></a><span class="sd">    cwm_trim_thresholds_path : str, optional</span>
</span><span id="call_hits-227"><a href="#call_hits-227"><span class="linenos">227</span></a><span class="sd">        Path to file specifying custom motif trimming thresholds.</span>
</span><span id="call_hits-228"><a href="#call_hits-228"><span class="linenos">228</span></a><span class="sd">    cwm_trim_threshold_default : float</span>
</span><span id="call_hits-229"><a href="#call_hits-229"><span class="linenos">229</span></a><span class="sd">        Default threshold for motif trimming (typically 0.3).</span>
</span><span id="call_hits-230"><a href="#call_hits-230"><span class="linenos">230</span></a><span class="sd">    lambda_default : float</span>
</span><span id="call_hits-231"><a href="#call_hits-231"><span class="linenos">231</span></a><span class="sd">        Default L1 regularization weight (typically 0.7).</span>
</span><span id="call_hits-232"><a href="#call_hits-232"><span class="linenos">232</span></a><span class="sd">    step_size_max : float</span>
</span><span id="call_hits-233"><a href="#call_hits-233"><span class="linenos">233</span></a><span class="sd">        Maximum optimization step size.</span>
</span><span id="call_hits-234"><a href="#call_hits-234"><span class="linenos">234</span></a><span class="sd">    step_size_min : float</span>
</span><span id="call_hits-235"><a href="#call_hits-235"><span class="linenos">235</span></a><span class="sd">        Minimum optimization step size.</span>
</span><span id="call_hits-236"><a href="#call_hits-236"><span class="linenos">236</span></a><span class="sd">    sqrt_transform : bool</span>
</span><span id="call_hits-237"><a href="#call_hits-237"><span class="linenos">237</span></a><span class="sd">        Whether to apply signed square root transform to contributions.</span>
</span><span id="call_hits-238"><a href="#call_hits-238"><span class="linenos">238</span></a><span class="sd">    convergence_tol : float</span>
</span><span id="call_hits-239"><a href="#call_hits-239"><span class="linenos">239</span></a><span class="sd">        Convergence tolerance for duality gap.</span>
</span><span id="call_hits-240"><a href="#call_hits-240"><span class="linenos">240</span></a><span class="sd">    max_steps : int</span>
</span><span id="call_hits-241"><a href="#call_hits-241"><span class="linenos">241</span></a><span class="sd">        Maximum number of optimization steps.</span>
</span><span id="call_hits-242"><a href="#call_hits-242"><span class="linenos">242</span></a><span class="sd">    batch_size : int</span>
</span><span id="call_hits-243"><a href="#call_hits-243"><span class="linenos">243</span></a><span class="sd">        Batch size for GPU processing.</span>
</span><span id="call_hits-244"><a href="#call_hits-244"><span class="linenos">244</span></a><span class="sd">    step_adjust : float</span>
</span><span id="call_hits-245"><a href="#call_hits-245"><span class="linenos">245</span></a><span class="sd">        Step size adjustment factor on divergence.</span>
</span><span id="call_hits-246"><a href="#call_hits-246"><span class="linenos">246</span></a><span class="sd">    device : str, optional</span>
</span><span id="call_hits-247"><a href="#call_hits-247"><span class="linenos">247</span></a><span class="sd">        DEPRECATED. Use CUDA_VISIBLE_DEVICES environment variable instead.</span>
</span><span id="call_hits-248"><a href="#call_hits-248"><span class="linenos">248</span></a><span class="sd">    mode : str</span>
</span><span id="call_hits-249"><a href="#call_hits-249"><span class="linenos">249</span></a><span class="sd">        Contribution type mode (&#39;pp&#39;, &#39;ph&#39;, &#39;hp&#39;, &#39;hh&#39;) where &#39;p&#39;=projected, &#39;h&#39;=hypothetical.</span>
</span><span id="call_hits-250"><a href="#call_hits-250"><span class="linenos">250</span></a><span class="sd">    no_post_filter : bool</span>
</span><span id="call_hits-251"><a href="#call_hits-251"><span class="linenos">251</span></a><span class="sd">        If True, skip post-hit-calling similarity filtering.</span>
</span><span id="call_hits-252"><a href="#call_hits-252"><span class="linenos">252</span></a><span class="sd">    compile_optimizer : bool</span>
</span><span id="call_hits-253"><a href="#call_hits-253"><span class="linenos">253</span></a><span class="sd">        Whether to JIT-compile the optimizer for speed.</span>
</span><span id="call_hits-254"><a href="#call_hits-254"><span class="linenos">254</span></a>
</span><span id="call_hits-255"><a href="#call_hits-255"><span class="linenos">255</span></a><span class="sd">    Notes</span>
</span><span id="call_hits-256"><a href="#call_hits-256"><span class="linenos">256</span></a><span class="sd">    -----</span>
</span><span id="call_hits-257"><a href="#call_hits-257"><span class="linenos">257</span></a><span class="sd">    The Fi-NeMo algorithm solves the optimization problem:</span>
</span><span id="call_hits-258"><a href="#call_hits-258"><span class="linenos">258</span></a><span class="sd">    minimize_c: ||contribs - reconstruction(c)||²₂ + λ||c||₁</span>
</span><span id="call_hits-259"><a href="#call_hits-259"><span class="linenos">259</span></a><span class="sd">    subject to: c ≥ 0</span>
</span><span id="call_hits-260"><a href="#call_hits-260"><span class="linenos">260</span></a>
</span><span id="call_hits-261"><a href="#call_hits-261"><span class="linenos">261</span></a><span class="sd">    where c represents motif hit coefficients and reconstruction uses convolution</span>
</span><span id="call_hits-262"><a href="#call_hits-262"><span class="linenos">262</span></a><span class="sd">    with motif CWMs.</span>
</span><span id="call_hits-263"><a href="#call_hits-263"><span class="linenos">263</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="call_hits-264"><a href="#call_hits-264"><span class="linenos">264</span></a>
</span><span id="call_hits-265"><a href="#call_hits-265"><span class="linenos">265</span></a>    <span class="n">params</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
</span><span id="call_hits-266"><a href="#call_hits-266"><span class="linenos">266</span></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="call_hits-267"><a href="#call_hits-267"><span class="linenos">267</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">hitcaller</span>
</span><span id="call_hits-268"><a href="#call_hits-268"><span class="linenos">268</span></a>
</span><span id="call_hits-269"><a href="#call_hits-269"><span class="linenos">269</span></a>    <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="call_hits-270"><a href="#call_hits-270"><span class="linenos">270</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="call_hits-271"><a href="#call_hits-271"><span class="linenos">271</span></a>            <span class="s2">&quot;The `--device` flag is deprecated and will be removed in a future version. Please use the `CUDA_VISIBLE_DEVICES` environment variable to specify the GPU device.&quot;</span>
</span><span id="call_hits-272"><a href="#call_hits-272"><span class="linenos">272</span></a>        <span class="p">)</span>
</span><span id="call_hits-273"><a href="#call_hits-273"><span class="linenos">273</span></a>
</span><span id="call_hits-274"><a href="#call_hits-274"><span class="linenos">274</span></a>    <span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">peaks_df</span><span class="p">,</span> <span class="n">has_peaks</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_regions_npz</span><span class="p">(</span><span class="n">regions_path</span><span class="p">)</span>
</span><span id="call_hits-275"><a href="#call_hits-275"><span class="linenos">275</span></a>
</span><span id="call_hits-276"><a href="#call_hits-276"><span class="linenos">276</span></a>    <span class="n">region_width</span> <span class="o">=</span> <span class="n">sequences</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="call_hits-277"><a href="#call_hits-277"><span class="linenos">277</span></a>    <span class="k">if</span> <span class="n">region_width</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="call_hits-278"><a href="#call_hits-278"><span class="linenos">278</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Region width of </span><span class="si">{</span><span class="n">region_width</span><span class="si">}</span><span class="s2"> is not divisible by 2.&quot;</span><span class="p">)</span>
</span><span id="call_hits-279"><a href="#call_hits-279"><span class="linenos">279</span></a>
</span><span id="call_hits-280"><a href="#call_hits-280"><span class="linenos">280</span></a>    <span class="n">half_width</span> <span class="o">=</span> <span class="n">region_width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="call_hits-281"><a href="#call_hits-281"><span class="linenos">281</span></a>    <span class="n">num_regions</span> <span class="o">=</span> <span class="n">contribs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="call_hits-282"><a href="#call_hits-282"><span class="linenos">282</span></a>
</span><span id="call_hits-283"><a href="#call_hits-283"><span class="linenos">283</span></a>    <span class="k">if</span> <span class="n">peaks_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="call_hits-284"><a href="#call_hits-284"><span class="linenos">284</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="call_hits-285"><a href="#call_hits-285"><span class="linenos">285</span></a>            <span class="s2">&quot;Providing a peaks file to `call-hits` is deprecated, and this option will be removed in a future version. Peaks should instead be provided in the preprocessing step to be included in `regions.npz`.&quot;</span>
</span><span id="call_hits-286"><a href="#call_hits-286"><span class="linenos">286</span></a>        <span class="p">)</span>
</span><span id="call_hits-287"><a href="#call_hits-287"><span class="linenos">287</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_peaks</span><span class="p">(</span><span class="n">peaks_path</span><span class="p">,</span> <span class="n">chrom_order_path</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="call_hits-288"><a href="#call_hits-288"><span class="linenos">288</span></a>        <span class="n">has_peaks</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="call_hits-289"><a href="#call_hits-289"><span class="linenos">289</span></a>
</span><span id="call_hits-290"><a href="#call_hits-290"><span class="linenos">290</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_peaks</span><span class="p">:</span>
</span><span id="call_hits-291"><a href="#call_hits-291"><span class="linenos">291</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="call_hits-292"><a href="#call_hits-292"><span class="linenos">292</span></a>            <span class="s2">&quot;No peak region data provided. Output hits will lack absolute genomic coordinates.&quot;</span>
</span><span id="call_hits-293"><a href="#call_hits-293"><span class="linenos">293</span></a>        <span class="p">)</span>
</span><span id="call_hits-294"><a href="#call_hits-294"><span class="linenos">294</span></a>
</span><span id="call_hits-295"><a href="#call_hits-295"><span class="linenos">295</span></a>    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;pp&quot;</span><span class="p">:</span>
</span><span id="call_hits-296"><a href="#call_hits-296"><span class="linenos">296</span></a>        <span class="n">motif_type</span> <span class="o">=</span> <span class="s2">&quot;cwm&quot;</span>
</span><span id="call_hits-297"><a href="#call_hits-297"><span class="linenos">297</span></a>        <span class="n">use_hypothetical_contribs</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="call_hits-298"><a href="#call_hits-298"><span class="linenos">298</span></a>    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;ph&quot;</span><span class="p">:</span>
</span><span id="call_hits-299"><a href="#call_hits-299"><span class="linenos">299</span></a>        <span class="n">motif_type</span> <span class="o">=</span> <span class="s2">&quot;cwm&quot;</span>
</span><span id="call_hits-300"><a href="#call_hits-300"><span class="linenos">300</span></a>        <span class="n">use_hypothetical_contribs</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="call_hits-301"><a href="#call_hits-301"><span class="linenos">301</span></a>    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;hp&quot;</span><span class="p">:</span>
</span><span id="call_hits-302"><a href="#call_hits-302"><span class="linenos">302</span></a>        <span class="n">motif_type</span> <span class="o">=</span> <span class="s2">&quot;hcwm&quot;</span>
</span><span id="call_hits-303"><a href="#call_hits-303"><span class="linenos">303</span></a>        <span class="n">use_hypothetical_contribs</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="call_hits-304"><a href="#call_hits-304"><span class="linenos">304</span></a>    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;hh&quot;</span><span class="p">:</span>
</span><span id="call_hits-305"><a href="#call_hits-305"><span class="linenos">305</span></a>        <span class="n">motif_type</span> <span class="o">=</span> <span class="s2">&quot;hcwm&quot;</span>
</span><span id="call_hits-306"><a href="#call_hits-306"><span class="linenos">306</span></a>        <span class="n">use_hypothetical_contribs</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="call_hits-307"><a href="#call_hits-307"><span class="linenos">307</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="call_hits-308"><a href="#call_hits-308"><span class="linenos">308</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="call_hits-309"><a href="#call_hits-309"><span class="linenos">309</span></a>            <span class="sa">f</span><span class="s2">&quot;Invalid mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">. Must be one of &#39;pp&#39;, &#39;ph&#39;, &#39;hp&#39;, &#39;hh&#39;.&quot;</span>
</span><span id="call_hits-310"><a href="#call_hits-310"><span class="linenos">310</span></a>        <span class="p">)</span>
</span><span id="call_hits-311"><a href="#call_hits-311"><span class="linenos">311</span></a>
</span><span id="call_hits-312"><a href="#call_hits-312"><span class="linenos">312</span></a>    <span class="k">if</span> <span class="n">motifs_include_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="call_hits-313"><a href="#call_hits-313"><span class="linenos">313</span></a>        <span class="n">motifs_include</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_txt</span><span class="p">(</span><span class="n">motifs_include_path</span><span class="p">)</span>
</span><span id="call_hits-314"><a href="#call_hits-314"><span class="linenos">314</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="call_hits-315"><a href="#call_hits-315"><span class="linenos">315</span></a>        <span class="n">motifs_include</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="call_hits-316"><a href="#call_hits-316"><span class="linenos">316</span></a>
</span><span id="call_hits-317"><a href="#call_hits-317"><span class="linenos">317</span></a>    <span class="k">if</span> <span class="n">motif_names_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="call_hits-318"><a href="#call_hits-318"><span class="linenos">318</span></a>        <span class="n">motif_name_map</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_mapping</span><span class="p">(</span><span class="n">motif_names_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="call_hits-319"><a href="#call_hits-319"><span class="linenos">319</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="call_hits-320"><a href="#call_hits-320"><span class="linenos">320</span></a>        <span class="n">motif_name_map</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="call_hits-321"><a href="#call_hits-321"><span class="linenos">321</span></a>
</span><span id="call_hits-322"><a href="#call_hits-322"><span class="linenos">322</span></a>    <span class="k">if</span> <span class="n">motif_lambdas_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="call_hits-323"><a href="#call_hits-323"><span class="linenos">323</span></a>        <span class="n">motif_lambdas</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_mapping</span><span class="p">(</span><span class="n">motif_lambdas_path</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="call_hits-324"><a href="#call_hits-324"><span class="linenos">324</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="call_hits-325"><a href="#call_hits-325"><span class="linenos">325</span></a>        <span class="n">motif_lambdas</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="call_hits-326"><a href="#call_hits-326"><span class="linenos">326</span></a>
</span><span id="call_hits-327"><a href="#call_hits-327"><span class="linenos">327</span></a>    <span class="k">if</span> <span class="n">cwm_trim_coords_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="call_hits-328"><a href="#call_hits-328"><span class="linenos">328</span></a>        <span class="n">trim_coords</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_mapping_tuple</span><span class="p">(</span><span class="n">cwm_trim_coords_path</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="call_hits-329"><a href="#call_hits-329"><span class="linenos">329</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="call_hits-330"><a href="#call_hits-330"><span class="linenos">330</span></a>        <span class="n">trim_coords</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="call_hits-331"><a href="#call_hits-331"><span class="linenos">331</span></a>
</span><span id="call_hits-332"><a href="#call_hits-332"><span class="linenos">332</span></a>    <span class="k">if</span> <span class="n">cwm_trim_thresholds_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="call_hits-333"><a href="#call_hits-333"><span class="linenos">333</span></a>        <span class="n">trim_thresholds</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_mapping</span><span class="p">(</span><span class="n">cwm_trim_thresholds_path</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="call_hits-334"><a href="#call_hits-334"><span class="linenos">334</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="call_hits-335"><a href="#call_hits-335"><span class="linenos">335</span></a>        <span class="n">trim_thresholds</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="call_hits-336"><a href="#call_hits-336"><span class="linenos">336</span></a>
</span><span id="call_hits-337"><a href="#call_hits-337"><span class="linenos">337</span></a>    <span class="n">motifs_df</span><span class="p">,</span> <span class="n">cwms</span><span class="p">,</span> <span class="n">trim_masks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_modisco_motifs</span><span class="p">(</span>
</span><span id="call_hits-338"><a href="#call_hits-338"><span class="linenos">338</span></a>        <span class="n">modisco_h5_path</span><span class="p">,</span>
</span><span id="call_hits-339"><a href="#call_hits-339"><span class="linenos">339</span></a>        <span class="n">trim_coords</span><span class="p">,</span>
</span><span id="call_hits-340"><a href="#call_hits-340"><span class="linenos">340</span></a>        <span class="n">trim_thresholds</span><span class="p">,</span>
</span><span id="call_hits-341"><a href="#call_hits-341"><span class="linenos">341</span></a>        <span class="n">cwm_trim_threshold_default</span><span class="p">,</span>
</span><span id="call_hits-342"><a href="#call_hits-342"><span class="linenos">342</span></a>        <span class="n">motif_type</span><span class="p">,</span>
</span><span id="call_hits-343"><a href="#call_hits-343"><span class="linenos">343</span></a>        <span class="n">motifs_include</span><span class="p">,</span>
</span><span id="call_hits-344"><a href="#call_hits-344"><span class="linenos">344</span></a>        <span class="n">motif_name_map</span><span class="p">,</span>
</span><span id="call_hits-345"><a href="#call_hits-345"><span class="linenos">345</span></a>        <span class="n">motif_lambdas</span><span class="p">,</span>
</span><span id="call_hits-346"><a href="#call_hits-346"><span class="linenos">346</span></a>        <span class="n">lambda_default</span><span class="p">,</span>
</span><span id="call_hits-347"><a href="#call_hits-347"><span class="linenos">347</span></a>        <span class="kc">True</span><span class="p">,</span>
</span><span id="call_hits-348"><a href="#call_hits-348"><span class="linenos">348</span></a>    <span class="p">)</span>
</span><span id="call_hits-349"><a href="#call_hits-349"><span class="linenos">349</span></a>    <span class="n">num_motifs</span> <span class="o">=</span> <span class="n">cwms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="call_hits-350"><a href="#call_hits-350"><span class="linenos">350</span></a>    <span class="n">motif_width</span> <span class="o">=</span> <span class="n">cwms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="call_hits-351"><a href="#call_hits-351"><span class="linenos">351</span></a>    <span class="n">lambdas</span> <span class="o">=</span> <span class="n">motifs_df</span><span class="o">.</span><span class="n">get_column</span><span class="p">(</span><span class="s2">&quot;lambda&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">writable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="call_hits-352"><a href="#call_hits-352"><span class="linenos">352</span></a>
</span><span id="call_hits-353"><a href="#call_hits-353"><span class="linenos">353</span></a>    <span class="n">device_obj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="call_hits-354"><a href="#call_hits-354"><span class="linenos">354</span></a>    <span class="n">hits_df</span><span class="p">,</span> <span class="n">qc_df</span> <span class="o">=</span> <span class="n">hitcaller</span><span class="o">.</span><span class="n">fit_contribs</span><span class="p">(</span>
</span><span id="call_hits-355"><a href="#call_hits-355"><span class="linenos">355</span></a>        <span class="n">cwms</span><span class="p">,</span>
</span><span id="call_hits-356"><a href="#call_hits-356"><span class="linenos">356</span></a>        <span class="n">contribs</span><span class="p">,</span>
</span><span id="call_hits-357"><a href="#call_hits-357"><span class="linenos">357</span></a>        <span class="n">sequences</span><span class="p">,</span>
</span><span id="call_hits-358"><a href="#call_hits-358"><span class="linenos">358</span></a>        <span class="n">trim_masks</span><span class="p">,</span>
</span><span id="call_hits-359"><a href="#call_hits-359"><span class="linenos">359</span></a>        <span class="n">use_hypothetical_contribs</span><span class="p">,</span>
</span><span id="call_hits-360"><a href="#call_hits-360"><span class="linenos">360</span></a>        <span class="n">lambdas</span><span class="p">,</span>
</span><span id="call_hits-361"><a href="#call_hits-361"><span class="linenos">361</span></a>        <span class="n">step_size_max</span><span class="p">,</span>
</span><span id="call_hits-362"><a href="#call_hits-362"><span class="linenos">362</span></a>        <span class="n">step_size_min</span><span class="p">,</span>
</span><span id="call_hits-363"><a href="#call_hits-363"><span class="linenos">363</span></a>        <span class="n">sqrt_transform</span><span class="p">,</span>
</span><span id="call_hits-364"><a href="#call_hits-364"><span class="linenos">364</span></a>        <span class="n">convergence_tol</span><span class="p">,</span>
</span><span id="call_hits-365"><a href="#call_hits-365"><span class="linenos">365</span></a>        <span class="n">max_steps</span><span class="p">,</span>
</span><span id="call_hits-366"><a href="#call_hits-366"><span class="linenos">366</span></a>        <span class="n">batch_size</span><span class="p">,</span>
</span><span id="call_hits-367"><a href="#call_hits-367"><span class="linenos">367</span></a>        <span class="n">step_adjust</span><span class="p">,</span>
</span><span id="call_hits-368"><a href="#call_hits-368"><span class="linenos">368</span></a>        <span class="ow">not</span> <span class="n">no_post_filter</span><span class="p">,</span>
</span><span id="call_hits-369"><a href="#call_hits-369"><span class="linenos">369</span></a>        <span class="n">device_obj</span><span class="p">,</span>
</span><span id="call_hits-370"><a href="#call_hits-370"><span class="linenos">370</span></a>        <span class="n">compile_optimizer</span><span class="p">,</span>
</span><span id="call_hits-371"><a href="#call_hits-371"><span class="linenos">371</span></a>    <span class="p">)</span>
</span><span id="call_hits-372"><a href="#call_hits-372"><span class="linenos">372</span></a>
</span><span id="call_hits-373"><a href="#call_hits-373"><span class="linenos">373</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="call_hits-374"><a href="#call_hits-374"><span class="linenos">374</span></a>    <span class="n">out_path_qc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;peaks_qc.tsv&quot;</span><span class="p">)</span>
</span><span id="call_hits-375"><a href="#call_hits-375"><span class="linenos">375</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_hits</span><span class="p">(</span><span class="n">hits_df</span><span class="p">,</span> <span class="n">peaks_df</span><span class="p">,</span> <span class="n">motifs_df</span><span class="p">,</span> <span class="n">qc_df</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">,</span> <span class="n">motif_width</span><span class="p">)</span>
</span><span id="call_hits-376"><a href="#call_hits-376"><span class="linenos">376</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_qc</span><span class="p">(</span><span class="n">qc_df</span><span class="p">,</span> <span class="n">peaks_df</span><span class="p">,</span> <span class="n">out_path_qc</span><span class="p">)</span>
</span><span id="call_hits-377"><a href="#call_hits-377"><span class="linenos">377</span></a>
</span><span id="call_hits-378"><a href="#call_hits-378"><span class="linenos">378</span></a>    <span class="n">out_path_motif_df</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;motif_data.tsv&quot;</span><span class="p">)</span>
</span><span id="call_hits-379"><a href="#call_hits-379"><span class="linenos">379</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_motifs_df</span><span class="p">(</span><span class="n">motifs_df</span><span class="p">,</span> <span class="n">out_path_motif_df</span><span class="p">)</span>
</span><span id="call_hits-380"><a href="#call_hits-380"><span class="linenos">380</span></a>
</span><span id="call_hits-381"><a href="#call_hits-381"><span class="linenos">381</span></a>    <span class="n">out_path_motif_cwms</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;motif_cwms.npy&quot;</span><span class="p">)</span>
</span><span id="call_hits-382"><a href="#call_hits-382"><span class="linenos">382</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_motif_cwms</span><span class="p">(</span><span class="n">cwms</span><span class="p">,</span> <span class="n">out_path_motif_cwms</span><span class="p">)</span>
</span><span id="call_hits-383"><a href="#call_hits-383"><span class="linenos">383</span></a>
</span><span id="call_hits-384"><a href="#call_hits-384"><span class="linenos">384</span></a>    <span class="n">params</span> <span class="o">|=</span> <span class="p">{</span>
</span><span id="call_hits-385"><a href="#call_hits-385"><span class="linenos">385</span></a>        <span class="s2">&quot;region_width&quot;</span><span class="p">:</span> <span class="n">region_width</span><span class="p">,</span>
</span><span id="call_hits-386"><a href="#call_hits-386"><span class="linenos">386</span></a>        <span class="s2">&quot;num_regions&quot;</span><span class="p">:</span> <span class="n">num_regions</span><span class="p">,</span>
</span><span id="call_hits-387"><a href="#call_hits-387"><span class="linenos">387</span></a>        <span class="s2">&quot;untrimmed_motif_width&quot;</span><span class="p">:</span> <span class="n">motif_width</span><span class="p">,</span>
</span><span id="call_hits-388"><a href="#call_hits-388"><span class="linenos">388</span></a>        <span class="s2">&quot;num_motifs&quot;</span><span class="p">:</span> <span class="n">num_motifs</span><span class="p">,</span>
</span><span id="call_hits-389"><a href="#call_hits-389"><span class="linenos">389</span></a>    <span class="p">}</span>
</span><span id="call_hits-390"><a href="#call_hits-390"><span class="linenos">390</span></a>
</span><span id="call_hits-391"><a href="#call_hits-391"><span class="linenos">391</span></a>    <span class="n">out_path_params</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;parameters.json&quot;</span><span class="p">)</span>
</span><span id="call_hits-392"><a href="#call_hits-392"><span class="linenos">392</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_params</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">out_path_params</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Call motif hits using the Fi-NeMo algorithm on preprocessed genomic regions.</p>

<p>This function implements the core Fi-NeMo hit calling pipeline, which identifies
motif instances by solving a sparse reconstruction problem using proximal gradient
descent. The algorithm represents contribution scores as weighted combinations of
motif CWMs at specific positions.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>regions_path</strong> (str):
Path to NPZ file containing preprocessed regions (sequences, contributions,
and optional peak coordinates).</li>
<li><strong>peaks_path</strong> (str, optional):
DEPRECATED. Path to ENCODE NarrowPeak format file. Peak data should be
included during preprocessing instead.</li>
<li><strong>modisco_h5_path</strong> (str):
Path to TF-MoDISco H5 file containing motif CWMs.</li>
<li><strong>chrom_order_path</strong> (str, optional):
DEPRECATED. Path to chromosome ordering file.</li>
<li><strong>motifs_include_path</strong> (str, optional):
Path to file listing motif names to include in analysis.</li>
<li><strong>motif_names_path</strong> (str, optional):
Path to file mapping motif IDs to custom names.</li>
<li><strong>motif_lambdas_path</strong> (str, optional):
Path to file specifying per-motif lambda values.</li>
<li><strong>out_dir</strong> (str):
Output directory for results.</li>
<li><strong>cwm_trim_coords_path</strong> (str, optional):
Path to file specifying custom motif trimming coordinates.</li>
<li><strong>cwm_trim_thresholds_path</strong> (str, optional):
Path to file specifying custom motif trimming thresholds.</li>
<li><strong>cwm_trim_threshold_default</strong> (float):
Default threshold for motif trimming (typically 0.3).</li>
<li><strong>lambda_default</strong> (float):
Default L1 regularization weight (typically 0.7).</li>
<li><strong>step_size_max</strong> (float):
Maximum optimization step size.</li>
<li><strong>step_size_min</strong> (float):
Minimum optimization step size.</li>
<li><strong>sqrt_transform</strong> (bool):
Whether to apply signed square root transform to contributions.</li>
<li><strong>convergence_tol</strong> (float):
Convergence tolerance for duality gap.</li>
<li><strong>max_steps</strong> (int):
Maximum number of optimization steps.</li>
<li><strong>batch_size</strong> (int):
Batch size for GPU processing.</li>
<li><strong>step_adjust</strong> (float):
Step size adjustment factor on divergence.</li>
<li><strong>device</strong> (str, optional):
DEPRECATED. Use CUDA_VISIBLE_DEVICES environment variable instead.</li>
<li><strong>mode</strong> (str):
Contribution type mode ('pp', 'ph', 'hp', 'hh') where 'p'=projected, 'h'=hypothetical.</li>
<li><strong>no_post_filter</strong> (bool):
If True, skip post-hit-calling similarity filtering.</li>
<li><strong>compile_optimizer</strong> (bool):
Whether to JIT-compile the optimizer for speed.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>The Fi-NeMo algorithm solves the optimization problem:
minimize_c: ||contribs - reconstruction(c)||²₂ + λ||c||₁
subject to: c ≥ 0</p>

<p>where c represents motif hit coefficients and reconstruction uses convolution
with motif CWMs.</p>
</div>


                </section>
                <section id="report">
                            <input id="report-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">report</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">regions_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">hits_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">modisco_h5_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">motifs_include_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">motif_names_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>,</span><span class="param">	<span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">modisco_region_width</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">cwm_trim_threshold</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">compute_recall</span><span class="p">:</span> <span class="nb">bool</span>,</span><span class="param">	<span class="n">use_seqlets</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="report-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#report"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="report-395"><a href="#report-395"><span class="linenos">395</span></a><span class="k">def</span><span class="w"> </span><span class="nf">report</span><span class="p">(</span>
</span><span id="report-396"><a href="#report-396"><span class="linenos">396</span></a>    <span class="n">regions_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="report-397"><a href="#report-397"><span class="linenos">397</span></a>    <span class="n">hits_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="report-398"><a href="#report-398"><span class="linenos">398</span></a>    <span class="n">modisco_h5_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="report-399"><a href="#report-399"><span class="linenos">399</span></a>    <span class="n">peaks_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="report-400"><a href="#report-400"><span class="linenos">400</span></a>    <span class="n">motifs_include_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="report-401"><a href="#report-401"><span class="linenos">401</span></a>    <span class="n">motif_names_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span><span id="report-402"><a href="#report-402"><span class="linenos">402</span></a>    <span class="n">out_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="report-403"><a href="#report-403"><span class="linenos">403</span></a>    <span class="n">modisco_region_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="report-404"><a href="#report-404"><span class="linenos">404</span></a>    <span class="n">cwm_trim_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="report-405"><a href="#report-405"><span class="linenos">405</span></a>    <span class="n">compute_recall</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="report-406"><a href="#report-406"><span class="linenos">406</span></a>    <span class="n">use_seqlets</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="report-407"><a href="#report-407"><span class="linenos">407</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="report-408"><a href="#report-408"><span class="linenos">408</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate comprehensive HTML report with statistics and visualizations.</span>
</span><span id="report-409"><a href="#report-409"><span class="linenos">409</span></a>
</span><span id="report-410"><a href="#report-410"><span class="linenos">410</span></a><span class="sd">    This function creates detailed analysis reports comparing Fi-NeMo hit calling</span>
</span><span id="report-411"><a href="#report-411"><span class="linenos">411</span></a><span class="sd">    results with TF-MoDISco seqlets, including performance metrics, distribution</span>
</span><span id="report-412"><a href="#report-412"><span class="linenos">412</span></a><span class="sd">    plots, and motif visualization. The report provides insights into hit calling</span>
</span><span id="report-413"><a href="#report-413"><span class="linenos">413</span></a><span class="sd">    quality and motif discovery accuracy.</span>
</span><span id="report-414"><a href="#report-414"><span class="linenos">414</span></a>
</span><span id="report-415"><a href="#report-415"><span class="linenos">415</span></a><span class="sd">    Parameters</span>
</span><span id="report-416"><a href="#report-416"><span class="linenos">416</span></a><span class="sd">    ----------</span>
</span><span id="report-417"><a href="#report-417"><span class="linenos">417</span></a><span class="sd">    regions_path : str</span>
</span><span id="report-418"><a href="#report-418"><span class="linenos">418</span></a><span class="sd">        Path to NPZ file containing the same regions used for hit calling.</span>
</span><span id="report-419"><a href="#report-419"><span class="linenos">419</span></a><span class="sd">    hits_dir : str</span>
</span><span id="report-420"><a href="#report-420"><span class="linenos">420</span></a><span class="sd">        Path to directory containing Fi-NeMo hit calling outputs.</span>
</span><span id="report-421"><a href="#report-421"><span class="linenos">421</span></a><span class="sd">    modisco_h5_path : str, optional</span>
</span><span id="report-422"><a href="#report-422"><span class="linenos">422</span></a><span class="sd">        Path to TF-MoDISco H5 file. If None, seqlet comparisons are skipped.</span>
</span><span id="report-423"><a href="#report-423"><span class="linenos">423</span></a><span class="sd">    peaks_path : str, optional</span>
</span><span id="report-424"><a href="#report-424"><span class="linenos">424</span></a><span class="sd">        DEPRECATED. Peak coordinates should be included in regions file.</span>
</span><span id="report-425"><a href="#report-425"><span class="linenos">425</span></a><span class="sd">    motifs_include_path : str, optional</span>
</span><span id="report-426"><a href="#report-426"><span class="linenos">426</span></a><span class="sd">        DEPRECATED. This information is inferred from hit calling outputs.</span>
</span><span id="report-427"><a href="#report-427"><span class="linenos">427</span></a><span class="sd">    motif_names_path : str, optional</span>
</span><span id="report-428"><a href="#report-428"><span class="linenos">428</span></a><span class="sd">        DEPRECATED. This information is inferred from hit calling outputs.</span>
</span><span id="report-429"><a href="#report-429"><span class="linenos">429</span></a><span class="sd">    out_dir : str</span>
</span><span id="report-430"><a href="#report-430"><span class="linenos">430</span></a><span class="sd">        Output directory for report files.</span>
</span><span id="report-431"><a href="#report-431"><span class="linenos">431</span></a><span class="sd">    modisco_region_width : int</span>
</span><span id="report-432"><a href="#report-432"><span class="linenos">432</span></a><span class="sd">        Width of regions used by TF-MoDISco (needed for coordinate conversion).</span>
</span><span id="report-433"><a href="#report-433"><span class="linenos">433</span></a><span class="sd">    cwm_trim_threshold : float</span>
</span><span id="report-434"><a href="#report-434"><span class="linenos">434</span></a><span class="sd">        DEPRECATED. This information is inferred from hit calling outputs.</span>
</span><span id="report-435"><a href="#report-435"><span class="linenos">435</span></a><span class="sd">    compute_recall : bool</span>
</span><span id="report-436"><a href="#report-436"><span class="linenos">436</span></a><span class="sd">        Whether to compute recall metrics against TF-MoDISco seqlets.</span>
</span><span id="report-437"><a href="#report-437"><span class="linenos">437</span></a><span class="sd">    use_seqlets : bool</span>
</span><span id="report-438"><a href="#report-438"><span class="linenos">438</span></a><span class="sd">        Whether to include seqlet-based comparisons in the report.</span>
</span><span id="report-439"><a href="#report-439"><span class="linenos">439</span></a>
</span><span id="report-440"><a href="#report-440"><span class="linenos">440</span></a><span class="sd">    Notes</span>
</span><span id="report-441"><a href="#report-441"><span class="linenos">441</span></a><span class="sd">    -----</span>
</span><span id="report-442"><a href="#report-442"><span class="linenos">442</span></a><span class="sd">    The generated report includes:</span>
</span><span id="report-443"><a href="#report-443"><span class="linenos">443</span></a><span class="sd">    - Hit vs seqlet count comparisons</span>
</span><span id="report-444"><a href="#report-444"><span class="linenos">444</span></a><span class="sd">    - Motif CWM visualizations</span>
</span><span id="report-445"><a href="#report-445"><span class="linenos">445</span></a><span class="sd">    - Hit statistic distributions</span>
</span><span id="report-446"><a href="#report-446"><span class="linenos">446</span></a><span class="sd">    - Co-occurrence heatmaps</span>
</span><span id="report-447"><a href="#report-447"><span class="linenos">447</span></a><span class="sd">    - Confusion matrices for overlapping motifs</span>
</span><span id="report-448"><a href="#report-448"><span class="linenos">448</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="report-449"><a href="#report-449"><span class="linenos">449</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">evaluation</span><span class="p">,</span> <span class="n">visualization</span>
</span><span id="report-450"><a href="#report-450"><span class="linenos">450</span></a>
</span><span id="report-451"><a href="#report-451"><span class="linenos">451</span></a>    <span class="n">sequences</span><span class="p">,</span> <span class="n">contribs</span><span class="p">,</span> <span class="n">peaks_df</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_regions_npz</span><span class="p">(</span><span class="n">regions_path</span><span class="p">)</span>
</span><span id="report-452"><a href="#report-452"><span class="linenos">452</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contribs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="report-453"><a href="#report-453"><span class="linenos">453</span></a>        <span class="n">regions</span> <span class="o">=</span> <span class="n">contribs</span> <span class="o">*</span> <span class="n">sequences</span>
</span><span id="report-454"><a href="#report-454"><span class="linenos">454</span></a>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">contribs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="report-455"><a href="#report-455"><span class="linenos">455</span></a>        <span class="n">regions</span> <span class="o">=</span> <span class="n">contribs</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">sequences</span>
</span><span id="report-456"><a href="#report-456"><span class="linenos">456</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="report-457"><a href="#report-457"><span class="linenos">457</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected contribs shape: </span><span class="si">{</span><span class="n">contribs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="report-458"><a href="#report-458"><span class="linenos">458</span></a>
</span><span id="report-459"><a href="#report-459"><span class="linenos">459</span></a>    <span class="n">half_width</span> <span class="o">=</span> <span class="n">regions</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="report-460"><a href="#report-460"><span class="linenos">460</span></a>    <span class="n">modisco_half_width</span> <span class="o">=</span> <span class="n">modisco_region_width</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="report-461"><a href="#report-461"><span class="linenos">461</span></a>
</span><span id="report-462"><a href="#report-462"><span class="linenos">462</span></a>    <span class="k">if</span> <span class="n">peaks_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="report-463"><a href="#report-463"><span class="linenos">463</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="report-464"><a href="#report-464"><span class="linenos">464</span></a>            <span class="s2">&quot;Providing a peaks file to `report` is deprecated, and this option will be removed in a future version. Peaks should instead be provided in the preprocessing step to be included in `regions.npz`.&quot;</span>
</span><span id="report-465"><a href="#report-465"><span class="linenos">465</span></a>        <span class="p">)</span>
</span><span id="report-466"><a href="#report-466"><span class="linenos">466</span></a>        <span class="n">peaks_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_peaks</span><span class="p">(</span><span class="n">peaks_path</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">half_width</span><span class="p">)</span>
</span><span id="report-467"><a href="#report-467"><span class="linenos">467</span></a>
</span><span id="report-468"><a href="#report-468"><span class="linenos">468</span></a>    <span class="k">if</span> <span class="n">hits_dir</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.tsv&quot;</span><span class="p">):</span>
</span><span id="report-469"><a href="#report-469"><span class="linenos">469</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="report-470"><a href="#report-470"><span class="linenos">470</span></a>            <span class="s2">&quot;Passing a hits.tsv file to `finemo report` is deprecated. Please provide the directory containing the hits.tsv file instead.&quot;</span>
</span><span id="report-471"><a href="#report-471"><span class="linenos">471</span></a>        <span class="p">)</span>
</span><span id="report-472"><a href="#report-472"><span class="linenos">472</span></a>
</span><span id="report-473"><a href="#report-473"><span class="linenos">473</span></a>        <span class="n">hits_path</span> <span class="o">=</span> <span class="n">hits_dir</span>
</span><span id="report-474"><a href="#report-474"><span class="linenos">474</span></a>
</span><span id="report-475"><a href="#report-475"><span class="linenos">475</span></a>        <span class="n">hits_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_hits</span><span class="p">(</span><span class="n">hits_path</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="report-476"><a href="#report-476"><span class="linenos">476</span></a>
</span><span id="report-477"><a href="#report-477"><span class="linenos">477</span></a>        <span class="k">if</span> <span class="n">motifs_include_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="report-478"><a href="#report-478"><span class="linenos">478</span></a>            <span class="n">motifs_include</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_txt</span><span class="p">(</span><span class="n">motifs_include_path</span><span class="p">)</span>
</span><span id="report-479"><a href="#report-479"><span class="linenos">479</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="report-480"><a href="#report-480"><span class="linenos">480</span></a>            <span class="n">motifs_include</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="report-481"><a href="#report-481"><span class="linenos">481</span></a>
</span><span id="report-482"><a href="#report-482"><span class="linenos">482</span></a>        <span class="k">if</span> <span class="n">motif_names_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="report-483"><a href="#report-483"><span class="linenos">483</span></a>            <span class="n">motif_name_map</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_mapping</span><span class="p">(</span><span class="n">motif_names_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="report-484"><a href="#report-484"><span class="linenos">484</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="report-485"><a href="#report-485"><span class="linenos">485</span></a>            <span class="n">motif_name_map</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="report-486"><a href="#report-486"><span class="linenos">486</span></a>
</span><span id="report-487"><a href="#report-487"><span class="linenos">487</span></a>        <span class="k">if</span> <span class="n">modisco_h5_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="report-488"><a href="#report-488"><span class="linenos">488</span></a>            <span class="n">motifs_df</span><span class="p">,</span> <span class="n">cwms_modisco</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">motif_names</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_modisco_motifs</span><span class="p">(</span>
</span><span id="report-489"><a href="#report-489"><span class="linenos">489</span></a>                <span class="n">modisco_h5_path</span><span class="p">,</span>
</span><span id="report-490"><a href="#report-490"><span class="linenos">490</span></a>                <span class="kc">None</span><span class="p">,</span>
</span><span id="report-491"><a href="#report-491"><span class="linenos">491</span></a>                <span class="kc">None</span><span class="p">,</span>
</span><span id="report-492"><a href="#report-492"><span class="linenos">492</span></a>                <span class="n">cwm_trim_threshold</span><span class="p">,</span>
</span><span id="report-493"><a href="#report-493"><span class="linenos">493</span></a>                <span class="s2">&quot;cwm&quot;</span><span class="p">,</span>
</span><span id="report-494"><a href="#report-494"><span class="linenos">494</span></a>                <span class="n">motifs_include</span><span class="p">,</span>
</span><span id="report-495"><a href="#report-495"><span class="linenos">495</span></a>                <span class="n">motif_name_map</span><span class="p">,</span>
</span><span id="report-496"><a href="#report-496"><span class="linenos">496</span></a>                <span class="kc">None</span><span class="p">,</span>
</span><span id="report-497"><a href="#report-497"><span class="linenos">497</span></a>                <span class="mf">1.0</span><span class="p">,</span>
</span><span id="report-498"><a href="#report-498"><span class="linenos">498</span></a>                <span class="kc">True</span><span class="p">,</span>
</span><span id="report-499"><a href="#report-499"><span class="linenos">499</span></a>            <span class="p">)</span>
</span><span id="report-500"><a href="#report-500"><span class="linenos">500</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="report-501"><a href="#report-501"><span class="linenos">501</span></a>            <span class="c1"># When no modisco_h5_path is provided in legacy TSV mode, we can&#39;t compute motifs</span>
</span><span id="report-502"><a href="#report-502"><span class="linenos">502</span></a>            <span class="c1"># This will cause an error later, but that&#39;s expected behavior</span>
</span><span id="report-503"><a href="#report-503"><span class="linenos">503</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="report-504"><a href="#report-504"><span class="linenos">504</span></a>                <span class="s2">&quot;modisco_h5_path is required when providing a hits.tsv file directly&quot;</span>
</span><span id="report-505"><a href="#report-505"><span class="linenos">505</span></a>            <span class="p">)</span>
</span><span id="report-506"><a href="#report-506"><span class="linenos">506</span></a>
</span><span id="report-507"><a href="#report-507"><span class="linenos">507</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="report-508"><a href="#report-508"><span class="linenos">508</span></a>        <span class="n">hits_df_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hits_dir</span><span class="p">,</span> <span class="s2">&quot;hits.tsv&quot;</span><span class="p">)</span>
</span><span id="report-509"><a href="#report-509"><span class="linenos">509</span></a>        <span class="n">hits_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_hits</span><span class="p">(</span><span class="n">hits_df_path</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="report-510"><a href="#report-510"><span class="linenos">510</span></a>
</span><span id="report-511"><a href="#report-511"><span class="linenos">511</span></a>        <span class="n">motifs_df_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hits_dir</span><span class="p">,</span> <span class="s2">&quot;motif_data.tsv&quot;</span><span class="p">)</span>
</span><span id="report-512"><a href="#report-512"><span class="linenos">512</span></a>        <span class="n">motifs_df</span><span class="p">,</span> <span class="n">motif_names</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_motifs_df</span><span class="p">(</span><span class="n">motifs_df_path</span><span class="p">)</span>
</span><span id="report-513"><a href="#report-513"><span class="linenos">513</span></a>
</span><span id="report-514"><a href="#report-514"><span class="linenos">514</span></a>        <span class="n">cwms_modisco_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hits_dir</span><span class="p">,</span> <span class="s2">&quot;motif_cwms.npy&quot;</span><span class="p">)</span>
</span><span id="report-515"><a href="#report-515"><span class="linenos">515</span></a>        <span class="n">cwms_modisco</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_motif_cwms</span><span class="p">(</span><span class="n">cwms_modisco_path</span><span class="p">)</span>
</span><span id="report-516"><a href="#report-516"><span class="linenos">516</span></a>
</span><span id="report-517"><a href="#report-517"><span class="linenos">517</span></a>        <span class="n">params_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">hits_dir</span><span class="p">,</span> <span class="s2">&quot;parameters.json&quot;</span><span class="p">)</span>
</span><span id="report-518"><a href="#report-518"><span class="linenos">518</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_params</span><span class="p">(</span><span class="n">params_path</span><span class="p">)</span>
</span><span id="report-519"><a href="#report-519"><span class="linenos">519</span></a>        <span class="n">cwm_trim_threshold</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;cwm_trim_threshold_default&quot;</span><span class="p">]</span>
</span><span id="report-520"><a href="#report-520"><span class="linenos">520</span></a>
</span><span id="report-521"><a href="#report-521"><span class="linenos">521</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_seqlets</span><span class="p">:</span>
</span><span id="report-522"><a href="#report-522"><span class="linenos">522</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="report-523"><a href="#report-523"><span class="linenos">523</span></a>            <span class="s2">&quot;Usage of the `--no-seqlets` flag is deprecated and will be removed in a future version. Please omit the `--modisco-h5` argument instead.&quot;</span>
</span><span id="report-524"><a href="#report-524"><span class="linenos">524</span></a>        <span class="p">)</span>
</span><span id="report-525"><a href="#report-525"><span class="linenos">525</span></a>        <span class="n">seqlets_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="report-526"><a href="#report-526"><span class="linenos">526</span></a>    <span class="k">elif</span> <span class="n">modisco_h5_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="report-527"><a href="#report-527"><span class="linenos">527</span></a>        <span class="n">compute_recall</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="report-528"><a href="#report-528"><span class="linenos">528</span></a>        <span class="n">seqlets_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="report-529"><a href="#report-529"><span class="linenos">529</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="report-530"><a href="#report-530"><span class="linenos">530</span></a>        <span class="n">seqlets_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_modisco_seqlets</span><span class="p">(</span>
</span><span id="report-531"><a href="#report-531"><span class="linenos">531</span></a>            <span class="n">modisco_h5_path</span><span class="p">,</span>
</span><span id="report-532"><a href="#report-532"><span class="linenos">532</span></a>            <span class="n">peaks_df</span><span class="p">,</span>
</span><span id="report-533"><a href="#report-533"><span class="linenos">533</span></a>            <span class="n">motifs_df</span><span class="p">,</span>
</span><span id="report-534"><a href="#report-534"><span class="linenos">534</span></a>            <span class="n">half_width</span><span class="p">,</span>
</span><span id="report-535"><a href="#report-535"><span class="linenos">535</span></a>            <span class="n">modisco_half_width</span><span class="p">,</span>
</span><span id="report-536"><a href="#report-536"><span class="linenos">536</span></a>            <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="report-537"><a href="#report-537"><span class="linenos">537</span></a>        <span class="p">)</span>
</span><span id="report-538"><a href="#report-538"><span class="linenos">538</span></a>
</span><span id="report-539"><a href="#report-539"><span class="linenos">539</span></a>    <span class="n">motif_width</span> <span class="o">=</span> <span class="n">cwms_modisco</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="report-540"><a href="#report-540"><span class="linenos">540</span></a>
</span><span id="report-541"><a href="#report-541"><span class="linenos">541</span></a>    <span class="c1"># Convert to LazyFrame if needed and ensure motif_names is a list</span>
</span><span id="report-542"><a href="#report-542"><span class="linenos">542</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hits_df</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">):</span>
</span><span id="report-543"><a href="#report-543"><span class="linenos">543</span></a>        <span class="n">hits_df_lazy</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span> <span class="o">=</span> <span class="n">hits_df</span>
</span><span id="report-544"><a href="#report-544"><span class="linenos">544</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="report-545"><a href="#report-545"><span class="linenos">545</span></a>        <span class="n">hits_df_lazy</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span> <span class="o">=</span> <span class="n">hits_df</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span>
</span><span id="report-546"><a href="#report-546"><span class="linenos">546</span></a>
</span><span id="report-547"><a href="#report-547"><span class="linenos">547</span></a>    <span class="n">motif_names_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">motif_names</span><span class="p">)</span>
</span><span id="report-548"><a href="#report-548"><span class="linenos">548</span></a>
</span><span id="report-549"><a href="#report-549"><span class="linenos">549</span></a>    <span class="n">occ_df</span><span class="p">,</span> <span class="n">coooc</span> <span class="o">=</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">get_motif_occurences</span><span class="p">(</span><span class="n">hits_df_lazy</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">)</span>
</span><span id="report-550"><a href="#report-550"><span class="linenos">550</span></a>
</span><span id="report-551"><a href="#report-551"><span class="linenos">551</span></a>    <span class="n">report_data</span><span class="p">,</span> <span class="n">report_df</span><span class="p">,</span> <span class="n">cwms</span><span class="p">,</span> <span class="n">trim_bounds</span> <span class="o">=</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">tfmodisco_comparison</span><span class="p">(</span>
</span><span id="report-552"><a href="#report-552"><span class="linenos">552</span></a>        <span class="n">regions</span><span class="p">,</span>
</span><span id="report-553"><a href="#report-553"><span class="linenos">553</span></a>        <span class="n">hits_df</span><span class="p">,</span>
</span><span id="report-554"><a href="#report-554"><span class="linenos">554</span></a>        <span class="n">peaks_df</span><span class="p">,</span>
</span><span id="report-555"><a href="#report-555"><span class="linenos">555</span></a>        <span class="n">seqlets_df</span><span class="p">,</span>
</span><span id="report-556"><a href="#report-556"><span class="linenos">556</span></a>        <span class="n">motifs_df</span><span class="p">,</span>
</span><span id="report-557"><a href="#report-557"><span class="linenos">557</span></a>        <span class="n">cwms_modisco</span><span class="p">,</span>
</span><span id="report-558"><a href="#report-558"><span class="linenos">558</span></a>        <span class="n">motif_names_list</span><span class="p">,</span>
</span><span id="report-559"><a href="#report-559"><span class="linenos">559</span></a>        <span class="n">modisco_half_width</span><span class="p">,</span>
</span><span id="report-560"><a href="#report-560"><span class="linenos">560</span></a>        <span class="n">motif_width</span><span class="p">,</span>
</span><span id="report-561"><a href="#report-561"><span class="linenos">561</span></a>        <span class="n">compute_recall</span><span class="p">,</span>
</span><span id="report-562"><a href="#report-562"><span class="linenos">562</span></a>    <span class="p">)</span>
</span><span id="report-563"><a href="#report-563"><span class="linenos">563</span></a>
</span><span id="report-564"><a href="#report-564"><span class="linenos">564</span></a>    <span class="k">if</span> <span class="n">seqlets_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="report-565"><a href="#report-565"><span class="linenos">565</span></a>        <span class="n">confusion_df</span><span class="p">,</span> <span class="n">confusion_mat</span> <span class="o">=</span> <span class="n">evaluation</span><span class="o">.</span><span class="n">seqlet_confusion</span><span class="p">(</span>
</span><span id="report-566"><a href="#report-566"><span class="linenos">566</span></a>            <span class="n">hits_df</span><span class="p">,</span> <span class="n">seqlets_df</span><span class="p">,</span> <span class="n">peaks_df</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">,</span> <span class="n">motif_width</span>
</span><span id="report-567"><a href="#report-567"><span class="linenos">567</span></a>        <span class="p">)</span>
</span><span id="report-568"><a href="#report-568"><span class="linenos">568</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="report-569"><a href="#report-569"><span class="linenos">569</span></a>        <span class="n">confusion_df</span><span class="p">,</span> <span class="n">confusion_mat</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="report-570"><a href="#report-570"><span class="linenos">570</span></a>
</span><span id="report-571"><a href="#report-571"><span class="linenos">571</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="report-572"><a href="#report-572"><span class="linenos">572</span></a>
</span><span id="report-573"><a href="#report-573"><span class="linenos">573</span></a>    <span class="n">occ_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;motif_occurrences.tsv&quot;</span><span class="p">)</span>
</span><span id="report-574"><a href="#report-574"><span class="linenos">574</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_occ_df</span><span class="p">(</span><span class="n">occ_df</span><span class="p">,</span> <span class="n">occ_path</span><span class="p">)</span>
</span><span id="report-575"><a href="#report-575"><span class="linenos">575</span></a>
</span><span id="report-576"><a href="#report-576"><span class="linenos">576</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_report_data</span><span class="p">(</span><span class="n">report_df</span><span class="p">,</span> <span class="n">cwms</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>
</span><span id="report-577"><a href="#report-577"><span class="linenos">577</span></a>
</span><span id="report-578"><a href="#report-578"><span class="linenos">578</span></a>    <span class="n">visualization</span><span class="o">.</span><span class="n">plot_hit_stat_distributions</span><span class="p">(</span><span class="n">hits_df_lazy</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>
</span><span id="report-579"><a href="#report-579"><span class="linenos">579</span></a>    <span class="n">visualization</span><span class="o">.</span><span class="n">plot_hit_peak_distributions</span><span class="p">(</span><span class="n">occ_df</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>
</span><span id="report-580"><a href="#report-580"><span class="linenos">580</span></a>    <span class="n">visualization</span><span class="o">.</span><span class="n">plot_peak_motif_indicator_heatmap</span><span class="p">(</span><span class="n">coooc</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>
</span><span id="report-581"><a href="#report-581"><span class="linenos">581</span></a>
</span><span id="report-582"><a href="#report-582"><span class="linenos">582</span></a>    <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;CWMs&quot;</span><span class="p">)</span>
</span><span id="report-583"><a href="#report-583"><span class="linenos">583</span></a>    <span class="n">visualization</span><span class="o">.</span><span class="n">plot_cwms</span><span class="p">(</span><span class="n">cwms</span><span class="p">,</span> <span class="n">trim_bounds</span><span class="p">,</span> <span class="n">plot_dir</span><span class="p">)</span>
</span><span id="report-584"><a href="#report-584"><span class="linenos">584</span></a>
</span><span id="report-585"><a href="#report-585"><span class="linenos">585</span></a>    <span class="k">if</span> <span class="n">seqlets_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="report-586"><a href="#report-586"><span class="linenos">586</span></a>        <span class="n">seqlets_collected</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="report-587"><a href="#report-587"><span class="linenos">587</span></a>            <span class="n">seqlets_df</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seqlets_df</span><span class="p">,</span> <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">)</span> <span class="k">else</span> <span class="n">seqlets_df</span>
</span><span id="report-588"><a href="#report-588"><span class="linenos">588</span></a>        <span class="p">)</span>
</span><span id="report-589"><a href="#report-589"><span class="linenos">589</span></a>        <span class="n">seqlets_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;seqlets.tsv&quot;</span><span class="p">)</span>
</span><span id="report-590"><a href="#report-590"><span class="linenos">590</span></a>        <span class="n">data_io</span><span class="o">.</span><span class="n">write_modisco_seqlets</span><span class="p">(</span><span class="n">seqlets_collected</span><span class="p">,</span> <span class="n">seqlets_path</span><span class="p">)</span>
</span><span id="report-591"><a href="#report-591"><span class="linenos">591</span></a>
</span><span id="report-592"><a href="#report-592"><span class="linenos">592</span></a>        <span class="k">if</span> <span class="n">confusion_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">confusion_mat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="report-593"><a href="#report-593"><span class="linenos">593</span></a>            <span class="n">seqlet_confusion_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;seqlet_confusion.tsv&quot;</span><span class="p">)</span>
</span><span id="report-594"><a href="#report-594"><span class="linenos">594</span></a>            <span class="n">data_io</span><span class="o">.</span><span class="n">write_seqlet_confusion_df</span><span class="p">(</span><span class="n">confusion_df</span><span class="p">,</span> <span class="n">seqlet_confusion_path</span><span class="p">)</span>
</span><span id="report-595"><a href="#report-595"><span class="linenos">595</span></a>
</span><span id="report-596"><a href="#report-596"><span class="linenos">596</span></a>            <span class="n">visualization</span><span class="o">.</span><span class="n">plot_hit_vs_seqlet_counts</span><span class="p">(</span><span class="n">report_data</span><span class="p">,</span> <span class="n">out_dir</span><span class="p">)</span>
</span><span id="report-597"><a href="#report-597"><span class="linenos">597</span></a>            <span class="n">visualization</span><span class="o">.</span><span class="n">plot_seqlet_confusion_heatmap</span><span class="p">(</span>
</span><span id="report-598"><a href="#report-598"><span class="linenos">598</span></a>                <span class="n">confusion_mat</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">,</span> <span class="n">out_dir</span>
</span><span id="report-599"><a href="#report-599"><span class="linenos">599</span></a>            <span class="p">)</span>
</span><span id="report-600"><a href="#report-600"><span class="linenos">600</span></a>
</span><span id="report-601"><a href="#report-601"><span class="linenos">601</span></a>    <span class="n">report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="s2">&quot;report.html&quot;</span><span class="p">)</span>
</span><span id="report-602"><a href="#report-602"><span class="linenos">602</span></a>    <span class="n">visualization</span><span class="o">.</span><span class="n">write_report</span><span class="p">(</span>
</span><span id="report-603"><a href="#report-603"><span class="linenos">603</span></a>        <span class="n">report_df</span><span class="p">,</span> <span class="n">motif_names_list</span><span class="p">,</span> <span class="n">report_path</span><span class="p">,</span> <span class="n">compute_recall</span><span class="p">,</span> <span class="n">seqlets_df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="report-604"><a href="#report-604"><span class="linenos">604</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate comprehensive HTML report with statistics and visualizations.</p>

<p>This function creates detailed analysis reports comparing Fi-NeMo hit calling
results with TF-MoDISco seqlets, including performance metrics, distribution
plots, and motif visualization. The report provides insights into hit calling
quality and motif discovery accuracy.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>regions_path</strong> (str):
Path to NPZ file containing the same regions used for hit calling.</li>
<li><strong>hits_dir</strong> (str):
Path to directory containing Fi-NeMo hit calling outputs.</li>
<li><strong>modisco_h5_path</strong> (str, optional):
Path to TF-MoDISco H5 file. If None, seqlet comparisons are skipped.</li>
<li><strong>peaks_path</strong> (str, optional):
DEPRECATED. Peak coordinates should be included in regions file.</li>
<li><strong>motifs_include_path</strong> (str, optional):
DEPRECATED. This information is inferred from hit calling outputs.</li>
<li><strong>motif_names_path</strong> (str, optional):
DEPRECATED. This information is inferred from hit calling outputs.</li>
<li><strong>out_dir</strong> (str):
Output directory for report files.</li>
<li><strong>modisco_region_width</strong> (int):
Width of regions used by TF-MoDISco (needed for coordinate conversion).</li>
<li><strong>cwm_trim_threshold</strong> (float):
DEPRECATED. This information is inferred from hit calling outputs.</li>
<li><strong>compute_recall</strong> (bool):
Whether to compute recall metrics against TF-MoDISco seqlets.</li>
<li><strong>use_seqlets</strong> (bool):
Whether to include seqlet-based comparisons in the report.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>The generated report includes:</p>

<ul>
<li>Hit vs seqlet count comparisons</li>
<li>Motif CWM visualizations</li>
<li>Hit statistic distributions</li>
<li>Co-occurrence heatmaps</li>
<li>Confusion matrices for overlapping motifs</li>
</ul>
</div>


                </section>
                <section id="collapse_hits">
                            <input id="collapse_hits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">collapse_hits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">hits_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">overlap_frac</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="collapse_hits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#collapse_hits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="collapse_hits-607"><a href="#collapse_hits-607"><span class="linenos">607</span></a><span class="k">def</span><span class="w"> </span><span class="nf">collapse_hits</span><span class="p">(</span><span class="n">hits_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">overlap_frac</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="collapse_hits-608"><a href="#collapse_hits-608"><span class="linenos">608</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Collapse overlapping hits by selecting the best hit per overlapping group.</span>
</span><span id="collapse_hits-609"><a href="#collapse_hits-609"><span class="linenos">609</span></a>
</span><span id="collapse_hits-610"><a href="#collapse_hits-610"><span class="linenos">610</span></a><span class="sd">    This function processes a set of motif hits and identifies overlapping hits,</span>
</span><span id="collapse_hits-611"><a href="#collapse_hits-611"><span class="linenos">611</span></a><span class="sd">    keeping only the hit with the highest similarity score within each overlapping</span>
</span><span id="collapse_hits-612"><a href="#collapse_hits-612"><span class="linenos">612</span></a><span class="sd">    group. This reduces redundancy in hit calls while preserving the most confident</span>
</span><span id="collapse_hits-613"><a href="#collapse_hits-613"><span class="linenos">613</span></a><span class="sd">    predictions.</span>
</span><span id="collapse_hits-614"><a href="#collapse_hits-614"><span class="linenos">614</span></a>
</span><span id="collapse_hits-615"><a href="#collapse_hits-615"><span class="linenos">615</span></a><span class="sd">    Parameters</span>
</span><span id="collapse_hits-616"><a href="#collapse_hits-616"><span class="linenos">616</span></a><span class="sd">    ----------</span>
</span><span id="collapse_hits-617"><a href="#collapse_hits-617"><span class="linenos">617</span></a><span class="sd">    hits_path : str</span>
</span><span id="collapse_hits-618"><a href="#collapse_hits-618"><span class="linenos">618</span></a><span class="sd">        Path to input TSV file containing hit data (hits.tsv or hits_unique.tsv).</span>
</span><span id="collapse_hits-619"><a href="#collapse_hits-619"><span class="linenos">619</span></a><span class="sd">    out_path : str</span>
</span><span id="collapse_hits-620"><a href="#collapse_hits-620"><span class="linenos">620</span></a><span class="sd">        Path to output TSV file with additional &#39;is_primary&#39; column.</span>
</span><span id="collapse_hits-621"><a href="#collapse_hits-621"><span class="linenos">621</span></a><span class="sd">    overlap_frac : float</span>
</span><span id="collapse_hits-622"><a href="#collapse_hits-622"><span class="linenos">622</span></a><span class="sd">        Minimum fractional overlap for considering hits as overlapping.</span>
</span><span id="collapse_hits-623"><a href="#collapse_hits-623"><span class="linenos">623</span></a><span class="sd">        For hits of lengths x and y, minimum overlap = overlap_frac * (x + y) / 2.</span>
</span><span id="collapse_hits-624"><a href="#collapse_hits-624"><span class="linenos">624</span></a>
</span><span id="collapse_hits-625"><a href="#collapse_hits-625"><span class="linenos">625</span></a><span class="sd">    Notes</span>
</span><span id="collapse_hits-626"><a href="#collapse_hits-626"><span class="linenos">626</span></a><span class="sd">    -----</span>
</span><span id="collapse_hits-627"><a href="#collapse_hits-627"><span class="linenos">627</span></a><span class="sd">    The algorithm uses a sweep line approach with a heap data structure to</span>
</span><span id="collapse_hits-628"><a href="#collapse_hits-628"><span class="linenos">628</span></a><span class="sd">    efficiently identify overlapping intervals and select the best hit based</span>
</span><span id="collapse_hits-629"><a href="#collapse_hits-629"><span class="linenos">629</span></a><span class="sd">    on similarity scores.</span>
</span><span id="collapse_hits-630"><a href="#collapse_hits-630"><span class="linenos">630</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="collapse_hits-631"><a href="#collapse_hits-631"><span class="linenos">631</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">postprocessing</span>
</span><span id="collapse_hits-632"><a href="#collapse_hits-632"><span class="linenos">632</span></a>
</span><span id="collapse_hits-633"><a href="#collapse_hits-633"><span class="linenos">633</span></a>    <span class="n">hits_df</span> <span class="o">=</span> <span class="n">data_io</span><span class="o">.</span><span class="n">load_hits</span><span class="p">(</span><span class="n">hits_path</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="collapse_hits-634"><a href="#collapse_hits-634"><span class="linenos">634</span></a>    <span class="n">hits_collapsed_df</span> <span class="o">=</span> <span class="n">postprocessing</span><span class="o">.</span><span class="n">collapse_hits</span><span class="p">(</span><span class="n">hits_df</span><span class="p">,</span> <span class="n">overlap_frac</span><span class="p">)</span>
</span><span id="collapse_hits-635"><a href="#collapse_hits-635"><span class="linenos">635</span></a>
</span><span id="collapse_hits-636"><a href="#collapse_hits-636"><span class="linenos">636</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_hits_processed</span><span class="p">(</span>
</span><span id="collapse_hits-637"><a href="#collapse_hits-637"><span class="linenos">637</span></a>        <span class="n">hits_collapsed_df</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">data_io</span><span class="o">.</span><span class="n">HITS_COLLAPSED_DTYPES</span>
</span><span id="collapse_hits-638"><a href="#collapse_hits-638"><span class="linenos">638</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Collapse overlapping hits by selecting the best hit per overlapping group.</p>

<p>This function processes a set of motif hits and identifies overlapping hits,
keeping only the hit with the highest similarity score within each overlapping
group. This reduces redundancy in hit calls while preserving the most confident
predictions.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>hits_path</strong> (str):
Path to input TSV file containing hit data (hits.tsv or hits_unique.tsv).</li>
<li><strong>out_path</strong> (str):
Path to output TSV file with additional 'is_primary' column.</li>
<li><strong>overlap_frac</strong> (float):
Minimum fractional overlap for considering hits as overlapping.
For hits of lengths x and y, minimum overlap = overlap_frac * (x + y) / 2.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>The algorithm uses a sweep line approach with a heap data structure to
efficiently identify overlapping intervals and select the best hit based
on similarity scores.</p>
</div>


                </section>
                <section id="intersect_hits">
                            <input id="intersect_hits-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">intersect_hits</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">hits_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>, </span><span class="param"><span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">relaxed</span><span class="p">:</span> <span class="nb">bool</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="intersect_hits-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#intersect_hits"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="intersect_hits-641"><a href="#intersect_hits-641"><span class="linenos">641</span></a><span class="k">def</span><span class="w"> </span><span class="nf">intersect_hits</span><span class="p">(</span><span class="n">hits_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">relaxed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="intersect_hits-642"><a href="#intersect_hits-642"><span class="linenos">642</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Find intersection of hits across multiple Fi-NeMo runs.</span>
</span><span id="intersect_hits-643"><a href="#intersect_hits-643"><span class="linenos">643</span></a>
</span><span id="intersect_hits-644"><a href="#intersect_hits-644"><span class="linenos">644</span></a><span class="sd">    This function identifies motif hits that are consistently called across</span>
</span><span id="intersect_hits-645"><a href="#intersect_hits-645"><span class="linenos">645</span></a><span class="sd">    multiple independent runs, providing a way to assess reproducibility and</span>
</span><span id="intersect_hits-646"><a href="#intersect_hits-646"><span class="linenos">646</span></a><span class="sd">    identify high-confidence hits.</span>
</span><span id="intersect_hits-647"><a href="#intersect_hits-647"><span class="linenos">647</span></a>
</span><span id="intersect_hits-648"><a href="#intersect_hits-648"><span class="linenos">648</span></a><span class="sd">    Parameters</span>
</span><span id="intersect_hits-649"><a href="#intersect_hits-649"><span class="linenos">649</span></a><span class="sd">    ----------</span>
</span><span id="intersect_hits-650"><a href="#intersect_hits-650"><span class="linenos">650</span></a><span class="sd">    hits_paths : List[str]</span>
</span><span id="intersect_hits-651"><a href="#intersect_hits-651"><span class="linenos">651</span></a><span class="sd">        List of paths to input TSV files from different runs.</span>
</span><span id="intersect_hits-652"><a href="#intersect_hits-652"><span class="linenos">652</span></a><span class="sd">    out_path : str</span>
</span><span id="intersect_hits-653"><a href="#intersect_hits-653"><span class="linenos">653</span></a><span class="sd">        Path to output TSV file containing intersection results.</span>
</span><span id="intersect_hits-654"><a href="#intersect_hits-654"><span class="linenos">654</span></a><span class="sd">        Duplicate columns are suffixed with run index.</span>
</span><span id="intersect_hits-655"><a href="#intersect_hits-655"><span class="linenos">655</span></a><span class="sd">    relaxed : bool</span>
</span><span id="intersect_hits-656"><a href="#intersect_hits-656"><span class="linenos">656</span></a><span class="sd">        If True, uses relaxed intersection criteria based only on motif names</span>
</span><span id="intersect_hits-657"><a href="#intersect_hits-657"><span class="linenos">657</span></a><span class="sd">        and untrimmed coordinates. If False, assumes consistent region definitions</span>
</span><span id="intersect_hits-658"><a href="#intersect_hits-658"><span class="linenos">658</span></a><span class="sd">        and motif trimming across runs.</span>
</span><span id="intersect_hits-659"><a href="#intersect_hits-659"><span class="linenos">659</span></a>
</span><span id="intersect_hits-660"><a href="#intersect_hits-660"><span class="linenos">660</span></a><span class="sd">    Notes</span>
</span><span id="intersect_hits-661"><a href="#intersect_hits-661"><span class="linenos">661</span></a><span class="sd">    -----</span>
</span><span id="intersect_hits-662"><a href="#intersect_hits-662"><span class="linenos">662</span></a><span class="sd">    The strict intersection mode requires consistent input regions and motif</span>
</span><span id="intersect_hits-663"><a href="#intersect_hits-663"><span class="linenos">663</span></a><span class="sd">    processing parameters across all runs. The relaxed mode is more permissive</span>
</span><span id="intersect_hits-664"><a href="#intersect_hits-664"><span class="linenos">664</span></a><span class="sd">    but may not be suitable when genomic coordinates are unavailable.</span>
</span><span id="intersect_hits-665"><a href="#intersect_hits-665"><span class="linenos">665</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="intersect_hits-666"><a href="#intersect_hits-666"><span class="linenos">666</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">postprocessing</span>
</span><span id="intersect_hits-667"><a href="#intersect_hits-667"><span class="linenos">667</span></a>
</span><span id="intersect_hits-668"><a href="#intersect_hits-668"><span class="linenos">668</span></a>    <span class="n">hits_dfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_io</span><span class="o">.</span><span class="n">load_hits</span><span class="p">(</span><span class="n">hits_path</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">hits_path</span> <span class="ow">in</span> <span class="n">hits_paths</span><span class="p">]</span>
</span><span id="intersect_hits-669"><a href="#intersect_hits-669"><span class="linenos">669</span></a>    <span class="n">hits_df</span> <span class="o">=</span> <span class="n">postprocessing</span><span class="o">.</span><span class="n">intersect_hits</span><span class="p">(</span><span class="n">hits_dfs</span><span class="p">,</span> <span class="n">relaxed</span><span class="p">)</span>
</span><span id="intersect_hits-670"><a href="#intersect_hits-670"><span class="linenos">670</span></a>
</span><span id="intersect_hits-671"><a href="#intersect_hits-671"><span class="linenos">671</span></a>    <span class="n">data_io</span><span class="o">.</span><span class="n">write_hits_processed</span><span class="p">(</span><span class="n">hits_df</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Find intersection of hits across multiple Fi-NeMo runs.</p>

<p>This function identifies motif hits that are consistently called across
multiple independent runs, providing a way to assess reproducibility and
identify high-confidence hits.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>hits_paths</strong> (List[str]):
List of paths to input TSV files from different runs.</li>
<li><strong>out_path</strong> (str):
Path to output TSV file containing intersection results.
Duplicate columns are suffixed with run index.</li>
<li><strong>relaxed</strong> (bool):
If True, uses relaxed intersection criteria based only on motif names
and untrimmed coordinates. If False, assumes consistent region definitions
and motif trimming across runs.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>The strict intersection mode requires consistent input regions and motif
processing parameters across all runs. The relaxed mode is more permissive
but may not be suitable when genomic coordinates are unavailable.</p>
</div>


                </section>
                <section id="cli">
                            <input id="cli-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cli</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="cli-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#cli"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="cli-674"><a href="#cli-674"><span class="linenos"> 674</span></a><span class="k">def</span><span class="w"> </span><span class="nf">cli</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="cli-675"><a href="#cli-675"><span class="linenos"> 675</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Command-line interface for the Fi-NeMo motif instance calling pipeline.</span>
</span><span id="cli-676"><a href="#cli-676"><span class="linenos"> 676</span></a>
</span><span id="cli-677"><a href="#cli-677"><span class="linenos"> 677</span></a><span class="sd">    This function provides the main entry point for all Fi-NeMo operations including:</span>
</span><span id="cli-678"><a href="#cli-678"><span class="linenos"> 678</span></a><span class="sd">    - Data preprocessing from various formats (bigWig, HDF5, TF-MoDISco)</span>
</span><span id="cli-679"><a href="#cli-679"><span class="linenos"> 679</span></a><span class="sd">    - Motif hit calling using the Fi-NeMo algorithm</span>
</span><span id="cli-680"><a href="#cli-680"><span class="linenos"> 680</span></a><span class="sd">    - Report generation and visualization</span>
</span><span id="cli-681"><a href="#cli-681"><span class="linenos"> 681</span></a><span class="sd">    - Post-processing operations (hit collapsing, intersection)</span>
</span><span id="cli-682"><a href="#cli-682"><span class="linenos"> 682</span></a>
</span><span id="cli-683"><a href="#cli-683"><span class="linenos"> 683</span></a><span class="sd">    The CLI supports comprehensive workflows for transcription factor motif</span>
</span><span id="cli-684"><a href="#cli-684"><span class="linenos"> 684</span></a><span class="sd">    analysis from raw genomic data to publication-ready visualizations.</span>
</span><span id="cli-685"><a href="#cli-685"><span class="linenos"> 685</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="cli-686"><a href="#cli-686"><span class="linenos"> 686</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span id="cli-687"><a href="#cli-687"><span class="linenos"> 687</span></a>    <span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;cmd&quot;</span><span class="p">)</span>
</span><span id="cli-688"><a href="#cli-688"><span class="linenos"> 688</span></a>
</span><span id="cli-689"><a href="#cli-689"><span class="linenos"> 689</span></a>    <span class="n">extract_regions_bw_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="cli-690"><a href="#cli-690"><span class="linenos"> 690</span></a>        <span class="s2">&quot;extract-regions-bw&quot;</span><span class="p">,</span>
</span><span id="cli-691"><a href="#cli-691"><span class="linenos"> 691</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="cli-692"><a href="#cli-692"><span class="linenos"> 692</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Extract sequences and contributions from FASTA and bigwig files.&quot;</span><span class="p">,</span>
</span><span id="cli-693"><a href="#cli-693"><span class="linenos"> 693</span></a>    <span class="p">)</span>
</span><span id="cli-694"><a href="#cli-694"><span class="linenos"> 694</span></a>
</span><span id="cli-695"><a href="#cli-695"><span class="linenos"> 695</span></a>    <span class="n">extract_regions_bw_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-696"><a href="#cli-696"><span class="linenos"> 696</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="cli-697"><a href="#cli-697"><span class="linenos"> 697</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="cli-698"><a href="#cli-698"><span class="linenos"> 698</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-699"><a href="#cli-699"><span class="linenos"> 699</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-700"><a href="#cli-700"><span class="linenos"> 700</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A peak regions file in ENCODE NarrowPeak format.&quot;</span><span class="p">,</span>
</span><span id="cli-701"><a href="#cli-701"><span class="linenos"> 701</span></a>    <span class="p">)</span>
</span><span id="cli-702"><a href="#cli-702"><span class="linenos"> 702</span></a>    <span class="n">extract_regions_bw_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-703"><a href="#cli-703"><span class="linenos"> 703</span></a>        <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
</span><span id="cli-704"><a href="#cli-704"><span class="linenos"> 704</span></a>        <span class="s2">&quot;--chrom-order&quot;</span><span class="p">,</span>
</span><span id="cli-705"><a href="#cli-705"><span class="linenos"> 705</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-706"><a href="#cli-706"><span class="linenos"> 706</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-707"><a href="#cli-707"><span class="linenos"> 707</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with chromosome names in the first column to define sort order of chromosomes. Missing chromosomes are ordered as they appear in -p/--peaks.&quot;</span><span class="p">,</span>
</span><span id="cli-708"><a href="#cli-708"><span class="linenos"> 708</span></a>    <span class="p">)</span>
</span><span id="cli-709"><a href="#cli-709"><span class="linenos"> 709</span></a>    <span class="n">extract_regions_bw_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-710"><a href="#cli-710"><span class="linenos"> 710</span></a>        <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
</span><span id="cli-711"><a href="#cli-711"><span class="linenos"> 711</span></a>        <span class="s2">&quot;--fasta&quot;</span><span class="p">,</span>
</span><span id="cli-712"><a href="#cli-712"><span class="linenos"> 712</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-713"><a href="#cli-713"><span class="linenos"> 713</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-714"><a href="#cli-714"><span class="linenos"> 714</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A genome FASTA file. If an .fai index file doesn&#39;t exist in the same directory, it will be created.&quot;</span><span class="p">,</span>
</span><span id="cli-715"><a href="#cli-715"><span class="linenos"> 715</span></a>    <span class="p">)</span>
</span><span id="cli-716"><a href="#cli-716"><span class="linenos"> 716</span></a>    <span class="n">extract_regions_bw_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-717"><a href="#cli-717"><span class="linenos"> 717</span></a>        <span class="s2">&quot;-b&quot;</span><span class="p">,</span>
</span><span id="cli-718"><a href="#cli-718"><span class="linenos"> 718</span></a>        <span class="s2">&quot;--bigwigs&quot;</span><span class="p">,</span>
</span><span id="cli-719"><a href="#cli-719"><span class="linenos"> 719</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-720"><a href="#cli-720"><span class="linenos"> 720</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-721"><a href="#cli-721"><span class="linenos"> 721</span></a>        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span id="cli-722"><a href="#cli-722"><span class="linenos"> 722</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;One or more bigwig files of contribution scores, with paths delimited by whitespace. Scores are averaged across files.&quot;</span><span class="p">,</span>
</span><span id="cli-723"><a href="#cli-723"><span class="linenos"> 723</span></a>    <span class="p">)</span>
</span><span id="cli-724"><a href="#cli-724"><span class="linenos"> 724</span></a>
</span><span id="cli-725"><a href="#cli-725"><span class="linenos"> 725</span></a>    <span class="n">extract_regions_bw_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-726"><a href="#cli-726"><span class="linenos"> 726</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="cli-727"><a href="#cli-727"><span class="linenos"> 727</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="cli-728"><a href="#cli-728"><span class="linenos"> 728</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-729"><a href="#cli-729"><span class="linenos"> 729</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-730"><a href="#cli-730"><span class="linenos"> 730</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output .npz file.&quot;</span><span class="p">,</span>
</span><span id="cli-731"><a href="#cli-731"><span class="linenos"> 731</span></a>    <span class="p">)</span>
</span><span id="cli-732"><a href="#cli-732"><span class="linenos"> 732</span></a>
</span><span id="cli-733"><a href="#cli-733"><span class="linenos"> 733</span></a>    <span class="n">extract_regions_bw_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-734"><a href="#cli-734"><span class="linenos"> 734</span></a>        <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
</span><span id="cli-735"><a href="#cli-735"><span class="linenos"> 735</span></a>        <span class="s2">&quot;--region-width&quot;</span><span class="p">,</span>
</span><span id="cli-736"><a href="#cli-736"><span class="linenos"> 736</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="cli-737"><a href="#cli-737"><span class="linenos"> 737</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="cli-738"><a href="#cli-738"><span class="linenos"> 738</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The width of the input region centered around each peak summit.&quot;</span><span class="p">,</span>
</span><span id="cli-739"><a href="#cli-739"><span class="linenos"> 739</span></a>    <span class="p">)</span>
</span><span id="cli-740"><a href="#cli-740"><span class="linenos"> 740</span></a>
</span><span id="cli-741"><a href="#cli-741"><span class="linenos"> 741</span></a>    <span class="n">extract_chrombpnet_regions_h5_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="cli-742"><a href="#cli-742"><span class="linenos"> 742</span></a>        <span class="s2">&quot;extract-regions-chrombpnet-h5&quot;</span><span class="p">,</span>
</span><span id="cli-743"><a href="#cli-743"><span class="linenos"> 743</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="cli-744"><a href="#cli-744"><span class="linenos"> 744</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Extract sequences and contributions from ChromBPNet contributions H5 files.&quot;</span><span class="p">,</span>
</span><span id="cli-745"><a href="#cli-745"><span class="linenos"> 745</span></a>    <span class="p">)</span>
</span><span id="cli-746"><a href="#cli-746"><span class="linenos"> 746</span></a>
</span><span id="cli-747"><a href="#cli-747"><span class="linenos"> 747</span></a>    <span class="n">extract_chrombpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-748"><a href="#cli-748"><span class="linenos"> 748</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="cli-749"><a href="#cli-749"><span class="linenos"> 749</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="cli-750"><a href="#cli-750"><span class="linenos"> 750</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-751"><a href="#cli-751"><span class="linenos"> 751</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-752"><a href="#cli-752"><span class="linenos"> 752</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A peak regions file in ENCODE NarrowPeak format. If omitted, downstream outputs will lack absolute genomic coordinates.&quot;</span><span class="p">,</span>
</span><span id="cli-753"><a href="#cli-753"><span class="linenos"> 753</span></a>    <span class="p">)</span>
</span><span id="cli-754"><a href="#cli-754"><span class="linenos"> 754</span></a>    <span class="n">extract_chrombpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-755"><a href="#cli-755"><span class="linenos"> 755</span></a>        <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
</span><span id="cli-756"><a href="#cli-756"><span class="linenos"> 756</span></a>        <span class="s2">&quot;--chrom-order&quot;</span><span class="p">,</span>
</span><span id="cli-757"><a href="#cli-757"><span class="linenos"> 757</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-758"><a href="#cli-758"><span class="linenos"> 758</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-759"><a href="#cli-759"><span class="linenos"> 759</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with chromosome names in the first column to define sort order of chromosomes. Missing chromosomes are ordered as they appear in -p/--peaks.&quot;</span><span class="p">,</span>
</span><span id="cli-760"><a href="#cli-760"><span class="linenos"> 760</span></a>    <span class="p">)</span>
</span><span id="cli-761"><a href="#cli-761"><span class="linenos"> 761</span></a>
</span><span id="cli-762"><a href="#cli-762"><span class="linenos"> 762</span></a>    <span class="n">extract_chrombpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-763"><a href="#cli-763"><span class="linenos"> 763</span></a>        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="cli-764"><a href="#cli-764"><span class="linenos"> 764</span></a>        <span class="s2">&quot;--h5s&quot;</span><span class="p">,</span>
</span><span id="cli-765"><a href="#cli-765"><span class="linenos"> 765</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-766"><a href="#cli-766"><span class="linenos"> 766</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-767"><a href="#cli-767"><span class="linenos"> 767</span></a>        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span id="cli-768"><a href="#cli-768"><span class="linenos"> 768</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;One or more H5 files of contribution scores, with paths delimited by whitespace. Scores are averaged across files.&quot;</span><span class="p">,</span>
</span><span id="cli-769"><a href="#cli-769"><span class="linenos"> 769</span></a>    <span class="p">)</span>
</span><span id="cli-770"><a href="#cli-770"><span class="linenos"> 770</span></a>
</span><span id="cli-771"><a href="#cli-771"><span class="linenos"> 771</span></a>    <span class="n">extract_chrombpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-772"><a href="#cli-772"><span class="linenos"> 772</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="cli-773"><a href="#cli-773"><span class="linenos"> 773</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="cli-774"><a href="#cli-774"><span class="linenos"> 774</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-775"><a href="#cli-775"><span class="linenos"> 775</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-776"><a href="#cli-776"><span class="linenos"> 776</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output .npz file.&quot;</span><span class="p">,</span>
</span><span id="cli-777"><a href="#cli-777"><span class="linenos"> 777</span></a>    <span class="p">)</span>
</span><span id="cli-778"><a href="#cli-778"><span class="linenos"> 778</span></a>
</span><span id="cli-779"><a href="#cli-779"><span class="linenos"> 779</span></a>    <span class="n">extract_chrombpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-780"><a href="#cli-780"><span class="linenos"> 780</span></a>        <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
</span><span id="cli-781"><a href="#cli-781"><span class="linenos"> 781</span></a>        <span class="s2">&quot;--region-width&quot;</span><span class="p">,</span>
</span><span id="cli-782"><a href="#cli-782"><span class="linenos"> 782</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="cli-783"><a href="#cli-783"><span class="linenos"> 783</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="cli-784"><a href="#cli-784"><span class="linenos"> 784</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The width of the input region centered around each peak summit.&quot;</span><span class="p">,</span>
</span><span id="cli-785"><a href="#cli-785"><span class="linenos"> 785</span></a>    <span class="p">)</span>
</span><span id="cli-786"><a href="#cli-786"><span class="linenos"> 786</span></a>
</span><span id="cli-787"><a href="#cli-787"><span class="linenos"> 787</span></a>    <span class="n">extract_regions_h5_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="cli-788"><a href="#cli-788"><span class="linenos"> 788</span></a>        <span class="s2">&quot;extract-regions-h5&quot;</span><span class="p">,</span>
</span><span id="cli-789"><a href="#cli-789"><span class="linenos"> 789</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="cli-790"><a href="#cli-790"><span class="linenos"> 790</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Extract sequences and contributions from ChromBPNet contributions H5 files. DEPRECATED: Use `extract-regions-chrombpnet-h5` instead.&quot;</span><span class="p">,</span>
</span><span id="cli-791"><a href="#cli-791"><span class="linenos"> 791</span></a>    <span class="p">)</span>
</span><span id="cli-792"><a href="#cli-792"><span class="linenos"> 792</span></a>
</span><span id="cli-793"><a href="#cli-793"><span class="linenos"> 793</span></a>    <span class="n">extract_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-794"><a href="#cli-794"><span class="linenos"> 794</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="cli-795"><a href="#cli-795"><span class="linenos"> 795</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="cli-796"><a href="#cli-796"><span class="linenos"> 796</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-797"><a href="#cli-797"><span class="linenos"> 797</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-798"><a href="#cli-798"><span class="linenos"> 798</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A peak regions file in ENCODE NarrowPeak format. If omitted, downstream outputs will lack absolute genomic coordinates.&quot;</span><span class="p">,</span>
</span><span id="cli-799"><a href="#cli-799"><span class="linenos"> 799</span></a>    <span class="p">)</span>
</span><span id="cli-800"><a href="#cli-800"><span class="linenos"> 800</span></a>    <span class="n">extract_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-801"><a href="#cli-801"><span class="linenos"> 801</span></a>        <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
</span><span id="cli-802"><a href="#cli-802"><span class="linenos"> 802</span></a>        <span class="s2">&quot;--chrom-order&quot;</span><span class="p">,</span>
</span><span id="cli-803"><a href="#cli-803"><span class="linenos"> 803</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-804"><a href="#cli-804"><span class="linenos"> 804</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-805"><a href="#cli-805"><span class="linenos"> 805</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with chromosome names in the first column to define sort order of chromosomes. Missing chromosomes are ordered as they appear in -p/--peaks.&quot;</span><span class="p">,</span>
</span><span id="cli-806"><a href="#cli-806"><span class="linenos"> 806</span></a>    <span class="p">)</span>
</span><span id="cli-807"><a href="#cli-807"><span class="linenos"> 807</span></a>
</span><span id="cli-808"><a href="#cli-808"><span class="linenos"> 808</span></a>    <span class="n">extract_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-809"><a href="#cli-809"><span class="linenos"> 809</span></a>        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="cli-810"><a href="#cli-810"><span class="linenos"> 810</span></a>        <span class="s2">&quot;--h5s&quot;</span><span class="p">,</span>
</span><span id="cli-811"><a href="#cli-811"><span class="linenos"> 811</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-812"><a href="#cli-812"><span class="linenos"> 812</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-813"><a href="#cli-813"><span class="linenos"> 813</span></a>        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span id="cli-814"><a href="#cli-814"><span class="linenos"> 814</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;One or more H5 files of contribution scores, with paths delimited by whitespace. Scores are averaged across files.&quot;</span><span class="p">,</span>
</span><span id="cli-815"><a href="#cli-815"><span class="linenos"> 815</span></a>    <span class="p">)</span>
</span><span id="cli-816"><a href="#cli-816"><span class="linenos"> 816</span></a>
</span><span id="cli-817"><a href="#cli-817"><span class="linenos"> 817</span></a>    <span class="n">extract_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-818"><a href="#cli-818"><span class="linenos"> 818</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="cli-819"><a href="#cli-819"><span class="linenos"> 819</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="cli-820"><a href="#cli-820"><span class="linenos"> 820</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-821"><a href="#cli-821"><span class="linenos"> 821</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-822"><a href="#cli-822"><span class="linenos"> 822</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output .npz file.&quot;</span><span class="p">,</span>
</span><span id="cli-823"><a href="#cli-823"><span class="linenos"> 823</span></a>    <span class="p">)</span>
</span><span id="cli-824"><a href="#cli-824"><span class="linenos"> 824</span></a>
</span><span id="cli-825"><a href="#cli-825"><span class="linenos"> 825</span></a>    <span class="n">extract_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-826"><a href="#cli-826"><span class="linenos"> 826</span></a>        <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
</span><span id="cli-827"><a href="#cli-827"><span class="linenos"> 827</span></a>        <span class="s2">&quot;--region-width&quot;</span><span class="p">,</span>
</span><span id="cli-828"><a href="#cli-828"><span class="linenos"> 828</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="cli-829"><a href="#cli-829"><span class="linenos"> 829</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="cli-830"><a href="#cli-830"><span class="linenos"> 830</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The width of the input region centered around each peak summit.&quot;</span><span class="p">,</span>
</span><span id="cli-831"><a href="#cli-831"><span class="linenos"> 831</span></a>    <span class="p">)</span>
</span><span id="cli-832"><a href="#cli-832"><span class="linenos"> 832</span></a>
</span><span id="cli-833"><a href="#cli-833"><span class="linenos"> 833</span></a>    <span class="n">extract_bpnet_regions_h5_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="cli-834"><a href="#cli-834"><span class="linenos"> 834</span></a>        <span class="s2">&quot;extract-regions-bpnet-h5&quot;</span><span class="p">,</span>
</span><span id="cli-835"><a href="#cli-835"><span class="linenos"> 835</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="cli-836"><a href="#cli-836"><span class="linenos"> 836</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Extract sequences and contributions from BPNet contributions H5 files.&quot;</span><span class="p">,</span>
</span><span id="cli-837"><a href="#cli-837"><span class="linenos"> 837</span></a>    <span class="p">)</span>
</span><span id="cli-838"><a href="#cli-838"><span class="linenos"> 838</span></a>
</span><span id="cli-839"><a href="#cli-839"><span class="linenos"> 839</span></a>    <span class="n">extract_bpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-840"><a href="#cli-840"><span class="linenos"> 840</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="cli-841"><a href="#cli-841"><span class="linenos"> 841</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="cli-842"><a href="#cli-842"><span class="linenos"> 842</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-843"><a href="#cli-843"><span class="linenos"> 843</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-844"><a href="#cli-844"><span class="linenos"> 844</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A peak regions file in ENCODE NarrowPeak format. If omitted, downstream outputs will lack absolute genomic coordinates.&quot;</span><span class="p">,</span>
</span><span id="cli-845"><a href="#cli-845"><span class="linenos"> 845</span></a>    <span class="p">)</span>
</span><span id="cli-846"><a href="#cli-846"><span class="linenos"> 846</span></a>    <span class="n">extract_bpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-847"><a href="#cli-847"><span class="linenos"> 847</span></a>        <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
</span><span id="cli-848"><a href="#cli-848"><span class="linenos"> 848</span></a>        <span class="s2">&quot;--chrom-order&quot;</span><span class="p">,</span>
</span><span id="cli-849"><a href="#cli-849"><span class="linenos"> 849</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-850"><a href="#cli-850"><span class="linenos"> 850</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-851"><a href="#cli-851"><span class="linenos"> 851</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with chromosome names in the first column to define sort order of chromosomes. Missing chromosomes are ordered as they appear in -p/--peaks.&quot;</span><span class="p">,</span>
</span><span id="cli-852"><a href="#cli-852"><span class="linenos"> 852</span></a>    <span class="p">)</span>
</span><span id="cli-853"><a href="#cli-853"><span class="linenos"> 853</span></a>
</span><span id="cli-854"><a href="#cli-854"><span class="linenos"> 854</span></a>    <span class="n">extract_bpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-855"><a href="#cli-855"><span class="linenos"> 855</span></a>        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="cli-856"><a href="#cli-856"><span class="linenos"> 856</span></a>        <span class="s2">&quot;--h5s&quot;</span><span class="p">,</span>
</span><span id="cli-857"><a href="#cli-857"><span class="linenos"> 857</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-858"><a href="#cli-858"><span class="linenos"> 858</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-859"><a href="#cli-859"><span class="linenos"> 859</span></a>        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span id="cli-860"><a href="#cli-860"><span class="linenos"> 860</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;One or more H5 files of contribution scores, with paths delimited by whitespace. Scores are averaged across files.&quot;</span><span class="p">,</span>
</span><span id="cli-861"><a href="#cli-861"><span class="linenos"> 861</span></a>    <span class="p">)</span>
</span><span id="cli-862"><a href="#cli-862"><span class="linenos"> 862</span></a>
</span><span id="cli-863"><a href="#cli-863"><span class="linenos"> 863</span></a>    <span class="n">extract_bpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-864"><a href="#cli-864"><span class="linenos"> 864</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="cli-865"><a href="#cli-865"><span class="linenos"> 865</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="cli-866"><a href="#cli-866"><span class="linenos"> 866</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-867"><a href="#cli-867"><span class="linenos"> 867</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-868"><a href="#cli-868"><span class="linenos"> 868</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output .npz file.&quot;</span><span class="p">,</span>
</span><span id="cli-869"><a href="#cli-869"><span class="linenos"> 869</span></a>    <span class="p">)</span>
</span><span id="cli-870"><a href="#cli-870"><span class="linenos"> 870</span></a>
</span><span id="cli-871"><a href="#cli-871"><span class="linenos"> 871</span></a>    <span class="n">extract_bpnet_regions_h5_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-872"><a href="#cli-872"><span class="linenos"> 872</span></a>        <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
</span><span id="cli-873"><a href="#cli-873"><span class="linenos"> 873</span></a>        <span class="s2">&quot;--region-width&quot;</span><span class="p">,</span>
</span><span id="cli-874"><a href="#cli-874"><span class="linenos"> 874</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="cli-875"><a href="#cli-875"><span class="linenos"> 875</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="cli-876"><a href="#cli-876"><span class="linenos"> 876</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The width of the input region centered around each peak summit.&quot;</span><span class="p">,</span>
</span><span id="cli-877"><a href="#cli-877"><span class="linenos"> 877</span></a>    <span class="p">)</span>
</span><span id="cli-878"><a href="#cli-878"><span class="linenos"> 878</span></a>
</span><span id="cli-879"><a href="#cli-879"><span class="linenos"> 879</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="cli-880"><a href="#cli-880"><span class="linenos"> 880</span></a>        <span class="s2">&quot;extract-regions-modisco-fmt&quot;</span><span class="p">,</span>
</span><span id="cli-881"><a href="#cli-881"><span class="linenos"> 881</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="cli-882"><a href="#cli-882"><span class="linenos"> 882</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Extract sequences and contributions from tfmodisco-lite input files.&quot;</span><span class="p">,</span>
</span><span id="cli-883"><a href="#cli-883"><span class="linenos"> 883</span></a>    <span class="p">)</span>
</span><span id="cli-884"><a href="#cli-884"><span class="linenos"> 884</span></a>
</span><span id="cli-885"><a href="#cli-885"><span class="linenos"> 885</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-886"><a href="#cli-886"><span class="linenos"> 886</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="cli-887"><a href="#cli-887"><span class="linenos"> 887</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="cli-888"><a href="#cli-888"><span class="linenos"> 888</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-889"><a href="#cli-889"><span class="linenos"> 889</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-890"><a href="#cli-890"><span class="linenos"> 890</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A peak regions file in ENCODE NarrowPeak format. If omitted, downstream outputs will lack absolute genomic coordinates.&quot;</span><span class="p">,</span>
</span><span id="cli-891"><a href="#cli-891"><span class="linenos"> 891</span></a>    <span class="p">)</span>
</span><span id="cli-892"><a href="#cli-892"><span class="linenos"> 892</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-893"><a href="#cli-893"><span class="linenos"> 893</span></a>        <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
</span><span id="cli-894"><a href="#cli-894"><span class="linenos"> 894</span></a>        <span class="s2">&quot;--chrom-order&quot;</span><span class="p">,</span>
</span><span id="cli-895"><a href="#cli-895"><span class="linenos"> 895</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-896"><a href="#cli-896"><span class="linenos"> 896</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-897"><a href="#cli-897"><span class="linenos"> 897</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with chromosome names in the first column to define sort order of chromosomes. Missing chromosomes are ordered as they appear in -p/--peaks.&quot;</span><span class="p">,</span>
</span><span id="cli-898"><a href="#cli-898"><span class="linenos"> 898</span></a>    <span class="p">)</span>
</span><span id="cli-899"><a href="#cli-899"><span class="linenos"> 899</span></a>
</span><span id="cli-900"><a href="#cli-900"><span class="linenos"> 900</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-901"><a href="#cli-901"><span class="linenos"> 901</span></a>        <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
</span><span id="cli-902"><a href="#cli-902"><span class="linenos"> 902</span></a>        <span class="s2">&quot;--sequences&quot;</span><span class="p">,</span>
</span><span id="cli-903"><a href="#cli-903"><span class="linenos"> 903</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-904"><a href="#cli-904"><span class="linenos"> 904</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-905"><a href="#cli-905"><span class="linenos"> 905</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A .npy or .npz file containing one-hot encoded sequences.&quot;</span><span class="p">,</span>
</span><span id="cli-906"><a href="#cli-906"><span class="linenos"> 906</span></a>    <span class="p">)</span>
</span><span id="cli-907"><a href="#cli-907"><span class="linenos"> 907</span></a>
</span><span id="cli-908"><a href="#cli-908"><span class="linenos"> 908</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-909"><a href="#cli-909"><span class="linenos"> 909</span></a>        <span class="s2">&quot;-a&quot;</span><span class="p">,</span>
</span><span id="cli-910"><a href="#cli-910"><span class="linenos"> 910</span></a>        <span class="s2">&quot;--attributions&quot;</span><span class="p">,</span>
</span><span id="cli-911"><a href="#cli-911"><span class="linenos"> 911</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-912"><a href="#cli-912"><span class="linenos"> 912</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-913"><a href="#cli-913"><span class="linenos"> 913</span></a>        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span id="cli-914"><a href="#cli-914"><span class="linenos"> 914</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;One or more .npy or .npz files of hypothetical contribution scores, with paths delimited by whitespace. Scores are averaged across files.&quot;</span><span class="p">,</span>
</span><span id="cli-915"><a href="#cli-915"><span class="linenos"> 915</span></a>    <span class="p">)</span>
</span><span id="cli-916"><a href="#cli-916"><span class="linenos"> 916</span></a>
</span><span id="cli-917"><a href="#cli-917"><span class="linenos"> 917</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-918"><a href="#cli-918"><span class="linenos"> 918</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="cli-919"><a href="#cli-919"><span class="linenos"> 919</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="cli-920"><a href="#cli-920"><span class="linenos"> 920</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-921"><a href="#cli-921"><span class="linenos"> 921</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-922"><a href="#cli-922"><span class="linenos"> 922</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output .npz file.&quot;</span><span class="p">,</span>
</span><span id="cli-923"><a href="#cli-923"><span class="linenos"> 923</span></a>    <span class="p">)</span>
</span><span id="cli-924"><a href="#cli-924"><span class="linenos"> 924</span></a>
</span><span id="cli-925"><a href="#cli-925"><span class="linenos"> 925</span></a>    <span class="n">extract_regions_modisco_fmt_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-926"><a href="#cli-926"><span class="linenos"> 926</span></a>        <span class="s2">&quot;-w&quot;</span><span class="p">,</span>
</span><span id="cli-927"><a href="#cli-927"><span class="linenos"> 927</span></a>        <span class="s2">&quot;--region-width&quot;</span><span class="p">,</span>
</span><span id="cli-928"><a href="#cli-928"><span class="linenos"> 928</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="cli-929"><a href="#cli-929"><span class="linenos"> 929</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span id="cli-930"><a href="#cli-930"><span class="linenos"> 930</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The width of the input region centered around each peak summit.&quot;</span><span class="p">,</span>
</span><span id="cli-931"><a href="#cli-931"><span class="linenos"> 931</span></a>    <span class="p">)</span>
</span><span id="cli-932"><a href="#cli-932"><span class="linenos"> 932</span></a>
</span><span id="cli-933"><a href="#cli-933"><span class="linenos"> 933</span></a>    <span class="n">call_hits_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="cli-934"><a href="#cli-934"><span class="linenos"> 934</span></a>        <span class="s2">&quot;call-hits&quot;</span><span class="p">,</span>
</span><span id="cli-935"><a href="#cli-935"><span class="linenos"> 935</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="cli-936"><a href="#cli-936"><span class="linenos"> 936</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Call hits on provided sequences, contributions, and motif CWM&#39;s.&quot;</span><span class="p">,</span>
</span><span id="cli-937"><a href="#cli-937"><span class="linenos"> 937</span></a>    <span class="p">)</span>
</span><span id="cli-938"><a href="#cli-938"><span class="linenos"> 938</span></a>
</span><span id="cli-939"><a href="#cli-939"><span class="linenos"> 939</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-940"><a href="#cli-940"><span class="linenos"> 940</span></a>        <span class="s2">&quot;-M&quot;</span><span class="p">,</span>
</span><span id="cli-941"><a href="#cli-941"><span class="linenos"> 941</span></a>        <span class="s2">&quot;--mode&quot;</span><span class="p">,</span>
</span><span id="cli-942"><a href="#cli-942"><span class="linenos"> 942</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-943"><a href="#cli-943"><span class="linenos"> 943</span></a>        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;pp&quot;</span><span class="p">,</span>
</span><span id="cli-944"><a href="#cli-944"><span class="linenos"> 944</span></a>        <span class="n">choices</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;pp&quot;</span><span class="p">,</span> <span class="s2">&quot;ph&quot;</span><span class="p">,</span> <span class="s2">&quot;hp&quot;</span><span class="p">,</span> <span class="s2">&quot;hh&quot;</span><span class="p">},</span>
</span><span id="cli-945"><a href="#cli-945"><span class="linenos"> 945</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The type of attributions to use for CWM&#39;s and input contribution scores, respectively. &#39;h&#39; for hypothetical and &#39;p&#39; for projected.&quot;</span><span class="p">,</span>
</span><span id="cli-946"><a href="#cli-946"><span class="linenos"> 946</span></a>    <span class="p">)</span>
</span><span id="cli-947"><a href="#cli-947"><span class="linenos"> 947</span></a>
</span><span id="cli-948"><a href="#cli-948"><span class="linenos"> 948</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-949"><a href="#cli-949"><span class="linenos"> 949</span></a>        <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
</span><span id="cli-950"><a href="#cli-950"><span class="linenos"> 950</span></a>        <span class="s2">&quot;--regions&quot;</span><span class="p">,</span>
</span><span id="cli-951"><a href="#cli-951"><span class="linenos"> 951</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-952"><a href="#cli-952"><span class="linenos"> 952</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-953"><a href="#cli-953"><span class="linenos"> 953</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A .npz file of input sequences, contributions, and coordinates. Can be generated using `finemo extract-regions-*` subcommands.&quot;</span><span class="p">,</span>
</span><span id="cli-954"><a href="#cli-954"><span class="linenos"> 954</span></a>    <span class="p">)</span>
</span><span id="cli-955"><a href="#cli-955"><span class="linenos"> 955</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-956"><a href="#cli-956"><span class="linenos"> 956</span></a>        <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
</span><span id="cli-957"><a href="#cli-957"><span class="linenos"> 957</span></a>        <span class="s2">&quot;--modisco-h5&quot;</span><span class="p">,</span>
</span><span id="cli-958"><a href="#cli-958"><span class="linenos"> 958</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-959"><a href="#cli-959"><span class="linenos"> 959</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-960"><a href="#cli-960"><span class="linenos"> 960</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tfmodisco-lite output H5 file of motif patterns.&quot;</span><span class="p">,</span>
</span><span id="cli-961"><a href="#cli-961"><span class="linenos"> 961</span></a>    <span class="p">)</span>
</span><span id="cli-962"><a href="#cli-962"><span class="linenos"> 962</span></a>
</span><span id="cli-963"><a href="#cli-963"><span class="linenos"> 963</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-964"><a href="#cli-964"><span class="linenos"> 964</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="cli-965"><a href="#cli-965"><span class="linenos"> 965</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="cli-966"><a href="#cli-966"><span class="linenos"> 966</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-967"><a href="#cli-967"><span class="linenos"> 967</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-968"><a href="#cli-968"><span class="linenos"> 968</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please provide this file to a preprocessing `finemo extract-regions-*` subcommand instead.&quot;</span><span class="p">,</span>
</span><span id="cli-969"><a href="#cli-969"><span class="linenos"> 969</span></a>    <span class="p">)</span>
</span><span id="cli-970"><a href="#cli-970"><span class="linenos"> 970</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-971"><a href="#cli-971"><span class="linenos"> 971</span></a>        <span class="s2">&quot;-C&quot;</span><span class="p">,</span>
</span><span id="cli-972"><a href="#cli-972"><span class="linenos"> 972</span></a>        <span class="s2">&quot;--chrom-order&quot;</span><span class="p">,</span>
</span><span id="cli-973"><a href="#cli-973"><span class="linenos"> 973</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-974"><a href="#cli-974"><span class="linenos"> 974</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-975"><a href="#cli-975"><span class="linenos"> 975</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please provide this file to a preprocessing `finemo extract-regions-*` subcommand instead.&quot;</span><span class="p">,</span>
</span><span id="cli-976"><a href="#cli-976"><span class="linenos"> 976</span></a>    <span class="p">)</span>
</span><span id="cli-977"><a href="#cli-977"><span class="linenos"> 977</span></a>
</span><span id="cli-978"><a href="#cli-978"><span class="linenos"> 978</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-979"><a href="#cli-979"><span class="linenos"> 979</span></a>        <span class="s2">&quot;-I&quot;</span><span class="p">,</span>
</span><span id="cli-980"><a href="#cli-980"><span class="linenos"> 980</span></a>        <span class="s2">&quot;--motifs-include&quot;</span><span class="p">,</span>
</span><span id="cli-981"><a href="#cli-981"><span class="linenos"> 981</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-982"><a href="#cli-982"><span class="linenos"> 982</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-983"><a href="#cli-983"><span class="linenos"> 983</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with tfmodisco motif names (e.g pos_patterns.pattern_0) in the first column to include in hit calling. If omitted, all motifs in the modisco H5 file are used.&quot;</span><span class="p">,</span>
</span><span id="cli-984"><a href="#cli-984"><span class="linenos"> 984</span></a>    <span class="p">)</span>
</span><span id="cli-985"><a href="#cli-985"><span class="linenos"> 985</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-986"><a href="#cli-986"><span class="linenos"> 986</span></a>        <span class="s2">&quot;-N&quot;</span><span class="p">,</span>
</span><span id="cli-987"><a href="#cli-987"><span class="linenos"> 987</span></a>        <span class="s2">&quot;--motif-names&quot;</span><span class="p">,</span>
</span><span id="cli-988"><a href="#cli-988"><span class="linenos"> 988</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-989"><a href="#cli-989"><span class="linenos"> 989</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-990"><a href="#cli-990"><span class="linenos"> 990</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with tfmodisco motif names (e.g pos_patterns.pattern_0) in the first column and custom names in the second column. Omitted motifs default to tfmodisco names.&quot;</span><span class="p">,</span>
</span><span id="cli-991"><a href="#cli-991"><span class="linenos"> 991</span></a>    <span class="p">)</span>
</span><span id="cli-992"><a href="#cli-992"><span class="linenos"> 992</span></a>
</span><span id="cli-993"><a href="#cli-993"><span class="linenos"> 993</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-994"><a href="#cli-994"><span class="linenos"> 994</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="cli-995"><a href="#cli-995"><span class="linenos"> 995</span></a>        <span class="s2">&quot;--out-dir&quot;</span><span class="p">,</span>
</span><span id="cli-996"><a href="#cli-996"><span class="linenos"> 996</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-997"><a href="#cli-997"><span class="linenos"> 997</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-998"><a href="#cli-998"><span class="linenos"> 998</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output directory.&quot;</span><span class="p">,</span>
</span><span id="cli-999"><a href="#cli-999"><span class="linenos"> 999</span></a>    <span class="p">)</span>
</span><span id="cli-1000"><a href="#cli-1000"><span class="linenos">1000</span></a>
</span><span id="cli-1001"><a href="#cli-1001"><span class="linenos">1001</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1002"><a href="#cli-1002"><span class="linenos">1002</span></a>        <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
</span><span id="cli-1003"><a href="#cli-1003"><span class="linenos">1003</span></a>        <span class="s2">&quot;--cwm-trim-threshold&quot;</span><span class="p">,</span>
</span><span id="cli-1004"><a href="#cli-1004"><span class="linenos">1004</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="cli-1005"><a href="#cli-1005"><span class="linenos">1005</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="cli-1006"><a href="#cli-1006"><span class="linenos">1006</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The default threshold to determine motif start and end positions within the full CWMs.&quot;</span><span class="p">,</span>
</span><span id="cli-1007"><a href="#cli-1007"><span class="linenos">1007</span></a>    <span class="p">)</span>
</span><span id="cli-1008"><a href="#cli-1008"><span class="linenos">1008</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1009"><a href="#cli-1009"><span class="linenos">1009</span></a>        <span class="s2">&quot;-T&quot;</span><span class="p">,</span>
</span><span id="cli-1010"><a href="#cli-1010"><span class="linenos">1010</span></a>        <span class="s2">&quot;--cwm-trim-thresholds&quot;</span><span class="p">,</span>
</span><span id="cli-1011"><a href="#cli-1011"><span class="linenos">1011</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1012"><a href="#cli-1012"><span class="linenos">1012</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-1013"><a href="#cli-1013"><span class="linenos">1013</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with tfmodisco motif names (e.g pos_patterns.pattern_0) in the first column and custom trim thresholds in the second column. Omitted motifs default to the `--cwm-trim-threshold` value.&quot;</span><span class="p">,</span>
</span><span id="cli-1014"><a href="#cli-1014"><span class="linenos">1014</span></a>    <span class="p">)</span>
</span><span id="cli-1015"><a href="#cli-1015"><span class="linenos">1015</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1016"><a href="#cli-1016"><span class="linenos">1016</span></a>        <span class="s2">&quot;-R&quot;</span><span class="p">,</span>
</span><span id="cli-1017"><a href="#cli-1017"><span class="linenos">1017</span></a>        <span class="s2">&quot;--cwm-trim-coords&quot;</span><span class="p">,</span>
</span><span id="cli-1018"><a href="#cli-1018"><span class="linenos">1018</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1019"><a href="#cli-1019"><span class="linenos">1019</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-1020"><a href="#cli-1020"><span class="linenos">1020</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with tfmodisco motif names (e.g pos_patterns.pattern_0) in the first column and custom trim start and end coordinates in the second and third columns, respectively. Omitted motifs default to `--cwm-trim-thresholds` values.&quot;</span><span class="p">,</span>
</span><span id="cli-1021"><a href="#cli-1021"><span class="linenos">1021</span></a>    <span class="p">)</span>
</span><span id="cli-1022"><a href="#cli-1022"><span class="linenos">1022</span></a>
</span><span id="cli-1023"><a href="#cli-1023"><span class="linenos">1023</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1024"><a href="#cli-1024"><span class="linenos">1024</span></a>        <span class="s2">&quot;-l&quot;</span><span class="p">,</span>
</span><span id="cli-1025"><a href="#cli-1025"><span class="linenos">1025</span></a>        <span class="s2">&quot;--global-lambda&quot;</span><span class="p">,</span>
</span><span id="cli-1026"><a href="#cli-1026"><span class="linenos">1026</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="cli-1027"><a href="#cli-1027"><span class="linenos">1027</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
</span><span id="cli-1028"><a href="#cli-1028"><span class="linenos">1028</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The default L1 regularization weight determining the sparsity of hits.&quot;</span><span class="p">,</span>
</span><span id="cli-1029"><a href="#cli-1029"><span class="linenos">1029</span></a>    <span class="p">)</span>
</span><span id="cli-1030"><a href="#cli-1030"><span class="linenos">1030</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1031"><a href="#cli-1031"><span class="linenos">1031</span></a>        <span class="s2">&quot;-L&quot;</span><span class="p">,</span>
</span><span id="cli-1032"><a href="#cli-1032"><span class="linenos">1032</span></a>        <span class="s2">&quot;--motif-lambdas&quot;</span><span class="p">,</span>
</span><span id="cli-1033"><a href="#cli-1033"><span class="linenos">1033</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1034"><a href="#cli-1034"><span class="linenos">1034</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-1035"><a href="#cli-1035"><span class="linenos">1035</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A tab-delimited file with tfmodisco motif names (e.g pos_patterns.pattern_0) in the first column and motif-specific lambdas in the second column. Omitted motifs default to the `--global-lambda` value.&quot;</span><span class="p">,</span>
</span><span id="cli-1036"><a href="#cli-1036"><span class="linenos">1036</span></a>    <span class="p">)</span>
</span><span id="cli-1037"><a href="#cli-1037"><span class="linenos">1037</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1038"><a href="#cli-1038"><span class="linenos">1038</span></a>        <span class="s2">&quot;-a&quot;</span><span class="p">,</span>
</span><span id="cli-1039"><a href="#cli-1039"><span class="linenos">1039</span></a>        <span class="s2">&quot;--alpha&quot;</span><span class="p">,</span>
</span><span id="cli-1040"><a href="#cli-1040"><span class="linenos">1040</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="cli-1041"><a href="#cli-1041"><span class="linenos">1041</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-1042"><a href="#cli-1042"><span class="linenos">1042</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please use the `--lambda` argument instead.&quot;</span><span class="p">,</span>
</span><span id="cli-1043"><a href="#cli-1043"><span class="linenos">1043</span></a>    <span class="p">)</span>
</span><span id="cli-1044"><a href="#cli-1044"><span class="linenos">1044</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1045"><a href="#cli-1045"><span class="linenos">1045</span></a>        <span class="s2">&quot;-A&quot;</span><span class="p">,</span>
</span><span id="cli-1046"><a href="#cli-1046"><span class="linenos">1046</span></a>        <span class="s2">&quot;--motif-alphas&quot;</span><span class="p">,</span>
</span><span id="cli-1047"><a href="#cli-1047"><span class="linenos">1047</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1048"><a href="#cli-1048"><span class="linenos">1048</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-1049"><a href="#cli-1049"><span class="linenos">1049</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please use the `--motif-lambdas` argument instead.&quot;</span><span class="p">,</span>
</span><span id="cli-1050"><a href="#cli-1050"><span class="linenos">1050</span></a>    <span class="p">)</span>
</span><span id="cli-1051"><a href="#cli-1051"><span class="linenos">1051</span></a>
</span><span id="cli-1052"><a href="#cli-1052"><span class="linenos">1052</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1053"><a href="#cli-1053"><span class="linenos">1053</span></a>        <span class="s2">&quot;-f&quot;</span><span class="p">,</span>
</span><span id="cli-1054"><a href="#cli-1054"><span class="linenos">1054</span></a>        <span class="s2">&quot;--no-post-filter&quot;</span><span class="p">,</span>
</span><span id="cli-1055"><a href="#cli-1055"><span class="linenos">1055</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="cli-1056"><a href="#cli-1056"><span class="linenos">1056</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not perform post-hit-calling filtering. By default, hits are filtered based on a minimum cosine similarity of `lambda` with the input contributions.&quot;</span><span class="p">,</span>
</span><span id="cli-1057"><a href="#cli-1057"><span class="linenos">1057</span></a>    <span class="p">)</span>
</span><span id="cli-1058"><a href="#cli-1058"><span class="linenos">1058</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1059"><a href="#cli-1059"><span class="linenos">1059</span></a>        <span class="s2">&quot;-q&quot;</span><span class="p">,</span>
</span><span id="cli-1060"><a href="#cli-1060"><span class="linenos">1060</span></a>        <span class="s2">&quot;--sqrt-transform&quot;</span><span class="p">,</span>
</span><span id="cli-1061"><a href="#cli-1061"><span class="linenos">1061</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="cli-1062"><a href="#cli-1062"><span class="linenos">1062</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Apply a signed square root transform to the input contributions and CWMs before hit calling.&quot;</span><span class="p">,</span>
</span><span id="cli-1063"><a href="#cli-1063"><span class="linenos">1063</span></a>    <span class="p">)</span>
</span><span id="cli-1064"><a href="#cli-1064"><span class="linenos">1064</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1065"><a href="#cli-1065"><span class="linenos">1065</span></a>        <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
</span><span id="cli-1066"><a href="#cli-1066"><span class="linenos">1066</span></a>        <span class="s2">&quot;--step-size-max&quot;</span><span class="p">,</span>
</span><span id="cli-1067"><a href="#cli-1067"><span class="linenos">1067</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="cli-1068"><a href="#cli-1068"><span class="linenos">1068</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
</span><span id="cli-1069"><a href="#cli-1069"><span class="linenos">1069</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The maximum optimizer step size.&quot;</span><span class="p">,</span>
</span><span id="cli-1070"><a href="#cli-1070"><span class="linenos">1070</span></a>    <span class="p">)</span>
</span><span id="cli-1071"><a href="#cli-1071"><span class="linenos">1071</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1072"><a href="#cli-1072"><span class="linenos">1072</span></a>        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
</span><span id="cli-1073"><a href="#cli-1073"><span class="linenos">1073</span></a>        <span class="s2">&quot;--step-size-min&quot;</span><span class="p">,</span>
</span><span id="cli-1074"><a href="#cli-1074"><span class="linenos">1074</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="cli-1075"><a href="#cli-1075"><span class="linenos">1075</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span>
</span><span id="cli-1076"><a href="#cli-1076"><span class="linenos">1076</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The minimum optimizer step size.&quot;</span><span class="p">,</span>
</span><span id="cli-1077"><a href="#cli-1077"><span class="linenos">1077</span></a>    <span class="p">)</span>
</span><span id="cli-1078"><a href="#cli-1078"><span class="linenos">1078</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1079"><a href="#cli-1079"><span class="linenos">1079</span></a>        <span class="s2">&quot;-j&quot;</span><span class="p">,</span>
</span><span id="cli-1080"><a href="#cli-1080"><span class="linenos">1080</span></a>        <span class="s2">&quot;--step-adjust&quot;</span><span class="p">,</span>
</span><span id="cli-1081"><a href="#cli-1081"><span class="linenos">1081</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="cli-1082"><a href="#cli-1082"><span class="linenos">1082</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
</span><span id="cli-1083"><a href="#cli-1083"><span class="linenos">1083</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The optimizer step size adjustment factor. If the optimizer diverges, the step size is multiplicatively adjusted by this factor&quot;</span><span class="p">,</span>
</span><span id="cli-1084"><a href="#cli-1084"><span class="linenos">1084</span></a>    <span class="p">)</span>
</span><span id="cli-1085"><a href="#cli-1085"><span class="linenos">1085</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1086"><a href="#cli-1086"><span class="linenos">1086</span></a>        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="cli-1087"><a href="#cli-1087"><span class="linenos">1087</span></a>        <span class="s2">&quot;--convergence-tol&quot;</span><span class="p">,</span>
</span><span id="cli-1088"><a href="#cli-1088"><span class="linenos">1088</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="cli-1089"><a href="#cli-1089"><span class="linenos">1089</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.0005</span><span class="p">,</span>
</span><span id="cli-1090"><a href="#cli-1090"><span class="linenos">1090</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The tolerance for determining convergence. The optimizer exits when the duality gap is less than the tolerance.&quot;</span><span class="p">,</span>
</span><span id="cli-1091"><a href="#cli-1091"><span class="linenos">1091</span></a>    <span class="p">)</span>
</span><span id="cli-1092"><a href="#cli-1092"><span class="linenos">1092</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1093"><a href="#cli-1093"><span class="linenos">1093</span></a>        <span class="s2">&quot;-S&quot;</span><span class="p">,</span>
</span><span id="cli-1094"><a href="#cli-1094"><span class="linenos">1094</span></a>        <span class="s2">&quot;--max-steps&quot;</span><span class="p">,</span>
</span><span id="cli-1095"><a href="#cli-1095"><span class="linenos">1095</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="cli-1096"><a href="#cli-1096"><span class="linenos">1096</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
</span><span id="cli-1097"><a href="#cli-1097"><span class="linenos">1097</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The maximum number of optimization steps.&quot;</span><span class="p">,</span>
</span><span id="cli-1098"><a href="#cli-1098"><span class="linenos">1098</span></a>    <span class="p">)</span>
</span><span id="cli-1099"><a href="#cli-1099"><span class="linenos">1099</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1100"><a href="#cli-1100"><span class="linenos">1100</span></a>        <span class="s2">&quot;-b&quot;</span><span class="p">,</span>
</span><span id="cli-1101"><a href="#cli-1101"><span class="linenos">1101</span></a>        <span class="s2">&quot;--batch-size&quot;</span><span class="p">,</span>
</span><span id="cli-1102"><a href="#cli-1102"><span class="linenos">1102</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="cli-1103"><a href="#cli-1103"><span class="linenos">1103</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
</span><span id="cli-1104"><a href="#cli-1104"><span class="linenos">1104</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The batch size used for optimization.&quot;</span><span class="p">,</span>
</span><span id="cli-1105"><a href="#cli-1105"><span class="linenos">1105</span></a>    <span class="p">)</span>
</span><span id="cli-1106"><a href="#cli-1106"><span class="linenos">1106</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1107"><a href="#cli-1107"><span class="linenos">1107</span></a>        <span class="s2">&quot;-d&quot;</span><span class="p">,</span>
</span><span id="cli-1108"><a href="#cli-1108"><span class="linenos">1108</span></a>        <span class="s2">&quot;--device&quot;</span><span class="p">,</span>
</span><span id="cli-1109"><a href="#cli-1109"><span class="linenos">1109</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1110"><a href="#cli-1110"><span class="linenos">1110</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-1111"><a href="#cli-1111"><span class="linenos">1111</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please use the `CUDA_VISIBLE_DEVICES` environment variable to specify the GPU device.&quot;</span><span class="p">,</span>
</span><span id="cli-1112"><a href="#cli-1112"><span class="linenos">1112</span></a>    <span class="p">)</span>
</span><span id="cli-1113"><a href="#cli-1113"><span class="linenos">1113</span></a>    <span class="n">call_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1114"><a href="#cli-1114"><span class="linenos">1114</span></a>        <span class="s2">&quot;-J&quot;</span><span class="p">,</span>
</span><span id="cli-1115"><a href="#cli-1115"><span class="linenos">1115</span></a>        <span class="s2">&quot;--compile&quot;</span><span class="p">,</span>
</span><span id="cli-1116"><a href="#cli-1116"><span class="linenos">1116</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="cli-1117"><a href="#cli-1117"><span class="linenos">1117</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;JIT-compile the optimizer for faster performance. This may not be supported on older GPUs.&quot;</span><span class="p">,</span>
</span><span id="cli-1118"><a href="#cli-1118"><span class="linenos">1118</span></a>    <span class="p">)</span>
</span><span id="cli-1119"><a href="#cli-1119"><span class="linenos">1119</span></a>
</span><span id="cli-1120"><a href="#cli-1120"><span class="linenos">1120</span></a>    <span class="n">report_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="cli-1121"><a href="#cli-1121"><span class="linenos">1121</span></a>        <span class="s2">&quot;report&quot;</span><span class="p">,</span>
</span><span id="cli-1122"><a href="#cli-1122"><span class="linenos">1122</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="cli-1123"><a href="#cli-1123"><span class="linenos">1123</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Generate statistics and visualizations from hits and tfmodisco-lite motif data.&quot;</span><span class="p">,</span>
</span><span id="cli-1124"><a href="#cli-1124"><span class="linenos">1124</span></a>    <span class="p">)</span>
</span><span id="cli-1125"><a href="#cli-1125"><span class="linenos">1125</span></a>
</span><span id="cli-1126"><a href="#cli-1126"><span class="linenos">1126</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1127"><a href="#cli-1127"><span class="linenos">1127</span></a>        <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
</span><span id="cli-1128"><a href="#cli-1128"><span class="linenos">1128</span></a>        <span class="s2">&quot;--regions&quot;</span><span class="p">,</span>
</span><span id="cli-1129"><a href="#cli-1129"><span class="linenos">1129</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1130"><a href="#cli-1130"><span class="linenos">1130</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-1131"><a href="#cli-1131"><span class="linenos">1131</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A .npz file containing input sequences, contributions, and coordinates. Must be the same as that used for `finemo call-hits`.&quot;</span><span class="p">,</span>
</span><span id="cli-1132"><a href="#cli-1132"><span class="linenos">1132</span></a>    <span class="p">)</span>
</span><span id="cli-1133"><a href="#cli-1133"><span class="linenos">1133</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1134"><a href="#cli-1134"><span class="linenos">1134</span></a>        <span class="s2">&quot;-H&quot;</span><span class="p">,</span>
</span><span id="cli-1135"><a href="#cli-1135"><span class="linenos">1135</span></a>        <span class="s2">&quot;--hits&quot;</span><span class="p">,</span>
</span><span id="cli-1136"><a href="#cli-1136"><span class="linenos">1136</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1137"><a href="#cli-1137"><span class="linenos">1137</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-1138"><a href="#cli-1138"><span class="linenos">1138</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The output directory generated by the `finemo call-hits` command on the regions specified in `--regions`.&quot;</span><span class="p">,</span>
</span><span id="cli-1139"><a href="#cli-1139"><span class="linenos">1139</span></a>    <span class="p">)</span>
</span><span id="cli-1140"><a href="#cli-1140"><span class="linenos">1140</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1141"><a href="#cli-1141"><span class="linenos">1141</span></a>        <span class="s2">&quot;-p&quot;</span><span class="p">,</span>
</span><span id="cli-1142"><a href="#cli-1142"><span class="linenos">1142</span></a>        <span class="s2">&quot;--peaks&quot;</span><span class="p">,</span>
</span><span id="cli-1143"><a href="#cli-1143"><span class="linenos">1143</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1144"><a href="#cli-1144"><span class="linenos">1144</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-1145"><a href="#cli-1145"><span class="linenos">1145</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please provide this file to a preprocessing `finemo extract-regions-*` subcommand instead.&quot;</span><span class="p">,</span>
</span><span id="cli-1146"><a href="#cli-1146"><span class="linenos">1146</span></a>    <span class="p">)</span>
</span><span id="cli-1147"><a href="#cli-1147"><span class="linenos">1147</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1148"><a href="#cli-1148"><span class="linenos">1148</span></a>        <span class="s2">&quot;-m&quot;</span><span class="p">,</span>
</span><span id="cli-1149"><a href="#cli-1149"><span class="linenos">1149</span></a>        <span class="s2">&quot;--modisco-h5&quot;</span><span class="p">,</span>
</span><span id="cli-1150"><a href="#cli-1150"><span class="linenos">1150</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1151"><a href="#cli-1151"><span class="linenos">1151</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-1152"><a href="#cli-1152"><span class="linenos">1152</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The tfmodisco-lite output H5 file of motif patterns. Must be the same as that used for hit calling unless `--no-recall` is set. If omitted, seqlet-derived metrics will not be computed.&quot;</span><span class="p">,</span>
</span><span id="cli-1153"><a href="#cli-1153"><span class="linenos">1153</span></a>    <span class="p">)</span>
</span><span id="cli-1154"><a href="#cli-1154"><span class="linenos">1154</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1155"><a href="#cli-1155"><span class="linenos">1155</span></a>        <span class="s2">&quot;-I&quot;</span><span class="p">,</span>
</span><span id="cli-1156"><a href="#cli-1156"><span class="linenos">1156</span></a>        <span class="s2">&quot;--motifs-include&quot;</span><span class="p">,</span>
</span><span id="cli-1157"><a href="#cli-1157"><span class="linenos">1157</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1158"><a href="#cli-1158"><span class="linenos">1158</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-1159"><a href="#cli-1159"><span class="linenos">1159</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: This information is now inferred from the outputs of `finemo call-hits`.&quot;</span><span class="p">,</span>
</span><span id="cli-1160"><a href="#cli-1160"><span class="linenos">1160</span></a>    <span class="p">)</span>
</span><span id="cli-1161"><a href="#cli-1161"><span class="linenos">1161</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1162"><a href="#cli-1162"><span class="linenos">1162</span></a>        <span class="s2">&quot;-N&quot;</span><span class="p">,</span>
</span><span id="cli-1163"><a href="#cli-1163"><span class="linenos">1163</span></a>        <span class="s2">&quot;--motif-names&quot;</span><span class="p">,</span>
</span><span id="cli-1164"><a href="#cli-1164"><span class="linenos">1164</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1165"><a href="#cli-1165"><span class="linenos">1165</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="cli-1166"><a href="#cli-1166"><span class="linenos">1166</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: This information is now inferred from the outputs of `finemo call-hits`.&quot;</span><span class="p">,</span>
</span><span id="cli-1167"><a href="#cli-1167"><span class="linenos">1167</span></a>    <span class="p">)</span>
</span><span id="cli-1168"><a href="#cli-1168"><span class="linenos">1168</span></a>
</span><span id="cli-1169"><a href="#cli-1169"><span class="linenos">1169</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1170"><a href="#cli-1170"><span class="linenos">1170</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="cli-1171"><a href="#cli-1171"><span class="linenos">1171</span></a>        <span class="s2">&quot;--out-dir&quot;</span><span class="p">,</span>
</span><span id="cli-1172"><a href="#cli-1172"><span class="linenos">1172</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1173"><a href="#cli-1173"><span class="linenos">1173</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-1174"><a href="#cli-1174"><span class="linenos">1174</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the report output directory.&quot;</span><span class="p">,</span>
</span><span id="cli-1175"><a href="#cli-1175"><span class="linenos">1175</span></a>    <span class="p">)</span>
</span><span id="cli-1176"><a href="#cli-1176"><span class="linenos">1176</span></a>
</span><span id="cli-1177"><a href="#cli-1177"><span class="linenos">1177</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1178"><a href="#cli-1178"><span class="linenos">1178</span></a>        <span class="s2">&quot;-W&quot;</span><span class="p">,</span>
</span><span id="cli-1179"><a href="#cli-1179"><span class="linenos">1179</span></a>        <span class="s2">&quot;--modisco-region-width&quot;</span><span class="p">,</span>
</span><span id="cli-1180"><a href="#cli-1180"><span class="linenos">1180</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span id="cli-1181"><a href="#cli-1181"><span class="linenos">1181</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
</span><span id="cli-1182"><a href="#cli-1182"><span class="linenos">1182</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The width of the region around each peak summit used by tfmodisco-lite.&quot;</span><span class="p">,</span>
</span><span id="cli-1183"><a href="#cli-1183"><span class="linenos">1183</span></a>    <span class="p">)</span>
</span><span id="cli-1184"><a href="#cli-1184"><span class="linenos">1184</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1185"><a href="#cli-1185"><span class="linenos">1185</span></a>        <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
</span><span id="cli-1186"><a href="#cli-1186"><span class="linenos">1186</span></a>        <span class="s2">&quot;--cwm-trim-threshold&quot;</span><span class="p">,</span>
</span><span id="cli-1187"><a href="#cli-1187"><span class="linenos">1187</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="cli-1188"><a href="#cli-1188"><span class="linenos">1188</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="cli-1189"><a href="#cli-1189"><span class="linenos">1189</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: This information is now inferred from the outputs of `finemo call-hits`.&quot;</span><span class="p">,</span>
</span><span id="cli-1190"><a href="#cli-1190"><span class="linenos">1190</span></a>    <span class="p">)</span>
</span><span id="cli-1191"><a href="#cli-1191"><span class="linenos">1191</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1192"><a href="#cli-1192"><span class="linenos">1192</span></a>        <span class="s2">&quot;-n&quot;</span><span class="p">,</span>
</span><span id="cli-1193"><a href="#cli-1193"><span class="linenos">1193</span></a>        <span class="s2">&quot;--no-recall&quot;</span><span class="p">,</span>
</span><span id="cli-1194"><a href="#cli-1194"><span class="linenos">1194</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="cli-1195"><a href="#cli-1195"><span class="linenos">1195</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Do not compute motif recall metrics.&quot;</span><span class="p">,</span>
</span><span id="cli-1196"><a href="#cli-1196"><span class="linenos">1196</span></a>    <span class="p">)</span>
</span><span id="cli-1197"><a href="#cli-1197"><span class="linenos">1197</span></a>    <span class="n">report_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1198"><a href="#cli-1198"><span class="linenos">1198</span></a>        <span class="s2">&quot;-s&quot;</span><span class="p">,</span>
</span><span id="cli-1199"><a href="#cli-1199"><span class="linenos">1199</span></a>        <span class="s2">&quot;--no-seqlets&quot;</span><span class="p">,</span>
</span><span id="cli-1200"><a href="#cli-1200"><span class="linenos">1200</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="cli-1201"><a href="#cli-1201"><span class="linenos">1201</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;DEPRECATED: Please omit the `--modisco-h5` argument instead.&quot;</span><span class="p">,</span>
</span><span id="cli-1202"><a href="#cli-1202"><span class="linenos">1202</span></a>    <span class="p">)</span>
</span><span id="cli-1203"><a href="#cli-1203"><span class="linenos">1203</span></a>
</span><span id="cli-1204"><a href="#cli-1204"><span class="linenos">1204</span></a>    <span class="n">collapse_hits_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="cli-1205"><a href="#cli-1205"><span class="linenos">1205</span></a>        <span class="s2">&quot;collapse-hits&quot;</span><span class="p">,</span>
</span><span id="cli-1206"><a href="#cli-1206"><span class="linenos">1206</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="cli-1207"><a href="#cli-1207"><span class="linenos">1207</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Identify best hit by motif similarity among sets of overlapping hits.&quot;</span><span class="p">,</span>
</span><span id="cli-1208"><a href="#cli-1208"><span class="linenos">1208</span></a>    <span class="p">)</span>
</span><span id="cli-1209"><a href="#cli-1209"><span class="linenos">1209</span></a>
</span><span id="cli-1210"><a href="#cli-1210"><span class="linenos">1210</span></a>    <span class="n">collapse_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1211"><a href="#cli-1211"><span class="linenos">1211</span></a>        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
</span><span id="cli-1212"><a href="#cli-1212"><span class="linenos">1212</span></a>        <span class="s2">&quot;--hits&quot;</span><span class="p">,</span>
</span><span id="cli-1213"><a href="#cli-1213"><span class="linenos">1213</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1214"><a href="#cli-1214"><span class="linenos">1214</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-1215"><a href="#cli-1215"><span class="linenos">1215</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The `hits.tsv` or `hits_unique.tsv` file from `call-hits`.&quot;</span><span class="p">,</span>
</span><span id="cli-1216"><a href="#cli-1216"><span class="linenos">1216</span></a>    <span class="p">)</span>
</span><span id="cli-1217"><a href="#cli-1217"><span class="linenos">1217</span></a>    <span class="n">collapse_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1218"><a href="#cli-1218"><span class="linenos">1218</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="cli-1219"><a href="#cli-1219"><span class="linenos">1219</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="cli-1220"><a href="#cli-1220"><span class="linenos">1220</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1221"><a href="#cli-1221"><span class="linenos">1221</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-1222"><a href="#cli-1222"><span class="linenos">1222</span></a>        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The path to the output .tsv file with an additional &quot;is_primary&quot; column.&#39;</span><span class="p">,</span>
</span><span id="cli-1223"><a href="#cli-1223"><span class="linenos">1223</span></a>    <span class="p">)</span>
</span><span id="cli-1224"><a href="#cli-1224"><span class="linenos">1224</span></a>    <span class="n">collapse_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1225"><a href="#cli-1225"><span class="linenos">1225</span></a>        <span class="s2">&quot;-O&quot;</span><span class="p">,</span>
</span><span id="cli-1226"><a href="#cli-1226"><span class="linenos">1226</span></a>        <span class="s2">&quot;--overlap-frac&quot;</span><span class="p">,</span>
</span><span id="cli-1227"><a href="#cli-1227"><span class="linenos">1227</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span id="cli-1228"><a href="#cli-1228"><span class="linenos">1228</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="cli-1229"><a href="#cli-1229"><span class="linenos">1229</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The threshold for determining overlapping hits. For two hits with lengths x and y, the minimum overlap is defined as `overlap_frac * (x + y) / 2`. The default value of 0.2 means that two hits must overlap by at least 20</span><span class="si">% o</span><span class="s2">f their average lengths to be considered overlapping.&quot;</span><span class="p">,</span>
</span><span id="cli-1230"><a href="#cli-1230"><span class="linenos">1230</span></a>    <span class="p">)</span>
</span><span id="cli-1231"><a href="#cli-1231"><span class="linenos">1231</span></a>
</span><span id="cli-1232"><a href="#cli-1232"><span class="linenos">1232</span></a>    <span class="n">intersect_hits_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
</span><span id="cli-1233"><a href="#cli-1233"><span class="linenos">1233</span></a>        <span class="s2">&quot;intersect-hits&quot;</span><span class="p">,</span>
</span><span id="cli-1234"><a href="#cli-1234"><span class="linenos">1234</span></a>        <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentDefaultsHelpFormatter</span><span class="p">,</span>
</span><span id="cli-1235"><a href="#cli-1235"><span class="linenos">1235</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Intersect hits across multiple runs.&quot;</span><span class="p">,</span>
</span><span id="cli-1236"><a href="#cli-1236"><span class="linenos">1236</span></a>    <span class="p">)</span>
</span><span id="cli-1237"><a href="#cli-1237"><span class="linenos">1237</span></a>
</span><span id="cli-1238"><a href="#cli-1238"><span class="linenos">1238</span></a>    <span class="n">intersect_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1239"><a href="#cli-1239"><span class="linenos">1239</span></a>        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
</span><span id="cli-1240"><a href="#cli-1240"><span class="linenos">1240</span></a>        <span class="s2">&quot;--hits&quot;</span><span class="p">,</span>
</span><span id="cli-1241"><a href="#cli-1241"><span class="linenos">1241</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1242"><a href="#cli-1242"><span class="linenos">1242</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-1243"><a href="#cli-1243"><span class="linenos">1243</span></a>        <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
</span><span id="cli-1244"><a href="#cli-1244"><span class="linenos">1244</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;One or more hits.tsv or hits_unique.tsv files, with paths delimited by whitespace.&quot;</span><span class="p">,</span>
</span><span id="cli-1245"><a href="#cli-1245"><span class="linenos">1245</span></a>    <span class="p">)</span>
</span><span id="cli-1246"><a href="#cli-1246"><span class="linenos">1246</span></a>    <span class="n">intersect_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1247"><a href="#cli-1247"><span class="linenos">1247</span></a>        <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span id="cli-1248"><a href="#cli-1248"><span class="linenos">1248</span></a>        <span class="s2">&quot;--out-path&quot;</span><span class="p">,</span>
</span><span id="cli-1249"><a href="#cli-1249"><span class="linenos">1249</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="cli-1250"><a href="#cli-1250"><span class="linenos">1250</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="cli-1251"><a href="#cli-1251"><span class="linenos">1251</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The path to the output .tsv file. Duplicate columns are suffixed with the positional index of the input file.&quot;</span><span class="p">,</span>
</span><span id="cli-1252"><a href="#cli-1252"><span class="linenos">1252</span></a>    <span class="p">)</span>
</span><span id="cli-1253"><a href="#cli-1253"><span class="linenos">1253</span></a>    <span class="n">intersect_hits_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="cli-1254"><a href="#cli-1254"><span class="linenos">1254</span></a>        <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
</span><span id="cli-1255"><a href="#cli-1255"><span class="linenos">1255</span></a>        <span class="s2">&quot;--relaxed&quot;</span><span class="p">,</span>
</span><span id="cli-1256"><a href="#cli-1256"><span class="linenos">1256</span></a>        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
</span><span id="cli-1257"><a href="#cli-1257"><span class="linenos">1257</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use relaxed intersection criteria, using only motif names and untrimmed coordinates. By default, the intersection assumes consistent region definitions and motif trimming. This option is not recommended if genomic coordinates are unavailable.&quot;</span><span class="p">,</span>
</span><span id="cli-1258"><a href="#cli-1258"><span class="linenos">1258</span></a>    <span class="p">)</span>
</span><span id="cli-1259"><a href="#cli-1259"><span class="linenos">1259</span></a>
</span><span id="cli-1260"><a href="#cli-1260"><span class="linenos">1260</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="cli-1261"><a href="#cli-1261"><span class="linenos">1261</span></a>
</span><span id="cli-1262"><a href="#cli-1262"><span class="linenos">1262</span></a>    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;extract-regions-bw&quot;</span><span class="p">:</span>
</span><span id="cli-1263"><a href="#cli-1263"><span class="linenos">1263</span></a>        <span class="n">extract_regions_bw</span><span class="p">(</span>
</span><span id="cli-1264"><a href="#cli-1264"><span class="linenos">1264</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span>
</span><span id="cli-1265"><a href="#cli-1265"><span class="linenos">1265</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">chrom_order</span><span class="p">,</span>
</span><span id="cli-1266"><a href="#cli-1266"><span class="linenos">1266</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">fasta</span><span class="p">,</span>
</span><span id="cli-1267"><a href="#cli-1267"><span class="linenos">1267</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">bigwigs</span><span class="p">,</span>
</span><span id="cli-1268"><a href="#cli-1268"><span class="linenos">1268</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span>
</span><span id="cli-1269"><a href="#cli-1269"><span class="linenos">1269</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">region_width</span><span class="p">,</span>
</span><span id="cli-1270"><a href="#cli-1270"><span class="linenos">1270</span></a>        <span class="p">)</span>
</span><span id="cli-1271"><a href="#cli-1271"><span class="linenos">1271</span></a>
</span><span id="cli-1272"><a href="#cli-1272"><span class="linenos">1272</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;extract-regions-chrombpnet-h5&quot;</span><span class="p">:</span>
</span><span id="cli-1273"><a href="#cli-1273"><span class="linenos">1273</span></a>        <span class="n">extract_regions_chrombpnet_h5</span><span class="p">(</span>
</span><span id="cli-1274"><a href="#cli-1274"><span class="linenos">1274</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">chrom_order</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">h5s</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">region_width</span>
</span><span id="cli-1275"><a href="#cli-1275"><span class="linenos">1275</span></a>        <span class="p">)</span>
</span><span id="cli-1276"><a href="#cli-1276"><span class="linenos">1276</span></a>
</span><span id="cli-1277"><a href="#cli-1277"><span class="linenos">1277</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;extract-regions-h5&quot;</span><span class="p">:</span>
</span><span id="cli-1278"><a href="#cli-1278"><span class="linenos">1278</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="cli-1279"><a href="#cli-1279"><span class="linenos">1279</span></a>            <span class="s2">&quot;WARNING: The `extract-regions-h5` command is deprecated. Use `extract-regions-chrombpnet-h5` instead.&quot;</span>
</span><span id="cli-1280"><a href="#cli-1280"><span class="linenos">1280</span></a>        <span class="p">)</span>
</span><span id="cli-1281"><a href="#cli-1281"><span class="linenos">1281</span></a>        <span class="n">extract_regions_chrombpnet_h5</span><span class="p">(</span>
</span><span id="cli-1282"><a href="#cli-1282"><span class="linenos">1282</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">chrom_order</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">h5s</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">region_width</span>
</span><span id="cli-1283"><a href="#cli-1283"><span class="linenos">1283</span></a>        <span class="p">)</span>
</span><span id="cli-1284"><a href="#cli-1284"><span class="linenos">1284</span></a>
</span><span id="cli-1285"><a href="#cli-1285"><span class="linenos">1285</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;extract-regions-bpnet-h5&quot;</span><span class="p">:</span>
</span><span id="cli-1286"><a href="#cli-1286"><span class="linenos">1286</span></a>        <span class="n">extract_regions_bpnet_h5</span><span class="p">(</span>
</span><span id="cli-1287"><a href="#cli-1287"><span class="linenos">1287</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">chrom_order</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">h5s</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">region_width</span>
</span><span id="cli-1288"><a href="#cli-1288"><span class="linenos">1288</span></a>        <span class="p">)</span>
</span><span id="cli-1289"><a href="#cli-1289"><span class="linenos">1289</span></a>
</span><span id="cli-1290"><a href="#cli-1290"><span class="linenos">1290</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;extract-regions-modisco-fmt&quot;</span><span class="p">:</span>
</span><span id="cli-1291"><a href="#cli-1291"><span class="linenos">1291</span></a>        <span class="n">extract_regions_modisco_fmt</span><span class="p">(</span>
</span><span id="cli-1292"><a href="#cli-1292"><span class="linenos">1292</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span>
</span><span id="cli-1293"><a href="#cli-1293"><span class="linenos">1293</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">chrom_order</span><span class="p">,</span>
</span><span id="cli-1294"><a href="#cli-1294"><span class="linenos">1294</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">attributions</span><span class="p">,</span>
</span><span id="cli-1295"><a href="#cli-1295"><span class="linenos">1295</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">sequences</span><span class="p">,</span>
</span><span id="cli-1296"><a href="#cli-1296"><span class="linenos">1296</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span>
</span><span id="cli-1297"><a href="#cli-1297"><span class="linenos">1297</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">region_width</span><span class="p">,</span>
</span><span id="cli-1298"><a href="#cli-1298"><span class="linenos">1298</span></a>        <span class="p">)</span>
</span><span id="cli-1299"><a href="#cli-1299"><span class="linenos">1299</span></a>
</span><span id="cli-1300"><a href="#cli-1300"><span class="linenos">1300</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;call-hits&quot;</span><span class="p">:</span>
</span><span id="cli-1301"><a href="#cli-1301"><span class="linenos">1301</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="cli-1302"><a href="#cli-1302"><span class="linenos">1302</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="cli-1303"><a href="#cli-1303"><span class="linenos">1303</span></a>                <span class="s2">&quot;The `--alpha` flag is deprecated and will be removed in a future version. Please use the `--global-lambda` flag instead.&quot;</span>
</span><span id="cli-1304"><a href="#cli-1304"><span class="linenos">1304</span></a>            <span class="p">)</span>
</span><span id="cli-1305"><a href="#cli-1305"><span class="linenos">1305</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">global_lambda</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">alpha</span>
</span><span id="cli-1306"><a href="#cli-1306"><span class="linenos">1306</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">motif_alphas</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="cli-1307"><a href="#cli-1307"><span class="linenos">1307</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="cli-1308"><a href="#cli-1308"><span class="linenos">1308</span></a>                <span class="s2">&quot;The `--motif-alphas` flag is deprecated and will be removed in a future version. Please use the `--motif-lambdas` flag instead.&quot;</span>
</span><span id="cli-1309"><a href="#cli-1309"><span class="linenos">1309</span></a>            <span class="p">)</span>
</span><span id="cli-1310"><a href="#cli-1310"><span class="linenos">1310</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">motif_lambdas</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">motif_alphas</span>
</span><span id="cli-1311"><a href="#cli-1311"><span class="linenos">1311</span></a>
</span><span id="cli-1312"><a href="#cli-1312"><span class="linenos">1312</span></a>        <span class="n">call_hits</span><span class="p">(</span>
</span><span id="cli-1313"><a href="#cli-1313"><span class="linenos">1313</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">regions</span><span class="p">,</span>
</span><span id="cli-1314"><a href="#cli-1314"><span class="linenos">1314</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span>
</span><span id="cli-1315"><a href="#cli-1315"><span class="linenos">1315</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">modisco_h5</span><span class="p">,</span>
</span><span id="cli-1316"><a href="#cli-1316"><span class="linenos">1316</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">chrom_order</span><span class="p">,</span>
</span><span id="cli-1317"><a href="#cli-1317"><span class="linenos">1317</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">motifs_include</span><span class="p">,</span>
</span><span id="cli-1318"><a href="#cli-1318"><span class="linenos">1318</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">motif_names</span><span class="p">,</span>
</span><span id="cli-1319"><a href="#cli-1319"><span class="linenos">1319</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">motif_lambdas</span><span class="p">,</span>
</span><span id="cli-1320"><a href="#cli-1320"><span class="linenos">1320</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span>
</span><span id="cli-1321"><a href="#cli-1321"><span class="linenos">1321</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">cwm_trim_coords</span><span class="p">,</span>
</span><span id="cli-1322"><a href="#cli-1322"><span class="linenos">1322</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">cwm_trim_thresholds</span><span class="p">,</span>
</span><span id="cli-1323"><a href="#cli-1323"><span class="linenos">1323</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">cwm_trim_threshold</span><span class="p">,</span>
</span><span id="cli-1324"><a href="#cli-1324"><span class="linenos">1324</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">global_lambda</span><span class="p">,</span>
</span><span id="cli-1325"><a href="#cli-1325"><span class="linenos">1325</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">step_size_max</span><span class="p">,</span>
</span><span id="cli-1326"><a href="#cli-1326"><span class="linenos">1326</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">step_size_min</span><span class="p">,</span>
</span><span id="cli-1327"><a href="#cli-1327"><span class="linenos">1327</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">sqrt_transform</span><span class="p">,</span>
</span><span id="cli-1328"><a href="#cli-1328"><span class="linenos">1328</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">convergence_tol</span><span class="p">,</span>
</span><span id="cli-1329"><a href="#cli-1329"><span class="linenos">1329</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">max_steps</span><span class="p">,</span>
</span><span id="cli-1330"><a href="#cli-1330"><span class="linenos">1330</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="cli-1331"><a href="#cli-1331"><span class="linenos">1331</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">step_adjust</span><span class="p">,</span>
</span><span id="cli-1332"><a href="#cli-1332"><span class="linenos">1332</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
</span><span id="cli-1333"><a href="#cli-1333"><span class="linenos">1333</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
</span><span id="cli-1334"><a href="#cli-1334"><span class="linenos">1334</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">no_post_filter</span><span class="p">,</span>
</span><span id="cli-1335"><a href="#cli-1335"><span class="linenos">1335</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">compile</span><span class="p">,</span>
</span><span id="cli-1336"><a href="#cli-1336"><span class="linenos">1336</span></a>        <span class="p">)</span>
</span><span id="cli-1337"><a href="#cli-1337"><span class="linenos">1337</span></a>
</span><span id="cli-1338"><a href="#cli-1338"><span class="linenos">1338</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;report&quot;</span><span class="p">:</span>
</span><span id="cli-1339"><a href="#cli-1339"><span class="linenos">1339</span></a>        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">no_recall</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">no_seqlets</span><span class="p">:</span>
</span><span id="cli-1340"><a href="#cli-1340"><span class="linenos">1340</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="cli-1341"><a href="#cli-1341"><span class="linenos">1341</span></a>                <span class="s2">&quot;The `--no-seqlets` flag must be set in conjunction with `--no-recall`.&quot;</span>
</span><span id="cli-1342"><a href="#cli-1342"><span class="linenos">1342</span></a>            <span class="p">)</span>
</span><span id="cli-1343"><a href="#cli-1343"><span class="linenos">1343</span></a>
</span><span id="cli-1344"><a href="#cli-1344"><span class="linenos">1344</span></a>        <span class="n">report</span><span class="p">(</span>
</span><span id="cli-1345"><a href="#cli-1345"><span class="linenos">1345</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">regions</span><span class="p">,</span>
</span><span id="cli-1346"><a href="#cli-1346"><span class="linenos">1346</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">hits</span><span class="p">,</span>
</span><span id="cli-1347"><a href="#cli-1347"><span class="linenos">1347</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">modisco_h5</span><span class="p">,</span>
</span><span id="cli-1348"><a href="#cli-1348"><span class="linenos">1348</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">peaks</span><span class="p">,</span>
</span><span id="cli-1349"><a href="#cli-1349"><span class="linenos">1349</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">motifs_include</span><span class="p">,</span>
</span><span id="cli-1350"><a href="#cli-1350"><span class="linenos">1350</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">motif_names</span><span class="p">,</span>
</span><span id="cli-1351"><a href="#cli-1351"><span class="linenos">1351</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">out_dir</span><span class="p">,</span>
</span><span id="cli-1352"><a href="#cli-1352"><span class="linenos">1352</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">modisco_region_width</span><span class="p">,</span>
</span><span id="cli-1353"><a href="#cli-1353"><span class="linenos">1353</span></a>            <span class="n">args</span><span class="o">.</span><span class="n">cwm_trim_threshold</span><span class="p">,</span>
</span><span id="cli-1354"><a href="#cli-1354"><span class="linenos">1354</span></a>            <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">no_recall</span><span class="p">,</span>
</span><span id="cli-1355"><a href="#cli-1355"><span class="linenos">1355</span></a>            <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">no_seqlets</span><span class="p">,</span>
</span><span id="cli-1356"><a href="#cli-1356"><span class="linenos">1356</span></a>        <span class="p">)</span>
</span><span id="cli-1357"><a href="#cli-1357"><span class="linenos">1357</span></a>
</span><span id="cli-1358"><a href="#cli-1358"><span class="linenos">1358</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;collapse-hits&quot;</span><span class="p">:</span>
</span><span id="cli-1359"><a href="#cli-1359"><span class="linenos">1359</span></a>        <span class="n">collapse_hits</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">hits</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">overlap_frac</span><span class="p">)</span>
</span><span id="cli-1360"><a href="#cli-1360"><span class="linenos">1360</span></a>
</span><span id="cli-1361"><a href="#cli-1361"><span class="linenos">1361</span></a>    <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;intersect-hits&quot;</span><span class="p">:</span>
</span><span id="cli-1362"><a href="#cli-1362"><span class="linenos">1362</span></a>        <span class="n">intersect_hits</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">hits</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">out_path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">relaxed</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Command-line interface for the Fi-NeMo motif instance calling pipeline.</p>

<p>This function provides the main entry point for all Fi-NeMo operations including:</p>

<ul>
<li>Data preprocessing from various formats (bigWig, HDF5, TF-MoDISco)</li>
<li>Motif hit calling using the Fi-NeMo algorithm</li>
<li>Report generation and visualization</li>
<li>Post-processing operations (hit collapsing, intersection)</li>
</ul>

<p>The CLI supports comprehensive workflows for transcription factor motif
analysis from raw genomic data to publication-ready visualizations.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>